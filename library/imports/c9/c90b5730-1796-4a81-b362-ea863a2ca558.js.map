{"version":3,"sources":["assets\\scripts\\CPlayer.js"],"names":["Types","require","Utility","CPlayer","cc","Class","Component","properties","avatar","Node","displayName","Label","gold","spriteAvatar","type","SpriteFrame","layerCard","imgPass","progressBar","ProgressBar","headProgressBar","ParticleSystem","backCard","Sprite","lbNumCard","ctor","player","gameController","cards","_isMyTurn","_numCard","onLoad","setMyTurn","index","node","active","string","name","formatMoneyFull","_loadCards","console","error","start","update","dt","progress","audio","playCountDown","p","Vec2","rotate","setPosition","setGameController","setPlayer","updateUI","midIndex","getNumCard","midPos","getPositionVia","midRot","getRotationVia","log","JSON","stringify","i","length","c","toString","cardPrefab","getNewCard","cCard","getComponent","setCard","setOwner","getPositionCard","r","getRotationCard","angle","runAction","spawn","moveTo","x","y","rotateTo","addChild","push","setLayerCard","onDiscard","cardPrefabs","isContain","id","len","card","unshift","splice","_updatePosCards","pos","getPosition","k","setPositionCenter","num","startX","endX","maxOffsetX","offset","getCirclePos","onPass","img","color","Color","GRAY","sequence","delayTime","callFunc","WHITE","bind","onTouchCard","event","owner","EventType","TOUCH_START","TOUCH_MOVE","isDraging","getParent","convertToNodeSpaceAR","getLocation","TOUCH_END","isSelected","TOUCH_CANCEL","onCloseTurn","stopAllActions","scaleTo","stopCountDown","onEnterTurn","easing","easeBackOut","b","setSuggest","stopSystem","resetSystem","onSuggestCard","groups","lg","l","j","isContainAll","myCards","module","exports"],"mappings":"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","sourceRoot":"/","sourcesContent":["var Types = require(\"Types\");\r\nvar Utility = require(\"Utility\");\r\n\r\nvar CPlayer = cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        avatar:cc.Node,\r\n        displayName:cc.Label,\r\n        gold:cc.Label,\r\n        spriteAvatar:{\r\n            default:[],\r\n            type:[cc.SpriteFrame]\r\n        },\r\n        layerCard:{\r\n            default:null,\r\n            type:cc.Node\r\n        },\r\n        imgPass:{\r\n            default:null,\r\n            type:cc.Node\r\n        },\r\n        progressBar:{\r\n            default:null,\r\n            type:cc.ProgressBar\r\n        },\r\n        headProgressBar:{\r\n            default:null,\r\n            type:cc.ParticleSystem\r\n        },\r\n        backCard:{\r\n            default:null,\r\n            type:cc.Sprite\r\n        },\r\n        lbNumCard:{\r\n            default:null,\r\n            type:cc.Label\r\n        }\r\n    },\r\n    ctor:function(){\r\n        /** @type {Player}*/\r\n        this.player = null;\r\n        /** @type {GameController}*/\r\n        this.gameController = null;\r\n        /** @type {[cardPrefab]}*/\r\n        this.cards = [];\r\n        this._isMyTurn = false;\r\n        this._numCard = 0;\r\n    },\r\n    onLoad:function(){\r\n        this.setMyTurn(this._isMyTurn);\r\n        if(this.player){\r\n            if(this.player.index === 0){\r\n                this.backCard.node.active = false;\r\n            }\r\n            this.displayName.string = this.player.name;\r\n            this.gold.string = Utility.formatMoneyFull(this.player.gold);\r\n\r\n            // var circleAvatar = this.avatar.getComponent(\"CCircleAvatar\");\r\n            // circleAvatar.changeAvatar(this.spriteAvatar[this.player.avatar]);\r\n\r\n            //loadCards\r\n            this._loadCards();\r\n        }else{\r\n            console.error(\"need load setPlayer info onLoad\");\r\n        }\r\n        if(this.imgPass){\r\n            this.imgPass.active = false;\r\n        }\r\n    },\r\n    start:function () {\r\n\r\n    },\r\n\r\n    update (dt) {\r\n        if(this._isMyTurn){\r\n            var progressBar = this.progressBar;\r\n            var progress = progressBar.progress;\r\n            if(progress < 0.4){\r\n                this.gameController.audio.playCountDown();\r\n            }\r\n            if(progress > 0){\r\n                progress -= (dt * 0.1);\r\n            }\r\n            progressBar.progress = progress;\r\n\r\n            var p = new cc.Vec2(0,75);\r\n            p = p.rotate(progress * 2 * 3.14);\r\n            this.headProgressBar.node.setPosition(p);\r\n        }\r\n    },\r\n\r\n    setGameController:function(gameController){\r\n        this.gameController = gameController;\r\n    },\r\n    setPlayer:function (player) {\r\n        this.player = player;\r\n        if(this.player.index !== 0){\r\n            this._numCard = 11;\r\n        }\r\n    },\r\n    updateUI:function () {\r\n\r\n    },\r\n    _loadCards:function () {\r\n        var midIndex = this.getNumCard()/2;\r\n        var midPos = this.getPositionVia(midIndex);\r\n        var midRot = this.getRotationVia(midIndex);\r\n        if(this.gameController){\r\n            var cards = this.player.cards;\r\n            console.log(\"loadCards: \" + this.player.index +\"|\" + JSON.stringify(cards));\r\n            for (var i = 0; i < cards.length; i++) {\r\n                var c = cards[i];\r\n                cc.log(c.toString());\r\n                var cardPrefab = this.gameController.getNewCard();\r\n                var cCard = cardPrefab.getComponent(\"CCard\");\r\n\r\n                cCard.setCard(c);\r\n                cCard.index = (i);\r\n                cCard.setOwner(this);\r\n\r\n                var p = this.getPositionCard(cCard);\r\n                var r = this.getRotationCard(cCard);\r\n                // cardPrefab.setPosition(p);\r\n                // cardPrefab.angle = (-r);\r\n                cardPrefab.setPosition(midPos);\r\n                cardPrefab.angle = -midRot;\r\n                cardPrefab.runAction(cc.spawn(\r\n                    cc.moveTo(0.6,p.x,p.y),\r\n                    cc.rotateTo(0.6,r)\r\n                ));\r\n                this.layerCard.addChild(cardPrefab);\r\n                this.cards.push(cardPrefab);\r\n            }\r\n            this.lbNumCard.string = this.getNumCard();\r\n        }else{\r\n            console.error(\"don't have GameControler in Player, so can't create newCard\");\r\n        }\r\n    },\r\n    setLayerCard:function(layerCard){\r\n        this.layerCard = layerCard;\r\n    },\r\n    onDiscard:function(cards){\r\n        this.setMyTurn(false);\r\n        if(this.layerCard == null){\r\n            console.error(\"you need add layerCard to player beforeDiscard\");\r\n            return [];\r\n        }\r\n        var cardPrefabs = [];\r\n        if(this.player && this.player.index === 0){\r\n            var isContain = function (c) {\r\n                for (var i = 0; i < cards.length; i++) {\r\n                    if(c.id=== cards[i].id){\r\n                        return true;\r\n                    }\r\n                }\r\n                return false;\r\n            };\r\n            var len = this.cards.length;\r\n            for (var i = len - 1; i >= 0; i--) {\r\n                var cardPrefab = this.cards[i];\r\n                var cCard = cardPrefab.getComponent(\"CCard\");\r\n                if(isContain(cCard.card)){\r\n                    cardPrefabs.unshift(cardPrefab);\r\n                    this.cards.splice(i,1);\r\n                    this.player.cards.splice(i,1);\r\n                }\r\n            }\r\n            this._updatePosCards();\r\n        }else{\r\n            var pos = this.node.getPosition();\r\n            pos.x += this.backCard.node.getPosition().x;\r\n            for (var k = 0; k < cards.length; k++) {\r\n                var cardPrefab = this.gameController.getNewCard();\r\n                var cCard = cardPrefab.getComponent(\"CCard\");\r\n                cCard.setCard(cards[k]);\r\n                cardPrefab.angle = 0;\r\n                cCard.setPositionCenter(pos);\r\n                cardPrefabs.push(cardPrefab);\r\n                this.layerCard.addChild(cardPrefab);\r\n            }\r\n            this._numCard -= cards.length;\r\n        }\r\n        this.lbNumCard.string = this.getNumCard();\r\n        return cardPrefabs;\r\n    },\r\n    _updatePosCards:function(){\r\n        console.log(\"_updatePosCards\");\r\n        var midIndex = this.getNumCard()/2;\r\n        var midPos = this.getPositionVia(midIndex);\r\n        var midRot = this.getRotationVia(midIndex);\r\n        if(this.gameController){\r\n            var cards = this.cards;\r\n            for (var i = 0; i < cards.length; i++) {\r\n                var cardPrefab = cards[i];\r\n                var cCard = cardPrefab.getComponent(\"CCard\");\r\n\r\n                cCard.index = (i);\r\n\r\n                var p = this.getPositionCard(cCard);\r\n                var r = this.getRotationCard(cCard);\r\n                // cardPrefab.setPosition(p);\r\n                // cardPrefab.angle = (-r);\r\n                // cardPrefab.setPosition(midPos);\r\n                // cardPrefab.angle = -midRot;\r\n                cardPrefab.runAction(cc.spawn(\r\n                    cc.moveTo(0.2,p.x,p.y),\r\n                    cc.rotateTo(0.2,r)\r\n                ));\r\n            }\r\n        }else{\r\n            console.error(\"don't have GameControler in Player, so can't create newCard\");\r\n        }\r\n    },\r\n\r\n    getNumCard:function(){\r\n        if(this.player){\r\n            if(this.player.index !== 0){\r\n                return this._numCard;\r\n            }\r\n            return this.player.cards.length;\r\n        }\r\n        return 1;\r\n    },\r\n    getRotationCard:function (cCard) {\r\n        var index = cCard.index;\r\n        return this.getRotationVia(index);\r\n    },\r\n\r\n    getRotationVia:function(index){\r\n        var num = this.getNumCard();\r\n        if(num <=1) return 0;\r\n        var y = 0;\r\n        var startX = -95;\r\n        var endX = 75;\r\n        // var startX = -60;\r\n        // var endX = 48;\r\n        var maxOffsetX = num < 7 ? 20 : 50;\r\n        var offset = (endX - startX) / (num - 1);\r\n        if(offset > maxOffsetX) offset = maxOffsetX;\r\n        //re-call startX;\r\n        startX = startX +  (endX - startX - (offset *(num - 1)))/2;\r\n        return startX + (offset * index);\r\n    },\r\n    /**\r\n     *\r\n     * @param cCard {CCard}\r\n     */\r\n    getPositionCard:function (cCard){\r\n        var index = cCard.index;\r\n        return this.getPositionVia(index);\r\n    },\r\n    getPositionVia:function(index){\r\n        var num = this.getNumCard();\r\n        var y = 0;\r\n        var startX = - 250;\r\n        var endX = 250;\r\n        var maxOffsetX = 5;\r\n        var offset = (endX - startX) / (num - 1);\r\n        if(offset > maxOffsetX) offset = maxOffsetX;\r\n        //re-call startX;\r\n        startX = startX +  (endX - startX - (offset *(num - 1)))/2;\r\n        if(num <=1) startX -= 60;\r\n        return this.getCirclePos(new cc.Vec2(startX + (offset * index), y));\r\n    },\r\n    /**\r\n     *\r\n     * @param pos {cc.Vec2}\r\n     */\r\n    getCirclePos:function (pos) {\r\n        var x = pos.x;\r\n        pos.y = ((-1/100*(x*x))/1000 - 440);\r\n        return pos;\r\n    },\r\n    onPass:function () {\r\n        this.setMyTurn(false);\r\n        if(this.imgPass){\r\n            this.imgPass.active = true;\r\n            this.avatar.getComponent(\"CCircleAvatar\").img.node.color = cc.Color.GRAY;\r\n            this.node.runAction(cc.sequence(\r\n                cc.delayTime(2),\r\n                cc.callFunc(function () {\r\n                    this.imgPass.active = false;\r\n                    this.avatar.getComponent(\"CCircleAvatar\").img.node.color = cc.Color.WHITE;\r\n                }.bind(this))\r\n            ))\r\n        }\r\n    },\r\n    /**\r\n     *\r\n     * @param event {cc.EventTouch}\r\n     * @param card {Card}\r\n     */\r\n    onTouchCard:function (event,card,owner) {\r\n        switch (event.type) {\r\n            case cc.Node.EventType.TOUCH_START:\r\n                break;\r\n            case cc.Node.EventType.TOUCH_MOVE:\r\n                card.isDraging = true;\r\n                var pos = card.node.getParent().convertToNodeSpaceAR(event.getLocation());\r\n                card.node.setPosition(pos);\r\n                break;\r\n            case cc.Node.EventType.TOUCH_END:\r\n                card.isDraging = false;\r\n                card.isSelected = !card.isSelected;\r\n                card.node.setPosition(this.getPositionCard(card));\r\n                break;\r\n            case cc.Node.EventType.TOUCH_CANCEL:\r\n                card.isDraging = false;\r\n                card.node.setPosition(this.getPositionCard(card));\r\n                break;\r\n        }\r\n    },\r\n    onCloseTurn:function(){\r\n        cc.log(\"onCloseTurn:\" + this.player.index);\r\n        if(this.player.index === 0){\r\n            this.node.stopAllActions();\r\n            this.node.runAction(cc.scaleTo(0.5,1,1));\r\n            // this.node.scale = 1;\r\n        }\r\n        this.setMyTurn(false);\r\n        this.gameController.audio.stopCountDown();\r\n    }\r\n    ,\r\n    onEnterTurn:function () {\r\n        cc.log(\"onEnterTurn:\" + this.player.index);\r\n        if(this.player.index === 0) {\r\n            this.node.runAction(cc.scaleTo(0.5,1.2,1.2).easing(cc.easeBackOut()));\r\n            // this.node.scale = 1.17;\r\n            // return;\r\n        }\r\n        this.progressBar.progress = 1;\r\n        this.setMyTurn(true);\r\n    },\r\n    setMyTurn:function (b) {\r\n        this._isMyTurn = b;\r\n        this.progressBar.node.active = b;\r\n        var len = this.cards.length;\r\n        for (var i = 0; i < len; i++) {\r\n            var cardPrefab = this.cards[i];\r\n            var cCard = cardPrefab.getComponent(\"CCard\");\r\n            cCard.setSuggest(true);\r\n        }\r\n        if(!b){\r\n            this.headProgressBar.stopSystem();\r\n        }else{\r\n            this.headProgressBar.resetSystem();\r\n        }\r\n        // this.headProgressBar.active = b;\r\n    },\r\n    onSuggestCard:function (groups) {\r\n        var isContain = function (card) {\r\n            var lg = groups.length;\r\n            for (var i = 0; i < lg; i++) {\r\n                var cards = groups[i];\r\n                var l = cards.length;\r\n                for (var j = 0; j < l; j++) {\r\n                    if(cards[j].id === card.id){\r\n                        cc.log(cards[j] +\"<>\" + card )\r\n                        return true;\r\n                    }\r\n                }\r\n            }\r\n            return false;\r\n        };\r\n\r\n\r\n        var len = this.cards.length;\r\n        for (var i = 0; i < len; i++) {\r\n            var cardPrefab = this.cards[i];\r\n            var cCard = cardPrefab.getComponent(\"CCard\");\r\n            cCard.setSuggest(isContain(cCard.card));\r\n        }\r\n    },\r\n    isContainAll:function (cards) {\r\n        var myCards = this.player.cards;\r\n        for (var i = 0; i < cards.length; i++) {\r\n            var card = cards[i];\r\n            var isContain = false;\r\n            for (var j = 0; j < myCards.length; j++) {\r\n                cc.log(\"compare:\" + myCards[j] +\"|\" + card);\r\n                if(myCards[j].id === card.id){\r\n                    isContain = true;\r\n                }\r\n            }\r\n            cc.log(\"isContainAll:\" + card +\"|\" + isContain);\r\n            if(!isContain){\r\n                return false;\r\n            }\r\n        }\r\n\r\n        return true;\r\n    }\r\n    \r\n});\r\nmodule.exports = CPlayer;\r\n"]}