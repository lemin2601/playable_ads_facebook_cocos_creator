{"version":3,"sources":["assets\\scripts\\GameController.js"],"names":["PlayableState","require","PoolHandler","CCard","CTable","CPlayer","Card","Table","Player","ActionType","GameFake","SoundType","CardGroup","PlayableAds","CAudio","Utility","cc","Class","Component","properties","playableState","type","serializable","visible","btnPlayNow","Button","btnDump","btnPass","layerGame","Node","layerAction","table","players","layerCard","nodeSuggestGesture","nodeCHPlay","effectWin","effectCardGroup","cardPrefab","Prefab","imgHands","Sprite","emoPlayers","imgHighLight","_poolCard","NodePool","_gameFake","ctor","curIndex","groupExpects","startPointTouch","zIndexCard","audio","_posHands","onLoad","i","length","push","node","getPosition","active","getComponent","gameController","attachLayerCardToPlayer","gameInfo","getDefaultInfo","tableConfig","id","stake","pot","setTable","cards","dock","cTable","setNumCard","j","c","cardPrefabs","get","instantiate","cCard","setCard","index","setOwner","p","getPositionCard","angle","Math","random","setPosition","addChild","addCards","playersConfig","k","playerConfig","player","displayName","gold","avatarIndex","cPlayer","setGameController","setPlayer","on","onTouchCard","actionConfig","getAction","delayTime","time","onEnterTurn","scheduleOnce","executeAction","bind","start","onEnable","console","log","beforeExecuteAction","PASS","playSoundYourTurn","setGroupExpects","suggest","onSuggestCard","autoShowSuggest","cardExpect","_turnOffAutoSuggest","onCloseTurn","onPassAt","isNewRound","DISCARD","onDiscardAt","group","sound","setTimeout","playAudio","emo","Array","_playEmo","isEnded","hand","runAction","moveBy","WIN","next","actionNext","JSON","stringify","event","data","getUserData","card","owner","isMyTurn","isTouchExpectCards","EventType","TOUCH_START","getLocation","TOUCH_MOVE","TOUCH_END","TOUCH_CANCEL","pos","y","onPlayNow","onCTAClick","onTouchDump","onTouchPass","len","setLayerCard","spine","setCompleteListener","trackEntry","setAnimation","_playEffectGroup","name","clearTracks","unschedule","onPass","onNewRound","cardsOrGroup","groupType","getCards","playerPrefab","l","isContainAll","error","s","onDiscard","effectDiscard","numCard","duration","duration1","setRotation","sequence","spawn","moveTo","rotateTo","scaleTo","x","zIndex","opacity","hide","show","fadeIn","fadeOut","callFunc","sender","FLUSH","STRAIGHT","FULL_HOUSE","FOUR_OF_KIND","NONE","groups","lG","g","isContainGroupExpects","lg","lc","getNewCard","showNodeCHPlay"],"mappings":";;;;;;AAAA,IAAIA,aAAa,GAAGC,OAAO,CAAC,eAAD,CAA3B;;AACA,IAAIC,WAAW,GAAGD,OAAO,CAAC,aAAD,CAAzB;;AACA,IAAIE,KAAK,GAAGF,OAAO,CAAC,OAAD,CAAnB;;AACA,IAAIG,MAAM,GAAGH,OAAO,CAAC,QAAD,CAApB;;AACA,IAAII,OAAO,GAAGJ,OAAO,CAAC,SAAD,CAArB;;eAC0BA,OAAO,CAAC,OAAD;IAA5BK,gBAAAA;IAAKC,iBAAAA;IAAMC,kBAAAA;;gBACgCP,OAAO,CAAC,UAAD;IAAlDQ,uBAAAA;IAAWC,qBAAAA;IAASC,sBAAAA;IAAUC,sBAAAA;;AACnC,IAAIC,WAAW,GAAGZ,OAAO,CAAC,aAAD,CAAzB;;AACA,IAAIa,MAAM,GAAGb,OAAO,CAAC,QAAD,CAApB;;AACA,IAAIc,OAAO,GAAGd,OAAO,CAAC,SAAD,CAArB;;AAEAe,EAAE,CAACC,KAAH,CAAS;AACL,aAAYD,EAAE,CAACE,SADV;AAELC,EAAAA,UAAU,EAAE;AACRC,IAAAA,aAAa,EAAE;AACX,iBAAc,IADH;AAEXC,MAAAA,IAAI,EAAUrB,aAFH;AAGXsB,MAAAA,YAAY,EAAE,KAHH;AAIXC,MAAAA,OAAO,EAAO;AAJH,KADP;AAORC,IAAAA,UAAU,EAAKR,EAAE,CAACS,MAPV;AAQRC,IAAAA,OAAO,EAAQV,EAAE,CAACS,MARV;AASRE,IAAAA,OAAO,EAAQX,EAAE,CAACS,MATV;AAURG,IAAAA,SAAS,EAAMZ,EAAE,CAACa,IAVV;AAWRC,IAAAA,WAAW,EAAId,EAAE,CAACa,IAXV;AAYRE,IAAAA,KAAK,EAAC;AACF,iBAAQ,IADN;AAEFV,MAAAA,IAAI,EAACL,EAAE,CAACa;AAFN,KAZE;AAgBRG,IAAAA,OAAO,EAAI;AACP,iBAAS,EADF;AAEPX,MAAAA,IAAI,EAAKL,EAAE,CAACa;AAFL,KAhBH;AAoBRI,IAAAA,SAAS,EAAC;AACN,iBAAQ,IADF;AAENZ,MAAAA,IAAI,EAACL,EAAE,CAACa;AAFF,KApBF;AAwBRK,IAAAA,kBAAkB,EAAC;AACf,iBAAQ,IADO;AAEfb,MAAAA,IAAI,EAACL,EAAE,CAACa;AAFO,KAxBX;AA4BRM,IAAAA,UAAU,EAAC;AACP,iBAAQ,IADD;AAEPd,MAAAA,IAAI,EAACL,EAAE,CAACa;AAFD,KA5BH;AAgCRO,IAAAA,SAAS,EAAC;AACN,iBAAQ,IADF;AAENf,MAAAA,IAAI,EAACL,EAAE,CAACa;AAFF,KAhCF;AAoCRQ,IAAAA,eAAe,EAAC;AACZ,iBAAQ,IADI;AAEZhB,MAAAA,IAAI,EAACL,EAAE,CAACa;AAFI,KApCR;AAwCRS,IAAAA,UAAU,EAAE;AACR,iBAAS,IADD;AAERjB,MAAAA,IAAI,EAAKL,EAAE,CAACuB;AAFJ,KAxCJ;AA4CRC,IAAAA,QAAQ,EAAC;AACL,iBAAQ,EADH;AAELnB,MAAAA,IAAI,EAAC,CAACL,EAAE,CAACyB,MAAJ;AAFA,KA5CD;AAgDRC,IAAAA,UAAU,EAAC;AACP,iBAAQ,EADD;AAEPrB,MAAAA,IAAI,EAAC,CAACL,EAAE,CAACa,IAAJ;AAFE,KAhDH;AAoDRc,IAAAA,YAAY,EAAC;AACT,iBAAQ,IADC;AAETtB,MAAAA,IAAI,EAACL,EAAE,CAACa;AAFC,KApDL;AAwDRe,IAAAA,SAAS,EAAE;AACP,iBAAS,IADF;AAEPvB,MAAAA,IAAI,EAAKL,EAAE,CAAC6B,QAFL;AAGPtB,MAAAA,OAAO,EAAC;AAHD,KAxDH;AA6DRuB,IAAAA,SAAS,EAAC;AACN,iBAAQ,IADF;AAENzB,MAAAA,IAAI,EAAEX,QAFA;AAGNa,MAAAA,OAAO,EAAC;AAHF;AA7DF,GAFP;AAsELwB,EAAAA,IAAI,EAAE,gBAAY;AACd,SAAKC,QAAL,GAAgB,CAAC,CAAjB;AACA,SAAKC,YAAL,GAAoB,EAApB,CAFc,CAEU;;AACxB,SAAKC,eAAL,GAAuB,IAAvB;AACA,SAAKC,UAAL,GAAkB,EAAlB;AACA,SAAKC,KAAL,GAAa,IAAb;AACA,SAAKC,SAAL,GAAiB,EAAjB;AACH,GA7EI;AA8ELC,EAAAA,MAAM,EAAE,kBAAY;AAChB,SAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKf,QAAL,CAAcgB,MAAlC,EAA0CD,CAAC,EAA3C,EAA+C;AAC3C,WAAKF,SAAL,CAAeI,IAAf,CAAoB,KAAKjB,QAAL,CAAce,CAAd,EAAiBG,IAAjB,CAAsBC,WAAtB,EAApB;AACH;;AACD,SAAKxB,UAAL,CAAgByB,MAAhB,GAAyB,KAAzB;AACA,SAAKjB,YAAL,CAAkBiB,MAAlB,GAA2B,KAA3B;AACA,SAAKvB,eAAL,CAAqBuB,MAArB,GAA8B,KAA9B;AACA,SAAKxB,SAAL,CAAeyB,YAAf,CAA4B,YAA5B,EAA0CC,cAA1C,GAA2D,IAA3D;AACA,SAAK5B,kBAAL,CAAwB0B,MAAxB,GAAiC,KAAjC;AACA,SAAKG,uBAAL;AACA,SAAKX,KAAL,GAAa,KAAKM,IAAL,CAAUG,YAAV,CAAuB/C,MAAvB,CAAb;AACA,SAAKsB,SAAL,CAAewB,MAAf,GAAwB,KAAxB,CAXgB,CAYhB;;AACA,SAAKhB,SAAL,GAAiB,IAAI5B,EAAE,CAAC6B,QAAP,CAAgB1C,KAAhB,CAAjB,CAbgB,CAehB;;AACA,SAAK2C,SAAL,GAAiB,IAAIpC,QAAJ,EAAjB;;AACA,QAAIsD,QAAQ,GAAG,KAAKlB,SAAL,CAAemB,cAAf,EAAf;;AACA,QAAIC,WAAW,GAAGF,QAAQ,CAACjC,KAA3B;AACA,QAAIA,KAAK,GAAG,IAAIxB,KAAJ,CAAU2D,WAAW,CAACC,EAAtB,EAAyBD,WAAW,CAACE,KAArC,EAA2CF,WAAW,CAACG,GAAvD,CAAZ;AACA,SAAKtC,KAAL,CAAW8B,YAAX,CAAwBzD,MAAxB,EAAgCkE,QAAhC,CAAyCvC,KAAzC,EApBgB,CAsBhB;;AACA,QAAIwC,KAAK,GAAGL,WAAW,CAACM,IAAxB;AACA,QAAIC,MAAM,GAAG,KAAK1C,KAAL,CAAW8B,YAAX,CAAwBzD,MAAxB,CAAb;AACAqE,IAAAA,MAAM,CAACC,UAAP,CAAkBH,KAAK,CAACf,MAAxB;;AACA,SAAK,IAAImB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGJ,KAAK,CAACf,MAA1B,EAAkCmB,CAAC,EAAnC,EAAuC;AACnC,UAAIC,CAAC,GAAGL,KAAK,CAACI,CAAD,CAAb;;AAEA,UAAIE,WAAW,GAAG,KAAKjC,SAAL,CAAekC,GAAf,EAAlB;;AACA,UAAG,CAACD,WAAJ,EAAgB;AAACA,QAAAA,WAAW,GAAG7D,EAAE,CAAC+D,WAAH,CAAe,KAAKzC,UAApB,CAAd;AAA+C;;AAEhE,UAAI0C,KAAK,GAAGH,WAAW,CAAChB,YAAZ,CAAyB1D,KAAzB,CAAZ;AAEA6E,MAAAA,KAAK,CAACC,OAAN,CAAcL,CAAd;AACAI,MAAAA,KAAK,CAACE,KAAN,GAAeP,CAAf;AACAK,MAAAA,KAAK,CAACG,QAAN,CAAeV,MAAf;AAEA,UAAIW,CAAC,GAAGX,MAAM,CAACY,eAAP,CAAuBL,KAAvB,CAAR;AACAA,MAAAA,KAAK,CAACtB,IAAN,CAAW4B,KAAX,GAAmB,CAACC,IAAI,CAACC,MAAL,KAAgB,GAAjB,IAAwB,EAA3C;AACAX,MAAAA,WAAW,CAACY,WAAZ,CAAwBL,CAAxB;AACA,WAAKnD,SAAL,CAAeyD,QAAf,CAAwBb,WAAxB;AACAJ,MAAAA,MAAM,CAACkB,QAAP,CAAgB,CAACd,WAAD,CAAhB;AAEH,KA5Ce,CA6ChB;AAEA;;;AACA,QAAIe,aAAa,GAAG5B,QAAQ,CAAChC,OAA7B;;AACA,SAAK,IAAI6D,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGD,aAAa,CAACpC,MAAlC,EAA0CqC,CAAC,EAA3C,EAA+C;AAC3C,UAAIC,YAAY,GAAGF,aAAa,CAACC,CAAD,CAAhC;AACA,UAAIE,MAAM,GAAG,IAAIvF,MAAJ,CAAWsF,YAAY,CAACZ,KAAxB,EAA8BY,YAAY,CAACE,WAA3C,EAAuDF,YAAY,CAACG,IAApE,EAAyEH,YAAY,CAACI,WAAtF,EAAkGJ,YAAY,CAACvB,KAA/G,CAAb;AACA,UAAI4B,OAAO,GAAG,KAAKnE,OAAL,CAAa+D,MAAM,CAACb,KAApB,EAA2BrB,YAA3B,CAAwCxD,OAAxC,CAAd;AACA8F,MAAAA,OAAO,CAACC,iBAAR,CAA0B,IAA1B;AACAD,MAAAA,OAAO,CAACE,SAAR,CAAkBN,MAAlB;AACH,KAvDe,CAwDhB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;AACA,SAAKrC,IAAL,CAAU4C,EAAV,CAAa,YAAb,EAA0B,KAAKC,WAA/B,EAA2C,IAA3C,EAlEgB,CAmEhB;AAEA;AACA;;AACA,QAAIC,YAAY,GAAG,KAAK1D,SAAL,CAAe2D,SAAf,EAAnB;;AACA,QAAIC,SAAS,GAAGF,YAAY,CAACG,IAA7B;AACA,SAAK3D,QAAL,GAAgBwD,YAAY,CAACtB,KAA7B;AACA,SAAK0B,WAAL,CAAiBJ,YAAY,CAACtB,KAA9B;;AACA,QAAGwB,SAAS,GAAC,CAAb,EAAe;AACX,WAAKG,YAAL,CAAkB,YAAY;AAC1B,aAAKC,aAAL;AACH,OAFiB,CAEhBC,IAFgB,CAEX,IAFW,CAAlB,EAEaL,SAFb;AAGH,KA/Ee,CAgFhB;;AACH,GA/JI;AAgKLM,EAAAA,KAAK,EAAC,iBAAU,CACZ;AACA;AACA;AACH,GApKI;AAqKLC,EAAAA,QAAQ,EAAC,oBAAU;AACfC,IAAAA,OAAO,CAACC,GAAR,CAAY,sBAAsB,KAAKnF,OAAL,CAAawB,MAA/C;AACH,GAvKI;AAyKL4D,EAAAA,mBAAmB,EAAC,+BAAU;AAC1B,QAAIZ,YAAY,GAAG,KAAK1D,SAAL,CAAe2D,SAAf,EAAnB;;AACA,QAAIvB,KAAK,GAAGsB,YAAY,CAACtB,KAAzB;;AACA,QAAGA,KAAK,KAAK,CAAb,EAAgB;AACZ,UAAGsB,YAAY,CAACnF,IAAb,KAAsBZ,UAAU,CAAC4G,IAApC,EAAyC;AACrC,aAAKP,aAAL;AACA;AACH;;AACD,WAAK1D,KAAL,CAAWkE,iBAAX;AACA,WAAKC,eAAL,CAAqBf,YAAY,CAACjC,KAAlC;;AACA,UAAGiC,YAAY,CAACgB,OAAhB,EAAwB;AAAC;AACrBxG,QAAAA,EAAE,CAACmG,GAAH,CAAO,cAAP;AACA,aAAKjF,kBAAL,CAAwB0B,MAAxB,GAAiC,IAAjC;AACA,aAAK5B,OAAL,CAAa,CAAb,EAAgB6B,YAAhB,CAA6BxD,OAA7B,EAAsCoH,aAAtC,CAAoD,KAAKxE,YAAzD;AACH,OAJD,MAIK;AACD,aAAK4D,YAAL,CAAkB,KAAKa,eAAvB,EAAuC,CAAvC;AACH;;AACD;AACH;;AACD,SAAKZ,aAAL;AAEH,GA9LI;;AA+LL;;;;AAIAA,EAAAA,aAAa,EAAC,uBAASa,UAAT,EAAoB;AAC9B;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA,SAAKC,mBAAL;;AAEA,QAAIpB,YAAY,GAAG,KAAK1D,SAAL,CAAe2D,SAAf,EAAnB,CAZ8B,CAc9B;;;AACA,QAAIvB,KAAK,GAAGsB,YAAY,CAACtB,KAAzB;AACA,SAAK2C,WAAL,CAAiB3C,KAAjB,EAhB8B,CAkB9B;;AACA,QAAI7D,IAAI,GAAGmF,YAAY,CAACnF,IAAxB;;AACA,YAAQA,IAAR;AACI,WAAKZ,UAAU,CAAC4G,IAAhB;AACI,aAAKS,QAAL,CAAc5C,KAAd,EAAoBsB,YAAY,CAACuB,UAAjC;AACA;;AACJ,WAAKtH,UAAU,CAACuH,OAAhB;AACI,aAAKC,WAAL,CAAiB/C,KAAjB,EAAuBsB,YAAY,CAACjC,KAApC,EAA0CiC,YAAY,CAAC0B,KAAvD,EAA6DP,UAA7D;AACA;AANR,KApB8B,CA6B9B;;;AACA,QAAIQ,KAAK,GAAG3B,YAAY,CAAC2B,KAAzB;;AACA,QAAGA,KAAH,EAAS;AACLC,MAAAA,UAAU,CAAC,YAAY;AACnB,aAAKhF,KAAL,CAAWiF,SAAX,CAAqBF,KAArB;AACH,OAFU,CAETpB,IAFS,CAEJ,IAFI,CAAD,EAEG,GAFH,CAAV;AAGH,KAnC6B,CAsC9B;;;AACA,QAAIuB,GAAG,GAAG9B,YAAY,CAAC8B,GAAvB;;AACA,QAAGA,GAAG,IAAI,IAAV,EAAe;AACX,UAAGA,GAAG,YAAYC,KAAlB,EAAwB;AACpB,aAAK,IAAI1C,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGyC,GAAG,CAAC9E,MAAxB,EAAgCqC,CAAC,EAAjC,EAAqC;AACjCuC,UAAAA,UAAU,CAAC,UAAU7E,CAAV,EAAa;AACpB,iBAAKiF,QAAL,CAAcjF,CAAd;AACH,WAFU,CAETwD,IAFS,CAEJ,IAFI,EAECuB,GAAG,CAACzC,CAAD,CAFJ,CAAD,EAEUA,CAAC,GAAI,IAFf,CAAV;AAGH;AACJ,OAND,MAMK;AACD,aAAK2C,QAAL,CAAcF,GAAd;AACH;AACJ,KAlD6B,CAoD9B;;;AACA,QAAG9B,YAAY,CAACiC,OAAhB,EAAwB;AACpBL,MAAAA,UAAU,CAAC,YAAY;AACnB,aAAK,IAAI7E,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKf,QAAL,CAAcgB,MAAlC,EAA0CD,CAAC,EAA3C,EAA+C;AAC3C,cAAImF,IAAI,GAAG,KAAKlG,QAAL,CAAce,CAAd,CAAX;AACAmF,UAAAA,IAAI,CAAChF,IAAL,CAAUiF,SAAV,CAAoB3H,EAAE,CAAC4H,MAAH,CAAU,GAAV,EAAc,CAAd,EAAgB,CAAC,GAAjB,CAApB;AACH;AACJ,OALU,CAKT7B,IALS,CAKJ,IALI,CAAD,EAKG,IALH,CAAV;AAMAqB,MAAAA,UAAU,CAAC,YAAY;AACnB,aAAKhF,KAAL,CAAWiF,SAAX,CAAqB1H,SAAS,CAACkI,GAA/B;AACA,aAAKzG,SAAL,CAAewB,MAAf,GAAwB,IAAxB;AACH,OAHU,CAGTmD,IAHS,CAGJ,IAHI,CAAD,EAGG,IAHH,CAAV;AAIH,KAXD,MAWK;AAED;AACA,WAAK/D,QAAL,GAAgBwD,YAAY,CAACsC,IAA7B;;AACA,UAAIC,UAAU,GAAG,KAAKjG,SAAL,CAAegG,IAAf,EAAjB;;AACA,UAAGC,UAAH,EAAc;AACV,aAAKnC,WAAL,CAAiBmC,UAAU,CAAC7D,KAA5B;AACAgC,QAAAA,OAAO,CAACC,GAAR,CAAY,gBAAgB6B,IAAI,CAACC,SAAL,CAAeF,UAAf,CAA5B;AACA,YAAIrC,SAAS,GAAGqC,UAAU,CAACpC,IAA3B;;AACA,YAAGD,SAAS,GAAC,CAAb,EAAe;AACX,eAAKG,YAAL,CAAkB,YAAY;AAC1B,iBAAKO,mBAAL;AACH,WAFiB,CAEhBL,IAFgB,CAEX,IAFW,CAAlB,EAEaL,SAFb;AAGH;AACJ;AACJ;AACJ,GAnRI;AAoRLH,EAAAA,WAAW,EAAC,qBAAS2C,KAAT,EAAe;AACvB,QAAIC,IAAI,GAAGD,KAAK,CAACE,WAAN,EAAX;AACA,QAAIpE,KAAK,GAAGmE,IAAI,CAACE,IAAjB;AACA,QAAIC,KAAK,GAAGtE,KAAK,CAACsE,KAAlB;;AACA,QAAGA,KAAK,YAAYlJ,MAApB,EAA2B;AACvB8G,MAAAA,OAAO,CAACC,GAAR,CAAY,uBAAZ;AACA;AACH;;AACD,QAAGmC,KAAK,YAAYjJ,OAApB,EAA4B;AACxB,UAAG,KAAKkJ,QAAL,EAAH,EAAmB;AACf,YAAG,KAAKC,kBAAL,CAAwBxE,KAAK,CAACqE,IAA9B,CAAH,EAAuC;AACnC,kBAAQF,IAAI,CAACD,KAAL,CAAW7H,IAAnB;AACI,iBAAKL,EAAE,CAACa,IAAH,CAAQ4H,SAAR,CAAkBC,WAAvB;AACI,mBAAKxG,eAAL,GAAuBiG,IAAI,CAACD,KAAL,CAAWS,WAAX,EAAvB;AACA;;AACJ,iBAAK3I,EAAE,CAACa,IAAH,CAAQ4H,SAAR,CAAkBG,UAAvB;AACI;;AACJ,iBAAK5I,EAAE,CAACa,IAAH,CAAQ4H,SAAR,CAAkBI,SAAvB;AACA,iBAAK7I,EAAE,CAACa,IAAH,CAAQ4H,SAAR,CAAkBK,YAAvB;AACI,kBAAG,KAAK5G,eAAR,EAAwB;AACpB,oBAAI6G,GAAG,GAAGZ,IAAI,CAACD,KAAL,CAAWS,WAAX,EAAV;;AACA,oBAAGI,GAAG,CAACC,CAAJ,GAAQ,KAAK9G,eAAL,CAAqB8G,CAA7B,GAAiC,EAApC,EAAuC;AACnC,uBAAKlD,aAAL,CAAmB9B,KAAK,CAACqE,IAAzB;AACArI,kBAAAA,EAAE,CAACmG,GAAH,CAAO,wBAAwBnC,KAAK,CAACqE,IAArC;AACH,iBAHD,MAGK;AACDrI,kBAAAA,EAAE,CAACmG,GAAH,CAAO,sBAAP;AACH;AACJ;;AACDnG,cAAAA,EAAE,CAACmG,GAAH,CAAO,WAAW6B,IAAI,CAACC,SAAL,CAAe,KAAK/F,eAApB,CAAX,GAAiD,IAAjD,GAAuD8F,IAAI,CAACC,SAAL,CAAec,GAAf,CAA9D;AACA;AAlBR;AAoBH,SArBD,MAqBK;AACD/I,UAAAA,EAAE,CAACmG,GAAH,CAAO,kBAAP;AACH;AACJ,OAzBD,MAyBK;AACDnG,QAAAA,EAAE,CAACmG,GAAH,CAAO,aAAP;AACH,OA5BuB,CA6BxB;;AACH,KAtCsB,CAuCvB;;AACH,GA5TI;AA8TL8C,EAAAA,SAAS,EAAE,qBAAY;AACnB/C,IAAAA,OAAO,CAACC,GAAR,CAAY,kBAAZ;AACAtG,IAAAA,WAAW,CAACqJ,UAAZ;AACH,GAjUI;AAmULC,EAAAA,WAAW,EAAE,uBAAY;AACrBjD,IAAAA,OAAO,CAACC,GAAR,CAAY,YAAZ;AACH,GArUI;AAuULiD,EAAAA,WAAW,EAAE,uBAAY;AACrBlD,IAAAA,OAAO,CAACC,GAAR,CAAY,YAAZ;AACH,GAzUI;AA2ULpD,EAAAA,uBAAuB,EAAC,mCAAU;AAC9B,QAAIsG,GAAG,GAAG,KAAKrI,OAAL,CAAawB,MAAvB;;AACA,SAAK,IAAID,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG8G,GAApB,EAAyB9G,CAAC,EAA1B,EAA8B;AAC1B,UAAI4C,OAAO,GAAG,KAAKnE,OAAL,CAAauB,CAAb,EAAgBM,YAAhB,CAA6B,SAA7B,CAAd;AACAsC,MAAAA,OAAO,CAACmE,YAAR,CAAqB,KAAKrI,SAA1B;AACH;AACJ,GAjVI;AAkVL2E,EAAAA,WAAW,EAAC,qBAAS1B,KAAT,EAAe;AACvBgC,IAAAA,OAAO,CAACC,GAAR,CAAY,kBAAkBjC,KAA9B;AACA,QAAIiB,OAAO,GAAG,KAAKnE,OAAL,CAAakD,KAAb,EAAoBrB,YAApB,CAAiCxD,OAAjC,CAAd;AACA8F,IAAAA,OAAO,CAACS,WAAR;AACH,GAtVI;AAuVLiB,EAAAA,WAAW,EAAC,qBAAS3C,KAAT,EAAe;AACvB,QAAIa,MAAM,GAAG,KAAK/D,OAAL,CAAakD,KAAb,CAAb;;AACA,QAAGa,MAAH,EAAU;AACN,UAAII,OAAO,GAAGJ,MAAM,CAAClC,YAAP,CAAoBxD,OAApB,CAAd;;AACA,UAAG0F,MAAH,EAAU;AACNI,QAAAA,OAAO,CAAC0B,WAAR;AACA;AACH;AACJ;;AACDX,IAAAA,OAAO,CAACC,GAAR,CAAY,wCAAwCjC,KAApD;AACH,GAjWI;AAkWLwC,EAAAA,eAAe,EAAC,2BAAU;AACtB,SAAKxF,kBAAL,CAAwB0B,MAAxB,GAAiC,IAAjC;AACH,GApWI;AAqWL4E,EAAAA,QAAQ,EAAC,kBAAStD,KAAT,EAAe;AACpB,QAAIoD,GAAG,GAAG,KAAK5F,UAAL,CAAgBwC,KAAhB,CAAV;;AACA,QAAGoD,GAAH,EAAO;AACH,UAAIiC,KAAK,GAAGjC,GAAG,CAACzE,YAAJ,CAAiB,aAAjB,CAAZ,CADG,CAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA0G,MAAAA,KAAK,CAACC,mBAAN,CAA0B,UAASC,UAAT,EAAoB;AAC1CnC,QAAAA,GAAG,CAAC1E,MAAJ,GAAa,KAAb,CAD0C,CAE1C;AACA;AACA;AACA;AACA;AACA;AACH,OARD,EAlBG,CA2BH;AACA;AACA;AACA;;AACAwE,MAAAA,UAAU,CAAC,YAAY;AACnBE,QAAAA,GAAG,CAAC1E,MAAJ,GAAa,IAAb;AACA2G,QAAAA,KAAK,CAACG,YAAN,CAAmB,CAAnB,EAAsB,WAAtB,EAAmC,KAAnC;AACH,OAHS,EAGR,IAHQ,CAAV;AAIH;AACJ,GA3YI;AA4YLC,EAAAA,gBAAgB,EAAC,0BAASC,IAAT,EAAc;AAC3B1D,IAAAA,OAAO,CAACC,GAAR,CAAY,sBAAsByD,IAAlC;AACA,QAAItC,GAAG,GAAG,KAAKjG,eAAf;;AACA,QAAGiG,GAAH,EAAO;AACH,UAAIiC,KAAK,GAAGjC,GAAG,CAACzE,YAAJ,CAAiB,aAAjB,CAAZ;AACA0G,MAAAA,KAAK,CAACC,mBAAN,CAA0B,UAASC,UAAT,EAAoB;AAC1CF,QAAAA,KAAK,CAACM,WAAN;AACAvC,QAAAA,GAAG,CAAC1E,MAAJ,GAAa,KAAb,CAF0C,CAI1C;AACA;AACA;AACA;AACA;AACA;AACH,OAVD;AAWAwE,MAAAA,UAAU,CAAC,YAAY;AACnBE,QAAAA,GAAG,CAAC1E,MAAJ,GAAa,IAAb;AACA2G,QAAAA,KAAK,CAACG,YAAN,CAAmB,CAAnB,EAAsBE,IAAtB,EAA4B,KAA5B;AACH,OAHS,EAGR,GAHQ,CAAV;AAIH;AACJ,GAjaI;AAkaLhD,EAAAA,mBAAmB,EAAC,+BAAU;AAC1B,SAAKkD,UAAL,CAAgB,KAAKpD,eAArB;AACA,SAAKxF,kBAAL,CAAwB0B,MAAxB,GAAiC,KAAjC;AACH,GAraI;AAsaLkE,EAAAA,QAAQ,EAAC,kBAAS5C,KAAT,EAAe6C,UAAf,EAA0B;AAC/Bb,IAAAA,OAAO,CAACC,GAAR,CAAY,cAAcjC,KAA1B;AACA,QAAIiB,OAAO,GAAG,KAAKnE,OAAL,CAAakD,KAAb,EAAoBrB,YAApB,CAAiCxD,OAAjC,CAAd;AACA8F,IAAAA,OAAO,CAAC4E,MAAR;;AACA,QAAGhD,UAAH,EAAc;AACV,UAAItD,MAAM,GAAG,KAAK1C,KAAL,CAAW8B,YAAX,CAAwBzD,MAAxB,CAAb;AACAqE,MAAAA,MAAM,CAACuG,UAAP;AACH;AACJ,GA9aI;AA+aL/C,EAAAA,WAAW,EAAC,qBAAS/C,KAAT,EAAe+F,YAAf,EAA4BC,SAA5B,EAAsCvD,UAAtC,EAAiD;AACzD,aAASwD,QAAT,CAAkBF,YAAlB,EAA+BtD,UAA/B,EAA0CyD,YAA1C,EAAuD;AACnDpK,MAAAA,EAAE,CAACmG,GAAH,CAAO,qBAAqBjC,KAArB,GAA4B,GAA5B,GAAkCyC,UAAzC;AACA,UAAI0D,CAAC,GAAGJ,YAAY,CAACzH,MAArB;;AACA,UAAG6H,CAAC,GAAG,CAAP,EAAS;AACL,YAAGJ,YAAY,CAAC,CAAD,CAAZ,YAA2B1C,KAA9B,EAAoC;AAChC,eAAK,IAAIhF,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG8H,CAApB,EAAuB9H,CAAC,EAAxB,EAA4B;AACxB,gBAAIgB,KAAK,GAAG0G,YAAY,CAAC1H,CAAD,CAAxB;;AACA,iBAAK,IAAIoB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGJ,KAAK,CAACf,MAA1B,EAAkCmB,CAAC,EAAnC,EAAuC;AACnC3D,cAAAA,EAAE,CAACmG,GAAH,CAAO,aAAaQ,UAAb,GAAyB,GAAzB,GAA+BpD,KAAK,CAACI,CAAD,CAA3C;;AACA,kBAAGJ,KAAK,CAACI,CAAD,CAAL,CAASR,EAAT,KAAgBwD,UAAU,CAACxD,EAA9B,EAAiC;AAC7B;AACA,oBAAGe,KAAK,KAAK,CAAb,EAAe;AACX,sBAAIiB,OAAO,GAAGiF,YAAY,CAACvH,YAAb,CAA0BxD,OAA1B,CAAd;;AACA,sBAAG8F,OAAO,CAACmF,YAAR,CAAqB/G,KAArB,CAAH,EAA+B;AAC3B,2BAAOA,KAAP;AACH;AACJ;AACJ;AACJ;AACJ;;AACDvD,UAAAA,EAAE,CAACuK,KAAH,CAAS,yBAAT;AACA,iBAAON,YAAY,CAAC,CAAD,CAAnB;AACH;AACJ;;AACD,aAAOA,YAAP;AACH;;AACD,QAAIG,YAAY,GAAG,KAAKpJ,OAAL,CAAakD,KAAb,CAAnB;AACA,QAAIX,KAAK,GAAG4G,QAAQ,CAACF,YAAD,EAActD,UAAd,EAAyByD,YAAzB,CAApB;AACA,QAAII,CAAC,GAAG,EAAR;;AACA,SAAK,IAAIjI,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGgB,KAAK,CAACf,MAA1B,EAAkCD,CAAC,EAAnC,EAAuC;AACnCiI,MAAAA,CAAC,IAAI,MAAKjH,KAAK,CAAChB,CAAD,CAAf;AACH;;AACD2D,IAAAA,OAAO,CAACC,GAAR,CAAY,iBAAiBjC,KAAjB,GAAwB,GAAxB,GAA6ByC,UAA7B,GAA0C,GAA1C,GAA+C6D,CAA3D;AACA,QAAI/G,MAAM,GAAG,KAAK1C,KAAL,CAAW8B,YAAX,CAAwBzD,MAAxB,CAAb;AACA,QAAIyE,WAAW,GAAGuG,YAAY,CAACvH,YAAb,CAA0BxD,OAA1B,EAAmCoL,SAAnC,CAA6ClH,KAA7C,CAAlB;;AAEA,QAAImH,aAAa,GAAG,SAAhBA,aAAgB,CAAUpJ,UAAV,EAAsB;AACtC;AACA,UAAI0C,KAAK,GAAG1C,UAAU,CAACuB,YAAX,CAAwB1D,KAAxB,CAAZ;AACA,UAAIkK,GAAG,GAAG5F,MAAM,CAACkH,OAAjB;AACA,UAAIzG,KAAK,GAAGF,KAAK,CAACE,KAAlB;AAEA,UAAIE,CAAC,GAAGX,MAAM,CAACY,eAAP,CAAuBL,KAAvB,CAAR;AACA,UAAI4G,QAAQ,GAAG,GAAf;AACA,UAAIC,SAAS,GAAG,IAAhB;AACAvJ,MAAAA,UAAU,CAACwJ,WAAX,CAAuB,GAAvB,EAA2B,CAA3B,EAA6B,CAA7B;AACAxJ,MAAAA,UAAU,CAACqG,SAAX,CAAqB3H,EAAE,CAAC+K,QAAH,CACjB/K,EAAE,CAACgL,KAAH,CACIhL,EAAE,CAACiL,MAAH,CAAUL,QAAV,EAAmBxG,CAAnB,CADJ,EAEIpE,EAAE,CAACkL,QAAH,CAAYN,QAAZ,EAAqB,CAArB,CAFJ,EAGI5K,EAAE,CAAC+K,QAAH,CACI/K,EAAE,CAACmL,OAAH,CAAWP,QAAQ,GAAC,CAApB,EAAsB,GAAtB,EAA0B,GAA1B,CADJ,EAEI5K,EAAE,CAACmL,OAAH,CAAWP,QAAQ,GAAC,CAApB,EAAsB,IAAtB,EAA2B,IAA3B,CAFJ,CAHJ,CADiB,EASjB5K,EAAE,CAACgL,KAAH,CACIhL,EAAE,CAACmL,OAAH,CAAWN,SAAX,EAAqB,IAArB,EAA0B,IAA1B,CADJ,EAEI7K,EAAE,CAACiL,MAAH,CAAUJ,SAAV,EAAoBzG,CAAC,CAACgH,CAAF,GAAM7G,IAAI,CAACC,MAAL,KAAgB,EAAhB,IAAsBN,KAAK,GAAG,CAACmF,GAAG,GAAC,CAAL,IAAQ,CAAtC,CAA1B,EAAoEjF,CAAC,CAAC4E,CAAF,GAAOzE,IAAI,CAACC,MAAL,KAAgB,EAA3F,CAFJ,EAGIxE,EAAE,CAACkL,QAAH,CAAYL,SAAZ,EAAuB,CAAC3G,KAAK,GAAG,CAACmF,GAAG,GAAG,CAAP,IAAU,CAAnB,IAAwB9E,IAAI,CAACC,MAAL,EAAxB,GAAwC,CAA/D,CAHJ,CATiB,CAArB;AAeH,KAzBD;;AA0BA,QAAI6E,GAAG,GAAGxF,WAAW,CAACrB,MAAtB;AACAiB,IAAAA,MAAM,CAACC,UAAP,CAAkB2F,GAAlB;AAEArJ,IAAAA,EAAE,CAACmG,GAAH,CAAO,kBAAmB,KAAKhE,UAA/B;AACA,SAAKR,YAAL,CAAkB0J,MAAlB,GAA2B,EAAE,KAAKlJ,UAAlC;AACA,SAAKR,YAAL,CAAkBiB,MAAlB,GAA2B,IAA3B;AACA,SAAKjB,YAAL,CAAkB2J,OAAlB,GAA4B,CAA5B;AACA,SAAK3J,YAAL,CAAkBgG,SAAlB,CAA4B3H,EAAE,CAAC+K,QAAH,CACxB/K,EAAE,CAACuL,IAAH,EADwB,EAExBvL,EAAE,CAAC0F,SAAH,CAAa,GAAb,CAFwB,EAGxB1F,EAAE,CAACwL,IAAH,EAHwB,EAIxBxL,EAAE,CAACgL,KAAH,CACIhL,EAAE,CAACmL,OAAH,CAAW,GAAX,EAAe,GAAf,EAAmB,GAAnB,CADJ,EAEInL,EAAE,CAACyL,MAAH,CAAU,GAAV,CAFJ,CAJwB,EAQxBzL,EAAE,CAACmL,OAAH,CAAW,GAAX,EAAe,CAAf,EAAiB,CAAjB,CARwB,EASxBnL,EAAE,CAAC0F,SAAH,CAAa,CAAb,CATwB,EAUxB1F,EAAE,CAAC0L,OAAH,CAAW,GAAX,CAVwB,EAWxB1L,EAAE,CAAC2L,QAAH,CAAY,UAAUC,MAAV,EAAkB;AAC1BA,MAAAA,MAAM,CAAChJ,MAAP,GAAgB,KAAhB;AACH,KAFD,EAEE,IAFF,CAXwB,CAA5B;;AAgBA,SAAK,IAAIiC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGwE,GAApB,EAAyBxE,CAAC,EAA1B,EAA8B;AAC1B,UAAIvD,UAAU,GAAGuC,WAAW,CAACgB,CAAD,CAA5B;AACA,UAAIb,KAAK,GAAG1C,UAAU,CAACuB,YAAX,CAAwB1D,KAAxB,CAAZ;AACA6E,MAAAA,KAAK,CAACE,KAAN,GAAeW,CAAf;AACAb,MAAAA,KAAK,CAACsE,KAAN,GAAc7E,MAAd;AACAnC,MAAAA,UAAU,CAAC+J,MAAX,GAAoB,EAAG,KAAKlJ,UAA5B;AACAnC,MAAAA,EAAE,CAACmG,GAAH,CAAO,gBAAiB,KAAKhE,UAA7B;AAEAuI,MAAAA,aAAa,CAACpJ,UAAD,CAAb,CAR0B,CAU1B;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACH;;AACDmC,IAAAA,MAAM,CAACkB,QAAP,CAAgBd,WAAhB;;AAGA,YAAQqG,SAAR;AACI,WAAKtK,SAAS,CAACiM,KAAf;AACI,aAAKlC,gBAAL,CAAsB,OAAtB;;AACA;;AACJ,WAAK/J,SAAS,CAACkM,QAAf;AACI,aAAKnC,gBAAL,CAAsB,UAAtB;;AACA;;AACJ,WAAK/J,SAAS,CAACmM,UAAf;AACI,aAAKpC,gBAAL,CAAsB,WAAtB;;AACA;;AACJ,WAAK/J,SAAS,CAACoM,YAAf;AACI,aAAKrC,gBAAL,CAAsB,YAAtB;;AACA;;AACJ,WAAK/J,SAAS,CAACqM,IAAf;AACA;AACI;AAfR,KA7GyD,CA8HzD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACH,GA7jBI;AA+jBL1F,EAAAA,eAAe,EAAC,yBAAShD,KAAT,EAAe;AAC3B,QAAI2I,MAAM,GAAG,EAAb;AACA,QAAIC,EAAE,GAAG5I,KAAK,CAACf,MAAf;;AACA,QAAG2J,EAAE,GAAG,CAAR,EAAW;AACP,UAAG5I,KAAK,CAAC,CAAD,CAAL,YAAoBgE,KAAvB,EAA6B;AACzB,aAAK,IAAI6E,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGD,EAApB,EAAwBC,CAAC,EAAzB,EAA6B;AACzBF,UAAAA,MAAM,CAACzJ,IAAP,CAAYc,KAAK,CAAC6I,CAAD,CAAjB;AACH;AACJ,OAJD,MAIK;AACDF,QAAAA,MAAM,CAACzJ,IAAP,CAAYc,KAAZ;AACH;AACJ,KARD,MAQM;AACF2I,MAAAA,MAAM,CAACzJ,IAAP,CAAYc,KAAZ;AACH;;AACD,SAAKtB,YAAL,GAAoBiK,MAApB;AACH,GA9kBI;AA+kBLG,EAAAA,qBAAqB,EAAC,+BAAShE,IAAT,EAAc;AAChC,QAAIiE,EAAE,GAAG,KAAKrK,YAAL,CAAkBO,MAA3B;;AACA,SAAK,IAAID,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG+J,EAApB,EAAwB/J,CAAC,EAAzB,EAA6B;AACzB,UAAIgB,KAAK,GAAG,KAAKtB,YAAL,CAAkBM,CAAlB,CAAZ;AACA,UAAIgK,EAAE,GAAGhJ,KAAK,CAACf,MAAf;;AACA,WAAK,IAAImB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG4I,EAApB,EAAwB5I,CAAC,EAAzB,EAA6B;AACzB,YAAGJ,KAAK,CAACI,CAAD,CAAL,CAASR,EAAT,KAAgBkF,IAAI,CAAClF,EAAxB,EAA2B;AACvB,iBAAO,IAAP;AACH;AACJ;AACJ;;AACD,WAAO,KAAP;AACH,GA3lBI;AA4lBLqJ,EAAAA,UAAU,EAAC,sBAAU;AACjB,QAAIlL,UAAU,GAAG,KAAKM,SAAL,CAAekC,GAAf,EAAjB;;AACA,QAAG,CAACxC,UAAJ,EAAe;AAACA,MAAAA,UAAU,GAAGtB,EAAE,CAAC+D,WAAH,CAAe,KAAKzC,UAApB,CAAb;AAA8C;;AAC9D,WAAOA,UAAP;AACH,GAhmBI;AAimBLiH,EAAAA,QAAQ,EAAC,oBAAY;AACjB,WAAO,KAAKvG,QAAL,KAAkB,CAAzB;AACH,GAnmBI;AAomBLwG,EAAAA,kBAAkB,EAAC,4BAAUH,IAAV,EAAgB;AAC/B,WAAO,KAAKgE,qBAAL,CAA2BhE,IAA3B,CAAP;AACH,GAtmBI;AAumBLoE,EAAAA,cAAc,EAAC,0BAAY;AACvB,SAAKtL,UAAL,CAAgByB,MAAhB,GAAyB,IAAzB;AACH;AAzmBI,CAAT","sourceRoot":"/","sourcesContent":["var PlayableState = require('PlayableState');\r\nvar PoolHandler = require(\"PoolHandler\");\r\nvar CCard = require(\"CCard\");\r\nvar CTable = require(\"CTable\");\r\nvar CPlayer = require(\"CPlayer\");\r\nvar {Card,Table,Player} = require(\"Types\");\r\nvar {ActionType,GameFake,SoundType,CardGroup} = require(\"GameFake\");\r\nvar PlayableAds = require(\"PlayableAds\");\r\nvar CAudio = require(\"CAudio\");\r\nvar Utility = require(\"Utility\");\r\n\r\ncc.Class({\r\n    extends   : cc.Component,\r\n    properties: {\r\n        playableState: {\r\n            default     : null,\r\n            type        : PlayableState,\r\n            serializable: false,\r\n            visible     : false\r\n        },\r\n        btnPlayNow   : cc.Button,\r\n        btnDump      : cc.Button,\r\n        btnPass      : cc.Button,\r\n        layerGame    : cc.Node,\r\n        layerAction  : cc.Node,\r\n        table:{\r\n            default:null,\r\n            type:cc.Node\r\n        },\r\n        players  : {\r\n            default: [],\r\n            type   : cc.Node\r\n        },\r\n        layerCard:{\r\n            default:null,\r\n            type:cc.Node\r\n        },\r\n        nodeSuggestGesture:{\r\n            default:null,\r\n            type:cc.Node\r\n        },\r\n        nodeCHPlay:{\r\n            default:null,\r\n            type:cc.Node\r\n        },\r\n        effectWin:{\r\n            default:null,\r\n            type:cc.Node\r\n        },\r\n        effectCardGroup:{\r\n            default:null,\r\n            type:cc.Node\r\n        },\r\n        cardPrefab: {\r\n            default: null,\r\n            type   : cc.Prefab\r\n        },\r\n        imgHands:{\r\n            default:[],\r\n            type:[cc.Sprite]\r\n        },\r\n        emoPlayers:{\r\n            default:[],\r\n            type:[cc.Node]\r\n        },\r\n        imgHighLight:{\r\n            default:null,\r\n            type:cc.Node\r\n        },\r\n        _poolCard: {\r\n            default: null,\r\n            type   : cc.NodePool,\r\n            visible:false\r\n        },\r\n        _gameFake:{\r\n            default:null,\r\n            type: GameFake,\r\n            visible:false\r\n        },\r\n    },\r\n\r\n    ctor: function () {\r\n        this.curIndex = -1;\r\n        this.groupExpects = []; //group cards\r\n        this.startPointTouch = null;\r\n        this.zIndexCard = 10;\r\n        this.audio = null;\r\n        this._posHands = [];\r\n    },\r\n    onLoad: function () {\r\n        for (var i = 0; i < this.imgHands.length; i++) {\r\n            this._posHands.push(this.imgHands[i].node.getPosition());\r\n        }\r\n        this.nodeCHPlay.active = false;\r\n        this.imgHighLight.active = false;\r\n        this.effectCardGroup.active = false;\r\n        this.effectWin.getComponent(\"CEffectWin\").gameController = this;\r\n        this.nodeSuggestGesture.active = false;\r\n        this.attachLayerCardToPlayer();\r\n        this.audio = this.node.getComponent(CAudio);\r\n        this.effectWin.active = false;\r\n        //1. khoi tao info ban dau\r\n        this._poolCard = new cc.NodePool(CCard);\r\n\r\n        //region khoi tao ban dau game\r\n        this._gameFake = new GameFake();\r\n        var gameInfo = this._gameFake.getDefaultInfo();\r\n        var tableConfig = gameInfo.table;\r\n        var table = new Table(tableConfig.id,tableConfig.stake,tableConfig.pot);\r\n        this.table.getComponent(CTable).setTable(table);\r\n\r\n        //create new Card on Dock\r\n        var cards = tableConfig.dock;\r\n        var cTable = this.table.getComponent(CTable);\r\n        cTable.setNumCard(cards.length);\r\n        for (var j = 0; j < cards.length; j++) {\r\n            var c = cards[j];\r\n\r\n            var cardPrefabs = this._poolCard.get();\r\n            if(!cardPrefabs){cardPrefabs = cc.instantiate(this.cardPrefab);}\r\n\r\n            var cCard = cardPrefabs.getComponent(CCard);\r\n\r\n            cCard.setCard(c);\r\n            cCard.index = (j);\r\n            cCard.setOwner(cTable);\r\n\r\n            var p = cTable.getPositionCard(cCard);\r\n            cCard.node.angle = (Math.random() - 0.5) * 40;\r\n            cardPrefabs.setPosition(p);\r\n            this.layerCard.addChild(cardPrefabs);\r\n            cTable.addCards([cardPrefabs]);\r\n\r\n        }\r\n        // cc.log(\"onEnable players:\" + this.players.length);\r\n\r\n        //update info avatar + load card\r\n        var playersConfig = gameInfo.players;\r\n        for (var k = 0; k < playersConfig.length; k++) {\r\n            var playerConfig = playersConfig[k];\r\n            var player = new Player(playerConfig.index,playerConfig.displayName,playerConfig.gold,playerConfig.avatarIndex,playerConfig.cards);\r\n            var cPlayer = this.players[player.index].getComponent(CPlayer);\r\n            cPlayer.setGameController(this);\r\n            cPlayer.setPlayer(player);\r\n        }\r\n        //load prefab cardPrefabs\r\n        // cc.loader.loadRes(\"prefabs/cardPrefab\", function (err, prefab) {\r\n        //     var newNode = cc.instantiate(prefab);\r\n        //     newNode.setPosition(100,100);\r\n        //     this.layerGame.addChild(newNode);\r\n        //     // cc.director.getScene().addChild(newNode);\r\n        // }.bind(this));\r\n        //endregion khoi tao ban dau game\r\n\r\n        //region add event touch card\r\n        this.node.on(\"card-touch\",this.onTouchCard,this);\r\n        //endregion add event touch card\r\n\r\n        //region execute action number 1\r\n        //enter turn + execute action\r\n        var actionConfig = this._gameFake.getAction();\r\n        var delayTime = actionConfig.time;\r\n        this.curIndex = actionConfig.index;\r\n        this.onEnterTurn(actionConfig.index);\r\n        if(delayTime>0){\r\n            this.scheduleOnce(function () {\r\n                this.executeAction();\r\n            }.bind(this),delayTime);\r\n        }\r\n        //endregion execute action number 1\r\n    },\r\n    start:function(){\r\n        // setTimeout(function () {\r\n        //     this.effectWin.active = true;\r\n        // }.bind(this),2000);\r\n    },\r\n    onEnable:function(){\r\n        console.log(\"onEnable players:\" + this.players.length);\r\n    },\r\n\r\n    beforeExecuteAction:function(){\r\n        var actionConfig = this._gameFake.getAction();\r\n        var index = actionConfig.index;\r\n        if(index === 0 ){\r\n            if(actionConfig.type === ActionType.PASS){\r\n                this.executeAction();\r\n                return;\r\n            }\r\n            this.audio.playSoundYourTurn();\r\n            this.setGroupExpects(actionConfig.cards);\r\n            if(actionConfig.suggest){//neu co suggest\r\n                cc.log(\"show suggest\");\r\n                this.nodeSuggestGesture.active = true;\r\n                this.players[0].getComponent(CPlayer).onSuggestCard(this.groupExpects);\r\n            }else{\r\n                this.scheduleOnce(this.autoShowSuggest,3);\r\n            }\r\n            return;\r\n        }\r\n        this.executeAction();\r\n\r\n    },\r\n    /**\r\n     *\r\n     * @param cardExpect {Card} card mong muon danh\r\n     */\r\n    executeAction:function(cardExpect){\r\n        //1. turn off viec suggest\r\n        //2. close turn\r\n        //3. discard | pass\r\n        //4. play sound\r\n        //5. play emo\r\n        //6. check ended game\r\n        //7. next action|next turn\r\n\r\n        //1. turn off viec suggest\r\n        this._turnOffAutoSuggest();\r\n\r\n        var actionConfig = this._gameFake.getAction();\r\n\r\n        //2. close turn\r\n        var index = actionConfig.index;\r\n        this.onCloseTurn(index);\r\n\r\n        //3. discard | pass\r\n        var type = actionConfig.type;\r\n        switch (type) {\r\n            case ActionType.PASS:\r\n                this.onPassAt(index,actionConfig.isNewRound);\r\n                break;\r\n            case ActionType.DISCARD:\r\n                this.onDiscardAt(index,actionConfig.cards,actionConfig.group,cardExpect);\r\n                break;\r\n        }\r\n\r\n        //4. play sound\r\n        var sound = actionConfig.sound;\r\n        if(sound){\r\n            setTimeout(function () {\r\n                this.audio.playAudio(sound);\r\n            }.bind(this),500);\r\n        }\r\n\r\n\r\n        //5. play emo\r\n        var emo = actionConfig.emo;\r\n        if(emo != null){\r\n            if(emo instanceof Array){\r\n                for (var k = 0; k < emo.length; k++) {\r\n                    setTimeout(function (i) {\r\n                        this._playEmo(i);\r\n                    }.bind(this,emo[k]),k  * 2000);\r\n                }\r\n            }else{\r\n                this._playEmo(emo);\r\n            }\r\n        }\r\n\r\n        //6. check ended game\r\n        if(actionConfig.isEnded){\r\n            setTimeout(function () {\r\n                for (var i = 0; i < this.imgHands.length; i++) {\r\n                    var hand = this.imgHands[i];\r\n                    hand.node.runAction(cc.moveBy(0.5,0,-300));\r\n                }\r\n            }.bind(this),1000);\r\n            setTimeout(function () {\r\n                this.audio.playAudio(SoundType.WIN);\r\n                this.effectWin.active = true;\r\n            }.bind(this),2500);\r\n        }else{\r\n\r\n            //7. next action|next turn\r\n            this.curIndex = actionConfig.next;\r\n            var actionNext = this._gameFake.next();\r\n            if(actionNext){\r\n                this.onEnterTurn(actionNext.index);\r\n                console.log(\"actionNext:\" + JSON.stringify(actionNext));\r\n                var delayTime = actionNext.time;\r\n                if(delayTime>0){\r\n                    this.scheduleOnce(function () {\r\n                        this.beforeExecuteAction();\r\n                    }.bind(this),delayTime);\r\n                }\r\n            }\r\n        }\r\n    },\r\n    onTouchCard:function(event){\r\n        var data = event.getUserData();\r\n        var cCard = data.card;\r\n        var owner = cCard.owner;\r\n        if(owner instanceof CTable){\r\n            console.log(\"passing card on table\");\r\n            return;\r\n        }\r\n        if(owner instanceof CPlayer){\r\n            if(this.isMyTurn()){\r\n                if(this.isTouchExpectCards(cCard.card)){\r\n                    switch (data.event.type) {\r\n                        case cc.Node.EventType.TOUCH_START:\r\n                            this.startPointTouch = data.event.getLocation();\r\n                            break;\r\n                        case cc.Node.EventType.TOUCH_MOVE:\r\n                            break;\r\n                        case cc.Node.EventType.TOUCH_END:\r\n                        case cc.Node.EventType.TOUCH_CANCEL:\r\n                            if(this.startPointTouch){\r\n                                var pos = data.event.getLocation();\r\n                                if(pos.y - this.startPointTouch.y > 45){\r\n                                    this.executeAction(cCard.card);\r\n                                    cc.log(\"Discard on my turn:\" + cCard.card);\r\n                                }else{\r\n                                    cc.log(\"!!Discard on my turn\");\r\n                                }\r\n                            }\r\n                            cc.log(\"touch:\" + JSON.stringify(this.startPointTouch) +\"| \"+ JSON.stringify(pos))\r\n                            break;\r\n                    }\r\n                }else{\r\n                    cc.log(\"not expects card\");\r\n                }\r\n            }else{\r\n                cc.log(\"not my turn\");\r\n            }\r\n            // owner.onTouchCard(data.event,data.card)\r\n        }\r\n        // console.log(\"onTouchCard at controler\");\r\n    },\r\n\r\n    onPlayNow: function () {\r\n        console.log(\"onPlay path main\");\r\n        PlayableAds.onCTAClick();\r\n    },\r\n\r\n    onTouchDump: function () {\r\n        console.log(\"touch Dump\");\r\n    },\r\n\r\n    onTouchPass: function () {\r\n        console.log(\"touch Pass\");\r\n    },\r\n\r\n    attachLayerCardToPlayer:function(){\r\n        var len = this.players.length;\r\n        for (var i = 0; i < len; i++) {\r\n            var cPlayer = this.players[i].getComponent(\"CPlayer\");\r\n            cPlayer.setLayerCard(this.layerCard);\r\n        }\r\n    },\r\n    onEnterTurn:function(index){\r\n        console.log(\"onEnterTurn: \" + index);\r\n        var cPlayer = this.players[index].getComponent(CPlayer);\r\n        cPlayer.onEnterTurn();\r\n    },\r\n    onCloseTurn:function(index){\r\n        var player = this.players[index];\r\n        if(player){\r\n            var cPlayer = player.getComponent(CPlayer);\r\n            if(player){\r\n                cPlayer.onCloseTurn();\r\n                return;\r\n            }\r\n        }\r\n        console.log(\"missing player or CPlayer at index:\" + index);\r\n    },\r\n    autoShowSuggest:function(){\r\n        this.nodeSuggestGesture.active = true;\r\n    },\r\n    _playEmo:function(index){\r\n        var emo = this.emoPlayers[index];\r\n        if(emo){\r\n            var spine = emo.getComponent('sp.Skeleton');\r\n            // spine.setStartListener(function(trackEntry){\r\n            //     var animationName = trackEntry.animation ? trackEntry.animation.name : \"\";\r\n            //     cc.log(\"[track %s][animation %s] start.\", trackEntry.trackIndex, animationName);\r\n            // });\r\n            // spine.setInterruptListener(function (trackEntry){\r\n            //     var animationName = trackEntry.animation ? trackEntry.animation.name : \"\";\r\n            //     cc.log(\"[track %s][animation %s] interrupt.\", trackEntry.trackIndex, animationName);\r\n            // });\r\n            // spine.setEndListener(function (trackEntry){\r\n            //     var animationName = trackEntry.animation ? trackEntry.animation.name : \"\";\r\n            //     cc.log(\"[track %s][animation %s] end.\", trackEntry.trackIndex, animationName);\r\n            // });\r\n            // spine.setDisposeListener(function (trackEntry){\r\n            //     var animationName = trackEntry.animation ? trackEntry.animation.name : \"\";\r\n            //     cc.log(\"[track %s][animation %s] will be disposed.\", trackEntry.trackIndex, animationName);\r\n            // });\r\n            spine.setCompleteListener(function(trackEntry){\r\n                emo.active = false;\r\n                // var animationName = trackEntry.animation ? trackEntry.animation.name : \"\";\r\n                // // if (animationName === 'shoot') {\r\n                // //     this.spine.clearTrack(1);\r\n                // // }\r\n                // var loopCount = Math.floor(trackEntry.trackTime / trackEntry.animationEnd);\r\n                // cc.log(\"[track %s][animation %s] complete: %s\", trackEntry.trackIndex, animationName, loopCount);\r\n            });\r\n            // spine.setEventListener(function(trackEntry, event){\r\n            //     var animationName = trackEntry.animation ? trackEntry.animation.name : \"\";\r\n            //     cc.log(\"[track %s][animation %s] event: %s, %s, %s, %s\", trackEntry.trackIndex, animationName, event.data.name, event.intValue, event.floatValue, event.stringValue);\r\n            // });\r\n            setTimeout(function () {\r\n                emo.active = true;\r\n                spine.setAnimation(0, 'animation', false);\r\n            },1000);\r\n        }\r\n    },\r\n    _playEffectGroup:function(name){\r\n        console.log(\"_playEffectGroup:\" + name);\r\n        var emo = this.effectCardGroup;\r\n        if(emo){\r\n            var spine = emo.getComponent('sp.Skeleton');\r\n            spine.setCompleteListener(function(trackEntry){\r\n                spine.clearTracks();\r\n                emo.active = false;\r\n\r\n                // var animationName = trackEntry.animation ? trackEntry.animation.name : \"\";\r\n                // // if (animationName === 'shoot') {\r\n                // //     this.spine.clearTrack(1);\r\n                // // }\r\n                // var loopCount = Math.floor(trackEntry.trackTime / trackEntry.animationEnd);\r\n                // cc.log(\"[track %s][animation %s] complete: %s\", trackEntry.trackIndex, animationName, loopCount);\r\n            });\r\n            setTimeout(function () {\r\n                emo.active = true;\r\n                spine.setAnimation(0, name, false);\r\n            },500);\r\n        }\r\n    },\r\n    _turnOffAutoSuggest:function(){\r\n        this.unschedule(this.autoShowSuggest);\r\n        this.nodeSuggestGesture.active = false;\r\n    },\r\n    onPassAt:function(index,isNewRound){\r\n        console.log(\"onPassAt:\" + index);\r\n        var cPlayer = this.players[index].getComponent(CPlayer);\r\n        cPlayer.onPass();\r\n        if(isNewRound){\r\n            var cTable = this.table.getComponent(CTable);\r\n            cTable.onNewRound();\r\n        }\r\n    },\r\n    onDiscardAt:function(index,cardsOrGroup,groupType,cardExpect){\r\n        function getCards(cardsOrGroup,cardExpect,playerPrefab){\r\n            cc.log(\"getCardsDicard: \" + index +\"|\" + cardExpect);\r\n            var l = cardsOrGroup.length;\r\n            if(l > 0){\r\n                if(cardsOrGroup[0] instanceof Array){\r\n                    for (var i = 0; i < l; i++) {\r\n                        var cards = cardsOrGroup[i];\r\n                        for (var j = 0; j < cards.length; j++) {\r\n                            cc.log(\"isgroup:\" + cardExpect +\"|\" + cards[j]);\r\n                            if(cards[j].id === cardExpect.id){\r\n                                //check xem co full card trong player\r\n                                if(index === 0){\r\n                                    var cPlayer = playerPrefab.getComponent(CPlayer);\r\n                                    if(cPlayer.isContainAll(cards)){\r\n                                        return cards;\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                    cc.error(\"not found card in group\");\r\n                    return cardsOrGroup[0];\r\n                }\r\n            }\r\n            return cardsOrGroup;\r\n        }\r\n        var playerPrefab = this.players[index];\r\n        var cards = getCards(cardsOrGroup,cardExpect,playerPrefab);\r\n        var s = '';\r\n        for (var i = 0; i < cards.length; i++) {\r\n            s += \" \"+ cards[i];\r\n        }\r\n        console.log(\"onDiscardAt:\" + index +\"|\"+ cardExpect + \"|\"+ s);\r\n        var cTable = this.table.getComponent(CTable);\r\n        var cardPrefabs = playerPrefab.getComponent(CPlayer).onDiscard(cards);\r\n\r\n        var effectDiscard = function (cardPrefab) {\r\n            //1. move den dock -> xoay lai 0 do -> nay bat ra ra 1 ti\r\n            var cCard = cardPrefab.getComponent(CCard);\r\n            var len = cTable.numCard;\r\n            var index = cCard.index;\r\n\r\n            var p = cTable.getPositionCard(cCard);\r\n            var duration = 0.3;\r\n            var duration1 = 0.15;\r\n            cardPrefab.setRotation(330,0,0);\r\n            cardPrefab.runAction(cc.sequence(\r\n                cc.spawn(\r\n                    cc.moveTo(duration,p),\r\n                    cc.rotateTo(duration,0),\r\n                    cc.sequence(\r\n                        cc.scaleTo(duration/2,1.1,1.1),\r\n                        cc.scaleTo(duration/2,0.85,0.85)\r\n                    )\r\n                ),\r\n                cc.spawn(\r\n                    cc.scaleTo(duration1,0.90,0.90),\r\n                    cc.moveTo(duration1,p.x+ (Math.random() * 30 * (index - (len-1)/2)),p.y + (Math.random() * 20)),\r\n                    cc.rotateTo(duration1, (index - (len - 1)/2) * Math.random() * 8)\r\n                )\r\n            ));\r\n        };\r\n        var len = cardPrefabs.length;\r\n        cTable.setNumCard(len);\r\n\r\n        cc.log(\"imgHighLight:\"  + this.zIndexCard);\r\n        this.imgHighLight.zIndex = ++this.zIndexCard;\r\n        this.imgHighLight.active = true;\r\n        this.imgHighLight.opacity = 0;\r\n        this.imgHighLight.runAction(cc.sequence(\r\n            cc.hide(),\r\n            cc.delayTime(0.4),\r\n            cc.show(),\r\n            cc.spawn(\r\n                cc.scaleTo(0.2,1.2,1.2),\r\n                cc.fadeIn(0.2)\r\n            ),\r\n            cc.scaleTo(0.2,1,1),\r\n            cc.delayTime(1),\r\n            cc.fadeOut(0.3),\r\n            cc.callFunc(function (sender) {\r\n                sender.active = false;\r\n            },this)\r\n        ));\r\n\r\n        for (var k = 0; k < len; k++) {\r\n            var cardPrefab = cardPrefabs[k];\r\n            var cCard = cardPrefab.getComponent(CCard);\r\n            cCard.index = (k);\r\n            cCard.owner = cTable;\r\n            cardPrefab.zIndex = ++ this.zIndexCard;\r\n            cc.log(\"cardPrefab:\"  + this.zIndexCard);\r\n\r\n            effectDiscard(cardPrefab);\r\n\r\n            // var p = cTable.getPositionCard(cCard);\r\n            // cardPrefab.runAction(cc.spawn(\r\n            //     cc.moveTo(0.15,p),\r\n            //     cc.rotateTo(1,0)\r\n            // ));\r\n            // cc.log(\"newZIndex:\" + this.zIndexCard);\r\n\r\n            //duoc add khi tao ra\r\n            // this.layerGame.addChild(cardPrefab);\r\n        }\r\n        cTable.addCards(cardPrefabs);\r\n\r\n\r\n        switch (groupType) {\r\n            case CardGroup.FLUSH:\r\n                this._playEffectGroup('flush');\r\n                break;\r\n            case CardGroup.STRAIGHT:\r\n                this._playEffectGroup('straight');\r\n                break;\r\n            case CardGroup.FULL_HOUSE:\r\n                this._playEffectGroup('fullhouse');\r\n                break;\r\n            case CardGroup.FOUR_OF_KIND:\r\n                this._playEffectGroup('forofakind');\r\n                break;\r\n            case CardGroup.NONE:\r\n            default:\r\n                break;\r\n        }\r\n        // for (var j = 0; j < cards.length; j++) {\r\n        //     var c = cards[j];\r\n        //\r\n        //     var cardPrefabs = this._poolCard.get();\r\n        //     if(!cardPrefabs){cardPrefabs = cc.instantiate(this.cardPrefab);}\r\n        //\r\n        //     var cCard = cardPrefabs.getComponent(CCard);\r\n        //\r\n        //     cCard.setCard(c);\r\n        //     cCard.index = (j);\r\n        //     cCard.owner = cTable;\r\n        //\r\n        //     var p = cTable.getPositionCard(cCard);\r\n        //     cardPrefabs.setPosition(p);\r\n        //     this.layerGame.addChild(cardPrefabs);\r\n        // }\r\n    },\r\n\r\n    setGroupExpects:function(cards){\r\n        var groups = [];\r\n        var lG = cards.length;\r\n        if(lG > 0) {\r\n            if(cards[0] instanceof Array){\r\n                for (var g = 0; g < lG; g++) {\r\n                    groups.push(cards[g])\r\n                }\r\n            }else{\r\n                groups.push(cards);\r\n            }\r\n        }else {\r\n            groups.push(cards);\r\n        }\r\n        this.groupExpects = groups;\r\n    },\r\n    isContainGroupExpects:function(card){\r\n        var lg = this.groupExpects.length;\r\n        for (var i = 0; i < lg; i++) {\r\n            var cards = this.groupExpects[i];\r\n            var lc = cards.length;\r\n            for (var j = 0; j < lc; j++) {\r\n                if(cards[j].id === card.id){\r\n                    return true;\r\n                }\r\n            }\r\n        }\r\n        return false;\r\n    },\r\n    getNewCard:function(){\r\n        var cardPrefab = this._poolCard.get();\r\n        if(!cardPrefab){cardPrefab = cc.instantiate(this.cardPrefab);}\r\n        return cardPrefab;\r\n    },\r\n    isMyTurn:function () {\r\n        return this.curIndex === 0;\r\n    },\r\n    isTouchExpectCards:function (card) {\r\n        return this.isContainGroupExpects(card);\r\n    },\r\n    showNodeCHPlay:function () {\r\n        this.nodeCHPlay.active = true;\r\n    }\r\n});"]}