{"version":3,"sources":["assets\\scripts\\CPlayer.js"],"names":["Types","require","CPlayer","cc","Class","Component","properties","avatar","Node","displayName","Label","gold","spriteAvatar","type","SpriteFrame","layerCard","imgPass","ctor","player","gameController","cards","onLoad","string","name","circleAvatar","getComponent","changeAvatar","_loadCards","console","error","active","node","on","onTouchCard","start","setGameController","setPlayer","updateUI","i","length","c","cardPrefab","getNewCard","cCard","setCard","index","setOwner","p","getPositionCard","r","getRotationCard","setPosition","angle","addChild","push","onDiscard","cardPrefabs","isContain","id","len","card","splice","k","getNumCard","getRotationVia","num","y","startX","endX","maxOffsetX","offset","getPositionVia","getCirclePos","Vec2","pos","x","onPass","runAction","sequence","delayTime","callFunc","bind","event","owner","EventType","TOUCH_START","TOUCH_MOVE","isDraging","getParent","convertToNodeSpaceAR","getLocation","TOUCH_END","isSelected","TOUCH_CANCEL","module","exports"],"mappings":"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","sourceRoot":"/","sourcesContent":["var Types = require(\"Types\");\r\nvar CPlayer = cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        avatar:cc.Node,\r\n        displayName:cc.Label,\r\n        gold:cc.Label,\r\n        spriteAvatar:{\r\n            default:[],\r\n            type:[cc.SpriteFrame]\r\n        },\r\n        layerCard:{\r\n            default:null,\r\n            type:cc.Node\r\n        },\r\n        imgPass:{\r\n            default:null,\r\n            type:cc.Node\r\n        }\r\n    },\r\n    ctor:function(){\r\n        /** @type {Player}*/\r\n        this.player = null;\r\n        /** @type {GameController}*/\r\n        this.gameController = null;\r\n        this.cards = [];\r\n    },\r\n    onLoad:function(){\r\n        if(this.player){\r\n            this.displayName.string = this.player.name;\r\n            this.gold.string = this.player.gold;\r\n\r\n            var circleAvatar = this.avatar.getComponent(\"CCircleAvatar\");\r\n            circleAvatar.changeAvatar(this.spriteAvatar[this.player.avatar]);\r\n\r\n            //loadCards\r\n            this._loadCards();\r\n        }else{\r\n            console.error(\"need load setPlayer info onLoad\");\r\n        }\r\n        if(this.imgPass){\r\n            this.imgPass.active = false;\r\n        }\r\n        this.node.on(\"card-touch\",this.onTouchCard,this);\r\n    },\r\n    start:function () {\r\n\r\n    },\r\n\r\n    // update (dt) {},\r\n\r\n    setGameController:function(gameController){\r\n        this.gameController = gameController;\r\n    },\r\n    setPlayer:function (player) {\r\n        this.player = player;\r\n    },\r\n    updateUI:function () {\r\n\r\n    },\r\n    _loadCards:function () {\r\n        if(this.gameController){\r\n            var cards = this.player.cards;\r\n            for (var i = 0; i < cards.length; i++) {\r\n                var c = cards[i];\r\n                var cardPrefab = this.gameController.getNewCard();\r\n                var cCard = cardPrefab.getComponent(\"CCard\");\r\n\r\n                cCard.setCard(c);\r\n                cCard.index = (i);\r\n                cCard.setOwner(this);\r\n\r\n                var p = this.getPositionCard(cCard);\r\n                var r = this.getRotationCard(cCard);\r\n                cardPrefab.setPosition(p);\r\n                cardPrefab.angle = (-r);\r\n                this.layerCard.addChild(cardPrefab);\r\n                this.cards.push(cardPrefab);\r\n            }\r\n        }else{\r\n            console.error(\"don't have GameControler in Player, so can't create newCard\");\r\n        }\r\n    },\r\n    onDiscard:function(cards){\r\n        var cardPrefabs = [];\r\n        if(this.player && this.player.index === 0){\r\n            var isContain = function (c) {\r\n                for (var i = 0; i < cards.length; i++) {\r\n                    if(c.id=== cards[i].id){\r\n                        return true;\r\n                    }\r\n                }\r\n                return false;\r\n            };\r\n            var len = this.cards.length;\r\n            for (var i = len - 1; i >= 0; i--) {\r\n                var cardPrefab = this.cards[i];\r\n                var cCard = cardPrefab.getComponent(\"CCard\");\r\n                if(isContain(cCard.card)){\r\n                    cardPrefabs.push(cardPrefab);\r\n                    this.cards.splice(i,1);\r\n                }\r\n            }\r\n        }else{\r\n            for (var k = 0; k < cards.length; k++) {\r\n                var cardPrefab = this.gameController.getNewCard();\r\n                var cCard = cardPrefab.getComponent(\"CCard\");\r\n                cCard.setCard(cards[k]);\r\n                cardPrefabs.push(cardPrefab);\r\n                this.layerCard.addChild(cardPrefab);\r\n            }\r\n        }\r\n        return cardPrefabs;\r\n\r\n    },\r\n\r\n    getNumCard:function(){\r\n        if(this.player){\r\n            return this.player.cards.length;\r\n        }\r\n        return 1;\r\n    },\r\n    getRotationCard:function (cCard) {\r\n        var index = cCard.index;\r\n        return this.getRotationVia(index);\r\n    },\r\n\r\n    getRotationVia:function(index){\r\n        var num = this.getNumCard();\r\n        var y = 0;\r\n        var startX = -60;\r\n        var endX = 48;\r\n        var maxOffsetX = 12;\r\n        var offset = (endX - startX) / (num - 1);\r\n        if(offset > maxOffsetX) offset = maxOffsetX;\r\n        //re-call startX;\r\n        startX = startX +  (endX - startX - (offset *(num - 1)))/2;\r\n        return startX + (offset * index);\r\n    },\r\n    /**\r\n     *\r\n     * @param cCard {CCard}\r\n     */\r\n    getPositionCard:function (cCard){\r\n        var index = cCard.index;\r\n        return this.getPositionVia(index);\r\n    },\r\n    getPositionVia:function(index){\r\n        var num = this.getNumCard();\r\n        var y = 0;\r\n        var startX = - 250;\r\n        var endX = 250;\r\n        var maxOffsetX = 5;\r\n        var offset = (endX - startX) / (num - 1);\r\n        if(offset > maxOffsetX) offset = maxOffsetX;\r\n        //re-call startX;\r\n        startX = startX +  (endX - startX - (offset *(num - 1)))/2;\r\n        return this.getCirclePos(new cc.Vec2(startX + (offset * index), y));\r\n    },\r\n    /**\r\n     *\r\n     * @param pos {cc.Vec2}\r\n     */\r\n    getCirclePos:function (pos) {\r\n        var x = pos.x;\r\n        pos.y = (-1/250*(x*x) - 280);\r\n        return pos;\r\n    },\r\n    onPass:function () {\r\n        if(this.imgPass){\r\n            this.imgPass.active = true;\r\n            this.node.runAction(cc.sequence(\r\n                cc.delayTime(2),\r\n                cc.callFunc(function () {\r\n                    this.imgPass.active = false;\r\n                }.bind(this))\r\n            ))\r\n        }\r\n    },\r\n    /**\r\n     *\r\n     * @param event {cc.EventTouch}\r\n     * @param card {Card}\r\n     */\r\n    onTouchCard:function (event,card,owner) {\r\n        switch (event.type) {\r\n            case cc.Node.EventType.TOUCH_START:\r\n                break;\r\n            case cc.Node.EventType.TOUCH_MOVE:\r\n                card.isDraging = true;\r\n                var pos = card.node.getParent().convertToNodeSpaceAR(event.getLocation());\r\n                card.node.setPosition(pos);\r\n                break;\r\n            case cc.Node.EventType.TOUCH_END:\r\n                card.isDraging = false;\r\n                card.isSelected = !card.isSelected;\r\n                card.node.setPosition(this.getPositionCard(card));\r\n                break;\r\n            case cc.Node.EventType.TOUCH_CANCEL:\r\n                card.isDraging = false;\r\n                card.node.setPosition(this.getPositionCard(card));\r\n                break;\r\n        }\r\n    }\r\n});\r\nmodule.exports = CPlayer;\r\n"]}