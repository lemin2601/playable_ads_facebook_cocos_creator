
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/scripts/CPlayer.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'c90b5cwF5ZKgbNi6oY6LKVY', 'CPlayer');
// scripts/CPlayer.js

"use strict";

var Types = require("Types");

var Utility = require("Utility");

var CPlayer = cc.Class({
  "extends": cc.Component,
  properties: {
    avatar: cc.Node,
    displayName: cc.Label,
    gold: cc.Label,
    spriteAvatar: {
      "default": [],
      type: [cc.SpriteFrame]
    },
    layerCard: {
      "default": null,
      type: cc.Node
    },
    imgPass: {
      "default": null,
      type: cc.Node
    },
    progressBar: {
      "default": null,
      type: cc.ProgressBar
    },
    headProgressBar: {
      "default": null,
      type: cc.ParticleSystem
    }
  },
  ctor: function ctor() {
    /** @type {Player}*/
    this.player = null;
    /** @type {GameController}*/

    this.gameController = null;
    /** @type {[cardPrefab]}*/

    this.cards = [];
    this._isMyTurn = false;
  },
  onLoad: function onLoad() {
    this.setMyTurn(this._isMyTurn);

    if (this.player) {
      this.displayName.string = this.player.name;
      this.gold.string = Utility.formatMoneyFull(this.player.gold); // var circleAvatar = this.avatar.getComponent("CCircleAvatar");
      // circleAvatar.changeAvatar(this.spriteAvatar[this.player.avatar]);
      //loadCards

      this._loadCards();
    } else {
      console.error("need load setPlayer info onLoad");
    }

    if (this.imgPass) {
      this.imgPass.active = false;
    }
  },
  start: function start() {},
  update: function update(dt) {
    if (this._isMyTurn) {
      var progressBar = this.progressBar;
      var progress = progressBar.progress;

      if (progress > 0) {
        progress -= dt * 0.1;
      }

      progressBar.progress = progress;
      var p = new cc.Vec2(0, 70);
      p = p.rotate(progress * 2 * 3.14);
      this.headProgressBar.node.setPosition(p);
    }
  },
  setGameController: function setGameController(gameController) {
    this.gameController = gameController;
  },
  setPlayer: function setPlayer(player) {
    this.player = player;
  },
  updateUI: function updateUI() {},
  _loadCards: function _loadCards() {
    if (this.gameController) {
      var cards = this.player.cards;

      for (var i = 0; i < cards.length; i++) {
        var c = cards[i];
        var cardPrefab = this.gameController.getNewCard();
        var cCard = cardPrefab.getComponent("CCard");
        cCard.setCard(c);
        cCard.index = i;
        cCard.setOwner(this);
        var p = this.getPositionCard(cCard);
        var r = this.getRotationCard(cCard);
        cardPrefab.setPosition(p);
        cardPrefab.angle = -r;
        this.layerCard.addChild(cardPrefab);
        this.cards.push(cardPrefab);
      }
    } else {
      console.error("don't have GameControler in Player, so can't create newCard");
    }
  },
  setLayerCard: function setLayerCard(layerCard) {
    this.layerCard = layerCard;
  },
  onDiscard: function onDiscard(cards) {
    this.setMyTurn(false);

    if (this.layerCard == null) {
      console.error("you need add layerCard to player beforeDiscard");
      return [];
    }

    var cardPrefabs = [];

    if (this.player && this.player.index === 0) {
      var isContain = function isContain(c) {
        for (var i = 0; i < cards.length; i++) {
          if (c.id === cards[i].id) {
            return true;
          }
        }

        return false;
      };

      var len = this.cards.length;

      for (var i = len - 1; i >= 0; i--) {
        var cardPrefab = this.cards[i];
        var cCard = cardPrefab.getComponent("CCard");

        if (isContain(cCard.card)) {
          cardPrefabs.unshift(cardPrefab);
          this.cards.splice(i, 1);
          this.player.cards.splice(i, 1);
        }
      }

      this._updatePosCards();
    } else {
      for (var k = 0; k < cards.length; k++) {
        var cardPrefab = this.gameController.getNewCard();
        var cCard = cardPrefab.getComponent("CCard");
        cCard.setCard(cards[k]);
        cardPrefab.angle = 0;
        cCard.setPositionCenter(this.node.getPosition());
        cardPrefabs.push(cardPrefab);
        this.layerCard.addChild(cardPrefab);
      }
    }

    return cardPrefabs;
  },
  _updatePosCards: function _updatePosCards() {
    console.log("_updatePosCards");

    if (this.gameController) {
      var cards = this.cards;

      for (var i = 0; i < cards.length; i++) {
        var cardPrefab = cards[i];
        var cCard = cardPrefab.getComponent("CCard");
        cCard.index = i;
        var p = this.getPositionCard(cCard);
        var r = this.getRotationCard(cCard);
        cardPrefab.setPosition(p);
        cardPrefab.angle = -r;
      }
    } else {
      console.error("don't have GameControler in Player, so can't create newCard");
    }
  },
  getNumCard: function getNumCard() {
    if (this.player) {
      return this.player.cards.length;
    }

    return 1;
  },
  getRotationCard: function getRotationCard(cCard) {
    var index = cCard.index;
    return this.getRotationVia(index);
  },
  getRotationVia: function getRotationVia(index) {
    var num = this.getNumCard();
    var y = 0;
    var startX = -60;
    var endX = 48;
    var maxOffsetX = 12;
    var offset = (endX - startX) / (num - 1);
    if (offset > maxOffsetX) offset = maxOffsetX; //re-call startX;

    startX = startX + (endX - startX - offset * (num - 1)) / 2;
    return startX + offset * index;
  },

  /**
   *
   * @param cCard {CCard}
   */
  getPositionCard: function getPositionCard(cCard) {
    var index = cCard.index;
    return this.getPositionVia(index);
  },
  getPositionVia: function getPositionVia(index) {
    var num = this.getNumCard();
    var y = 0;
    var startX = -250;
    var endX = 250;
    var maxOffsetX = 5;
    var offset = (endX - startX) / (num - 1);
    if (offset > maxOffsetX) offset = maxOffsetX; //re-call startX;

    startX = startX + (endX - startX - offset * (num - 1)) / 2;
    return this.getCirclePos(new cc.Vec2(startX + offset * index, y));
  },

  /**
   *
   * @param pos {cc.Vec2}
   */
  getCirclePos: function getCirclePos(pos) {
    var x = pos.x;
    pos.y = -1 / 250 * (x * x) - 450 + 120;
    return pos;
  },
  onPass: function onPass() {
    this.setMyTurn(false);

    if (this.imgPass) {
      this.imgPass.active = true;
      this.node.runAction(cc.sequence(cc.delayTime(2), cc.callFunc(function () {
        this.imgPass.active = false;
      }.bind(this))));
    }
  },

  /**
   *
   * @param event {cc.EventTouch}
   * @param card {Card}
   */
  onTouchCard: function onTouchCard(event, card, owner) {
    switch (event.type) {
      case cc.Node.EventType.TOUCH_START:
        break;

      case cc.Node.EventType.TOUCH_MOVE:
        card.isDraging = true;
        var pos = card.node.getParent().convertToNodeSpaceAR(event.getLocation());
        card.node.setPosition(pos);
        break;

      case cc.Node.EventType.TOUCH_END:
        card.isDraging = false;
        card.isSelected = !card.isSelected;
        card.node.setPosition(this.getPositionCard(card));
        break;

      case cc.Node.EventType.TOUCH_CANCEL:
        card.isDraging = false;
        card.node.setPosition(this.getPositionCard(card));
        break;
    }
  },
  onEnterTurn: function onEnterTurn() {
    if (this.player.index === 0) return;
    this.progressBar.progress = 1;
    this.setMyTurn(true);
  },
  setMyTurn: function setMyTurn(b) {
    this._isMyTurn = b;
    this.progressBar.node.active = b;
    var len = this.cards.length;

    for (var i = 0; i < len; i++) {
      var cardPrefab = this.cards[i];
      var cCard = cardPrefab.getComponent("CCard");
      cCard.setSuggest(true);
    }

    if (!b) {
      this.headProgressBar.stopSystem();
    } else {
      this.headProgressBar.resetSystem();
    }

    this.headProgressBar.active = b;
  },
  onSuggestCard: function onSuggestCard(cards) {
    var isContain = function isContain(card) {
      var l = cards.length;

      for (var i = 0; i < l; i++) {
        if (cards[i].id === card.id) {
          return true;
        }
      }

      return false;
    };

    var len = this.cards.length;

    for (var i = 0; i < len; i++) {
      var cardPrefab = this.cards[i];
      var cCard = cardPrefab.getComponent("CCard");
      cCard.setSuggest(isContain(cCard.card));
    }
  }
});
module.exports = CPlayer;

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcc2NyaXB0c1xcQ1BsYXllci5qcyJdLCJuYW1lcyI6WyJUeXBlcyIsInJlcXVpcmUiLCJVdGlsaXR5IiwiQ1BsYXllciIsImNjIiwiQ2xhc3MiLCJDb21wb25lbnQiLCJwcm9wZXJ0aWVzIiwiYXZhdGFyIiwiTm9kZSIsImRpc3BsYXlOYW1lIiwiTGFiZWwiLCJnb2xkIiwic3ByaXRlQXZhdGFyIiwidHlwZSIsIlNwcml0ZUZyYW1lIiwibGF5ZXJDYXJkIiwiaW1nUGFzcyIsInByb2dyZXNzQmFyIiwiUHJvZ3Jlc3NCYXIiLCJoZWFkUHJvZ3Jlc3NCYXIiLCJQYXJ0aWNsZVN5c3RlbSIsImN0b3IiLCJwbGF5ZXIiLCJnYW1lQ29udHJvbGxlciIsImNhcmRzIiwiX2lzTXlUdXJuIiwib25Mb2FkIiwic2V0TXlUdXJuIiwic3RyaW5nIiwibmFtZSIsImZvcm1hdE1vbmV5RnVsbCIsIl9sb2FkQ2FyZHMiLCJjb25zb2xlIiwiZXJyb3IiLCJhY3RpdmUiLCJzdGFydCIsInVwZGF0ZSIsImR0IiwicHJvZ3Jlc3MiLCJwIiwiVmVjMiIsInJvdGF0ZSIsIm5vZGUiLCJzZXRQb3NpdGlvbiIsInNldEdhbWVDb250cm9sbGVyIiwic2V0UGxheWVyIiwidXBkYXRlVUkiLCJpIiwibGVuZ3RoIiwiYyIsImNhcmRQcmVmYWIiLCJnZXROZXdDYXJkIiwiY0NhcmQiLCJnZXRDb21wb25lbnQiLCJzZXRDYXJkIiwiaW5kZXgiLCJzZXRPd25lciIsImdldFBvc2l0aW9uQ2FyZCIsInIiLCJnZXRSb3RhdGlvbkNhcmQiLCJhbmdsZSIsImFkZENoaWxkIiwicHVzaCIsInNldExheWVyQ2FyZCIsIm9uRGlzY2FyZCIsImNhcmRQcmVmYWJzIiwiaXNDb250YWluIiwiaWQiLCJsZW4iLCJjYXJkIiwidW5zaGlmdCIsInNwbGljZSIsIl91cGRhdGVQb3NDYXJkcyIsImsiLCJzZXRQb3NpdGlvbkNlbnRlciIsImdldFBvc2l0aW9uIiwibG9nIiwiZ2V0TnVtQ2FyZCIsImdldFJvdGF0aW9uVmlhIiwibnVtIiwieSIsInN0YXJ0WCIsImVuZFgiLCJtYXhPZmZzZXRYIiwib2Zmc2V0IiwiZ2V0UG9zaXRpb25WaWEiLCJnZXRDaXJjbGVQb3MiLCJwb3MiLCJ4Iiwib25QYXNzIiwicnVuQWN0aW9uIiwic2VxdWVuY2UiLCJkZWxheVRpbWUiLCJjYWxsRnVuYyIsImJpbmQiLCJvblRvdWNoQ2FyZCIsImV2ZW50Iiwib3duZXIiLCJFdmVudFR5cGUiLCJUT1VDSF9TVEFSVCIsIlRPVUNIX01PVkUiLCJpc0RyYWdpbmciLCJnZXRQYXJlbnQiLCJjb252ZXJ0VG9Ob2RlU3BhY2VBUiIsImdldExvY2F0aW9uIiwiVE9VQ0hfRU5EIiwiaXNTZWxlY3RlZCIsIlRPVUNIX0NBTkNFTCIsIm9uRW50ZXJUdXJuIiwiYiIsInNldFN1Z2dlc3QiLCJzdG9wU3lzdGVtIiwicmVzZXRTeXN0ZW0iLCJvblN1Z2dlc3RDYXJkIiwibCIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsSUFBSUEsS0FBSyxHQUFHQyxPQUFPLENBQUMsT0FBRCxDQUFuQjs7QUFDQSxJQUFJQyxPQUFPLEdBQUdELE9BQU8sQ0FBQyxTQUFELENBQXJCOztBQUVBLElBQUlFLE9BQU8sR0FBR0MsRUFBRSxDQUFDQyxLQUFILENBQVM7QUFDbkIsYUFBU0QsRUFBRSxDQUFDRSxTQURPO0FBR25CQyxFQUFBQSxVQUFVLEVBQUU7QUFDUkMsSUFBQUEsTUFBTSxFQUFDSixFQUFFLENBQUNLLElBREY7QUFFUkMsSUFBQUEsV0FBVyxFQUFDTixFQUFFLENBQUNPLEtBRlA7QUFHUkMsSUFBQUEsSUFBSSxFQUFDUixFQUFFLENBQUNPLEtBSEE7QUFJUkUsSUFBQUEsWUFBWSxFQUFDO0FBQ1QsaUJBQVEsRUFEQztBQUVUQyxNQUFBQSxJQUFJLEVBQUMsQ0FBQ1YsRUFBRSxDQUFDVyxXQUFKO0FBRkksS0FKTDtBQVFSQyxJQUFBQSxTQUFTLEVBQUM7QUFDTixpQkFBUSxJQURGO0FBRU5GLE1B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Q0o7QUF2U2tCLENBQVQsQ0FBZDtBQTBTQThDLE1BQU0sQ0FBQ0MsT0FBUCxHQUFpQmxILE9BQWpCIiwic291cmNlUm9vdCI6Ii8iLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgVHlwZXMgPSByZXF1aXJlKFwiVHlwZXNcIik7XHJcbnZhciBVdGlsaXR5ID0gcmVxdWlyZShcIlV0aWxpdHlcIik7XHJcblxyXG52YXIgQ1BsYXllciA9IGNjLkNsYXNzKHtcclxuICAgIGV4dGVuZHM6IGNjLkNvbXBvbmVudCxcclxuXHJcbiAgICBwcm9wZXJ0aWVzOiB7XHJcbiAgICAgICAgYXZhdGFyOmNjLk5vZGUsXHJcbiAgICAgICAgZGlzcGxheU5hbWU6Y2MuTGFiZWwsXHJcbiAgICAgICAgZ29sZDpjYy5MYWJlbCxcclxuICAgICAgICBzcHJpdGVBdmF0YXI6e1xyXG4gICAgICAgICAgICBkZWZhdWx0OltdLFxyXG4gICAgICAgICAgICB0eXBlOltjYy5TcHJpdGVGcmFtZV1cclxuICAgICAgICB9LFxyXG4gICAgICAgIGxheWVyQ2FyZDp7XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6bnVsbCxcclxuICAgICAgICAgICAgdHlwZTpjYy5Ob2RlXHJcbiAgICAgICAgfSxcclxuICAgICAgICBpbWdQYXNzOntcclxuICAgICAgICAgICAgZGVmYXVsdDpudWxsLFxyXG4gICAgICAgICAgICB0eXBlOmNjLk5vZGVcclxuICAgICAgICB9LFxyXG4gICAgICAgIHByb2dyZXNzQmFyOntcclxuICAgICAgICAgICAgZGVmYXVsdDpudWxsLFxyXG4gICAgICAgICAgICB0eXBlOmNjLlByb2dyZXNzQmFyXHJcbiAgICAgICAgfSxcclxuICAgICAgICBoZWFkUHJvZ3Jlc3NCYXI6e1xyXG4gICAgICAgICAgICBkZWZhdWx0Om51bGwsXHJcbiAgICAgICAgICAgIHR5cGU6Y2MuUGFydGljbGVTeXN0ZW1cclxuICAgICAgICB9XHJcbiAgICB9LFxyXG4gICAgY3RvcjpmdW5jdGlvbigpe1xyXG4gICAgICAgIC8qKiBAdHlwZSB7UGxheWVyfSovXHJcbiAgICAgICAgdGhpcy5wbGF5ZXIgPSBudWxsO1xyXG4gICAgICAgIC8qKiBAdHlwZSB7R2FtZUNvbnRyb2xsZXJ9Ki9cclxuICAgICAgICB0aGlzLmdhbWVDb250cm9sbGVyID0gbnVsbDtcclxuICAgICAgICAvKiogQHR5cGUge1tjYXJkUHJlZmFiXX0qL1xyXG4gICAgICAgIHRoaXMuY2FyZHMgPSBbXTtcclxuICAgICAgICB0aGlzLl9pc015VHVybiA9IGZhbHNlO1xyXG4gICAgfSxcclxuICAgIG9uTG9hZDpmdW5jdGlvbigpe1xyXG4gICAgICAgIHRoaXMuc2V0TXlUdXJuKHRoaXMuX2lzTXlUdXJuKTtcclxuICAgICAgICBpZih0aGlzLnBsYXllcil7XHJcbiAgICAgICAgICAgIHRoaXMuZGlzcGxheU5hbWUuc3RyaW5nID0gdGhpcy5wbGF5ZXIubmFtZTtcclxuICAgICAgICAgICAgdGhpcy5nb2xkLnN0cmluZyA9IFV0aWxpdHkuZm9ybWF0TW9uZXlGdWxsKHRoaXMucGxheWVyLmdvbGQpO1xyXG5cclxuICAgICAgICAgICAgLy8gdmFyIGNpcmNsZUF2YXRhciA9IHRoaXMuYXZhdGFyLmdldENvbXBvbmVudChcIkNDaXJjbGVBdmF0YXJcIik7XHJcbiAgICAgICAgICAgIC8vIGNpcmNsZUF2YXRhci5jaGFuZ2VBdmF0YXIodGhpcy5zcHJpdGVBdmF0YXJbdGhpcy5wbGF5ZXIuYXZhdGFyXSk7XHJcblxyXG4gICAgICAgICAgICAvL2xvYWRDYXJkc1xyXG4gICAgICAgICAgICB0aGlzLl9sb2FkQ2FyZHMoKTtcclxuICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIm5lZWQgbG9hZCBzZXRQbGF5ZXIgaW5mbyBvbkxvYWRcIik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKHRoaXMuaW1nUGFzcyl7XHJcbiAgICAgICAgICAgIHRoaXMuaW1nUGFzcy5hY3RpdmUgPSBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG4gICAgc3RhcnQ6ZnVuY3Rpb24gKCkge1xyXG5cclxuICAgIH0sXHJcblxyXG4gICAgdXBkYXRlIChkdCkge1xyXG4gICAgICAgIGlmKHRoaXMuX2lzTXlUdXJuKXtcclxuICAgICAgICAgICAgdmFyIHByb2dyZXNzQmFyID0gdGhpcy5wcm9ncmVzc0JhcjtcclxuICAgICAgICAgICAgdmFyIHByb2dyZXNzID0gcHJvZ3Jlc3NCYXIucHJvZ3Jlc3M7XHJcbiAgICAgICAgICAgIGlmKHByb2dyZXNzID4gMCl7XHJcbiAgICAgICAgICAgICAgICBwcm9ncmVzcyAtPSAoZHQgKiAwLjEpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHByb2dyZXNzQmFyLnByb2dyZXNzID0gcHJvZ3Jlc3M7XHJcblxyXG4gICAgICAgICAgICB2YXIgcCA9IG5ldyBjYy5WZWMyKDAsNzApO1xyXG4gICAgICAgICAgICBwID0gcC5yb3RhdGUocHJvZ3Jlc3MgKiAyICogMy4xNCk7XHJcbiAgICAgICAgICAgIHRoaXMuaGVhZFByb2dyZXNzQmFyLm5vZGUuc2V0UG9zaXRpb24ocCk7XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuXHJcbiAgICBzZXRHYW1lQ29udHJvbGxlcjpmdW5jdGlvbihnYW1lQ29udHJvbGxlcil7XHJcbiAgICAgICAgdGhpcy5nYW1lQ29udHJvbGxlciA9IGdhbWVDb250cm9sbGVyO1xyXG4gICAgfSxcclxuICAgIHNldFBsYXllcjpmdW5jdGlvbiAocGxheWVyKSB7XHJcbiAgICAgICAgdGhpcy5wbGF5ZXIgPSBwbGF5ZXI7XHJcbiAgICB9LFxyXG4gICAgdXBkYXRlVUk6ZnVuY3Rpb24gKCkge1xyXG5cclxuICAgIH0sXHJcbiAgICBfbG9hZENhcmRzOmZ1bmN0aW9uICgpIHtcclxuICAgICAgICBpZih0aGlzLmdhbWVDb250cm9sbGVyKXtcclxuICAgICAgICAgICAgdmFyIGNhcmRzID0gdGhpcy5wbGF5ZXIuY2FyZHM7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY2FyZHMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIHZhciBjID0gY2FyZHNbaV07XHJcbiAgICAgICAgICAgICAgICB2YXIgY2FyZFByZWZhYiA9IHRoaXMuZ2FtZUNvbnRyb2xsZXIuZ2V0TmV3Q2FyZCgpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGNDYXJkID0gY2FyZFByZWZhYi5nZXRDb21wb25lbnQoXCJDQ2FyZFwiKTtcclxuXHJcbiAgICAgICAgICAgICAgICBjQ2FyZC5zZXRDYXJkKGMpO1xyXG4gICAgICAgICAgICAgICAgY0NhcmQuaW5kZXggPSAoaSk7XHJcbiAgICAgICAgICAgICAgICBjQ2FyZC5zZXRPd25lcih0aGlzKTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgcCA9IHRoaXMuZ2V0UG9zaXRpb25DYXJkKGNDYXJkKTtcclxuICAgICAgICAgICAgICAgIHZhciByID0gdGhpcy5nZXRSb3RhdGlvbkNhcmQoY0NhcmQpO1xyXG4gICAgICAgICAgICAgICAgY2FyZFByZWZhYi5zZXRQb3NpdGlvbihwKTtcclxuICAgICAgICAgICAgICAgIGNhcmRQcmVmYWIuYW5nbGUgPSAoLXIpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5sYXllckNhcmQuYWRkQ2hpbGQoY2FyZFByZWZhYik7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNhcmRzLnB1c2goY2FyZFByZWZhYik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcihcImRvbid0IGhhdmUgR2FtZUNvbnRyb2xlciBpbiBQbGF5ZXIsIHNvIGNhbid0IGNyZWF0ZSBuZXdDYXJkXCIpO1xyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbiAgICBzZXRMYXllckNhcmQ6ZnVuY3Rpb24obGF5ZXJDYXJkKXtcclxuICAgICAgICB0aGlzLmxheWVyQ2FyZCA9IGxheWVyQ2FyZDtcclxuICAgIH0sXHJcbiAgICBvbkRpc2NhcmQ6ZnVuY3Rpb24oY2FyZHMpe1xyXG4gICAgICAgIHRoaXMuc2V0TXlUdXJuKGZhbHNlKTtcclxuICAgICAgICBpZih0aGlzLmxheWVyQ2FyZCA9PSBudWxsKXtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcihcInlvdSBuZWVkIGFkZCBsYXllckNhcmQgdG8gcGxheWVyIGJlZm9yZURpc2NhcmRcIik7XHJcbiAgICAgICAgICAgIHJldHVybiBbXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIGNhcmRQcmVmYWJzID0gW107XHJcbiAgICAgICAgaWYodGhpcy5wbGF5ZXIgJiYgdGhpcy5wbGF5ZXIuaW5kZXggPT09IDApe1xyXG4gICAgICAgICAgICB2YXIgaXNDb250YWluID0gZnVuY3Rpb24gKGMpIHtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY2FyZHMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBpZihjLmlkPT09IGNhcmRzW2ldLmlkKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB2YXIgbGVuID0gdGhpcy5jYXJkcy5sZW5ndGg7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSBsZW4gLSAxOyBpID49IDA7IGktLSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGNhcmRQcmVmYWIgPSB0aGlzLmNhcmRzW2ldO1xyXG4gICAgICAgICAgICAgICAgdmFyIGNDYXJkID0gY2FyZFByZWZhYi5nZXRDb21wb25lbnQoXCJDQ2FyZFwiKTtcclxuICAgICAgICAgICAgICAgIGlmKGlzQ29udGFpbihjQ2FyZC5jYXJkKSl7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FyZFByZWZhYnMudW5zaGlmdChjYXJkUHJlZmFiKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNhcmRzLnNwbGljZShpLDEpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGxheWVyLmNhcmRzLnNwbGljZShpLDEpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuX3VwZGF0ZVBvc0NhcmRzKCk7XHJcbiAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGsgPSAwOyBrIDwgY2FyZHMubGVuZ3RoOyBrKyspIHtcclxuICAgICAgICAgICAgICAgIHZhciBjYXJkUHJlZmFiID0gdGhpcy5nYW1lQ29udHJvbGxlci5nZXROZXdDYXJkKCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgY0NhcmQgPSBjYXJkUHJlZmFiLmdldENvbXBvbmVudChcIkNDYXJkXCIpO1xyXG4gICAgICAgICAgICAgICAgY0NhcmQuc2V0Q2FyZChjYXJkc1trXSk7XHJcbiAgICAgICAgICAgICAgICBjYXJkUHJlZmFiLmFuZ2xlID0gMDtcclxuICAgICAgICAgICAgICAgIGNDYXJkLnNldFBvc2l0aW9uQ2VudGVyKHRoaXMubm9kZS5nZXRQb3NpdGlvbigpKTtcclxuICAgICAgICAgICAgICAgIGNhcmRQcmVmYWJzLnB1c2goY2FyZFByZWZhYik7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmxheWVyQ2FyZC5hZGRDaGlsZChjYXJkUHJlZmFiKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gY2FyZFByZWZhYnM7XHJcbiAgICB9LFxyXG4gICAgX3VwZGF0ZVBvc0NhcmRzOmZ1bmN0aW9uKCl7XHJcbiAgICAgICAgY29uc29sZS5sb2coXCJfdXBkYXRlUG9zQ2FyZHNcIik7XHJcbiAgICAgICAgaWYodGhpcy5nYW1lQ29udHJvbGxlcil7XHJcbiAgICAgICAgICAgIHZhciBjYXJkcyA9IHRoaXMuY2FyZHM7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY2FyZHMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIHZhciBjYXJkUHJlZmFiID0gY2FyZHNbaV07XHJcbiAgICAgICAgICAgICAgICB2YXIgY0NhcmQgPSBjYXJkUHJlZmFiLmdldENvbXBvbmVudChcIkNDYXJkXCIpO1xyXG5cclxuICAgICAgICAgICAgICAgIGNDYXJkLmluZGV4ID0gKGkpO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBwID0gdGhpcy5nZXRQb3NpdGlvbkNhcmQoY0NhcmQpO1xyXG4gICAgICAgICAgICAgICAgdmFyIHIgPSB0aGlzLmdldFJvdGF0aW9uQ2FyZChjQ2FyZCk7XHJcbiAgICAgICAgICAgICAgICBjYXJkUHJlZmFiLnNldFBvc2l0aW9uKHApO1xyXG4gICAgICAgICAgICAgICAgY2FyZFByZWZhYi5hbmdsZSA9ICgtcik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcihcImRvbid0IGhhdmUgR2FtZUNvbnRyb2xlciBpbiBQbGF5ZXIsIHNvIGNhbid0IGNyZWF0ZSBuZXdDYXJkXCIpO1xyXG4gICAgICAgIH1cclxuICAgIH0sXHJcblxyXG4gICAgZ2V0TnVtQ2FyZDpmdW5jdGlvbigpe1xyXG4gICAgICAgIGlmKHRoaXMucGxheWVyKXtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMucGxheWVyLmNhcmRzLmxlbmd0aDtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIDE7XHJcbiAgICB9LFxyXG4gICAgZ2V0Um90YXRpb25DYXJkOmZ1bmN0aW9uIChjQ2FyZCkge1xyXG4gICAgICAgIHZhciBpbmRleCA9IGNDYXJkLmluZGV4O1xyXG4gICAgICAgIHJldHVybiB0aGlzLmdldFJvdGF0aW9uVmlhKGluZGV4KTtcclxuICAgIH0sXHJcblxyXG4gICAgZ2V0Um90YXRpb25WaWE6ZnVuY3Rpb24oaW5kZXgpe1xyXG4gICAgICAgIHZhciBudW0gPSB0aGlzLmdldE51bUNhcmQoKTtcclxuICAgICAgICB2YXIgeSA9IDA7XHJcbiAgICAgICAgdmFyIHN0YXJ0WCA9IC02MDtcclxuICAgICAgICB2YXIgZW5kWCA9IDQ4O1xyXG4gICAgICAgIHZhciBtYXhPZmZzZXRYID0gMTI7XHJcbiAgICAgICAgdmFyIG9mZnNldCA9IChlbmRYIC0gc3RhcnRYKSAvIChudW0gLSAxKTtcclxuICAgICAgICBpZihvZmZzZXQgPiBtYXhPZmZzZXRYKSBvZmZzZXQgPSBtYXhPZmZzZXRYO1xyXG4gICAgICAgIC8vcmUtY2FsbCBzdGFydFg7XHJcbiAgICAgICAgc3RhcnRYID0gc3RhcnRYICsgIChlbmRYIC0gc3RhcnRYIC0gKG9mZnNldCAqKG51bSAtIDEpKSkvMjtcclxuICAgICAgICByZXR1cm4gc3RhcnRYICsgKG9mZnNldCAqIGluZGV4KTtcclxuICAgIH0sXHJcbiAgICAvKipcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gY0NhcmQge0NDYXJkfVxyXG4gICAgICovXHJcbiAgICBnZXRQb3NpdGlvbkNhcmQ6ZnVuY3Rpb24gKGNDYXJkKXtcclxuICAgICAgICB2YXIgaW5kZXggPSBjQ2FyZC5pbmRleDtcclxuICAgICAgICByZXR1cm4gdGhpcy5nZXRQb3NpdGlvblZpYShpbmRleCk7XHJcbiAgICB9LFxyXG4gICAgZ2V0UG9zaXRpb25WaWE6ZnVuY3Rpb24oaW5kZXgpe1xyXG4gICAgICAgIHZhciBudW0gPSB0aGlzLmdldE51bUNhcmQoKTtcclxuICAgICAgICB2YXIgeSA9IDA7XHJcbiAgICAgICAgdmFyIHN0YXJ0WCA9IC0gMjUwO1xyXG4gICAgICAgIHZhciBlbmRYID0gMjUwO1xyXG4gICAgICAgIHZhciBtYXhPZmZzZXRYID0gNTtcclxuICAgICAgICB2YXIgb2Zmc2V0ID0gKGVuZFggLSBzdGFydFgpIC8gKG51bSAtIDEpO1xyXG4gICAgICAgIGlmKG9mZnNldCA+IG1heE9mZnNldFgpIG9mZnNldCA9IG1heE9mZnNldFg7XHJcbiAgICAgICAgLy9yZS1jYWxsIHN0YXJ0WDtcclxuICAgICAgICBzdGFydFggPSBzdGFydFggKyAgKGVuZFggLSBzdGFydFggLSAob2Zmc2V0ICoobnVtIC0gMSkpKS8yO1xyXG4gICAgICAgIHJldHVybiB0aGlzLmdldENpcmNsZVBvcyhuZXcgY2MuVmVjMihzdGFydFggKyAob2Zmc2V0ICogaW5kZXgpLCB5KSk7XHJcbiAgICB9LFxyXG4gICAgLyoqXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHBvcyB7Y2MuVmVjMn1cclxuICAgICAqL1xyXG4gICAgZ2V0Q2lyY2xlUG9zOmZ1bmN0aW9uIChwb3MpIHtcclxuICAgICAgICB2YXIgeCA9IHBvcy54O1xyXG4gICAgICAgIHBvcy55ID0gKC0xLzI1MCooeCp4KSAtIDQ1MCArIDEyMCk7XHJcbiAgICAgICAgcmV0dXJuIHBvcztcclxuICAgIH0sXHJcbiAgICBvblBhc3M6ZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHRoaXMuc2V0TXlUdXJuKGZhbHNlKTtcclxuICAgICAgICBpZih0aGlzLmltZ1Bhc3Mpe1xyXG4gICAgICAgICAgICB0aGlzLmltZ1Bhc3MuYWN0aXZlID0gdHJ1ZTtcclxuICAgICAgICAgICAgdGhpcy5ub2RlLnJ1bkFjdGlvbihjYy5zZXF1ZW5jZShcclxuICAgICAgICAgICAgICAgIGNjLmRlbGF5VGltZSgyKSxcclxuICAgICAgICAgICAgICAgIGNjLmNhbGxGdW5jKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmltZ1Bhc3MuYWN0aXZlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9LmJpbmQodGhpcykpXHJcbiAgICAgICAgICAgICkpXHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuICAgIC8qKlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBldmVudCB7Y2MuRXZlbnRUb3VjaH1cclxuICAgICAqIEBwYXJhbSBjYXJkIHtDYXJkfVxyXG4gICAgICovXHJcbiAgICBvblRvdWNoQ2FyZDpmdW5jdGlvbiAoZXZlbnQsY2FyZCxvd25lcikge1xyXG4gICAgICAgIHN3aXRjaCAoZXZlbnQudHlwZSkge1xyXG4gICAgICAgICAgICBjYXNlIGNjLk5vZGUuRXZlbnRUeXBlLlRPVUNIX1NUQVJUOlxyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgY2MuTm9kZS5FdmVudFR5cGUuVE9VQ0hfTU9WRTpcclxuICAgICAgICAgICAgICAgIGNhcmQuaXNEcmFnaW5nID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIHZhciBwb3MgPSBjYXJkLm5vZGUuZ2V0UGFyZW50KCkuY29udmVydFRvTm9kZVNwYWNlQVIoZXZlbnQuZ2V0TG9jYXRpb24oKSk7XHJcbiAgICAgICAgICAgICAgICBjYXJkLm5vZGUuc2V0UG9zaXRpb24ocG9zKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIGNjLk5vZGUuRXZlbnRUeXBlLlRPVUNIX0VORDpcclxuICAgICAgICAgICAgICAgIGNhcmQuaXNEcmFnaW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBjYXJkLmlzU2VsZWN0ZWQgPSAhY2FyZC5pc1NlbGVjdGVkO1xyXG4gICAgICAgICAgICAgICAgY2FyZC5ub2RlLnNldFBvc2l0aW9uKHRoaXMuZ2V0UG9zaXRpb25DYXJkKGNhcmQpKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIGNjLk5vZGUuRXZlbnRUeXBlLlRPVUNIX0NBTkNFTDpcclxuICAgICAgICAgICAgICAgIGNhcmQuaXNEcmFnaW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBjYXJkLm5vZGUuc2V0UG9zaXRpb24odGhpcy5nZXRQb3NpdGlvbkNhcmQoY2FyZCkpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuICAgIG9uRW50ZXJUdXJuOmZ1bmN0aW9uICgpIHtcclxuICAgICAgICBpZih0aGlzLnBsYXllci5pbmRleCA9PT0gMCkgcmV0dXJuO1xyXG4gICAgICAgIHRoaXMucHJvZ3Jlc3NCYXIucHJvZ3Jlc3MgPSAxO1xyXG4gICAgICAgIHRoaXMuc2V0TXlUdXJuKHRydWUpO1xyXG4gICAgfSxcclxuICAgIHNldE15VHVybjpmdW5jdGlvbiAoYikge1xyXG4gICAgICAgIHRoaXMuX2lzTXlUdXJuID0gYjtcclxuICAgICAgICB0aGlzLnByb2dyZXNzQmFyLm5vZGUuYWN0aXZlID0gYjtcclxuICAgICAgICB2YXIgbGVuID0gdGhpcy5jYXJkcy5sZW5ndGg7XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW47IGkrKykge1xyXG4gICAgICAgICAgICB2YXIgY2FyZFByZWZhYiA9IHRoaXMuY2FyZHNbaV07XHJcbiAgICAgICAgICAgIHZhciBjQ2FyZCA9IGNhcmRQcmVmYWIuZ2V0Q29tcG9uZW50KFwiQ0NhcmRcIik7XHJcbiAgICAgICAgICAgIGNDYXJkLnNldFN1Z2dlc3QodHJ1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKCFiKXtcclxuICAgICAgICAgICAgdGhpcy5oZWFkUHJvZ3Jlc3NCYXIuc3RvcFN5c3RlbSgpO1xyXG4gICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICB0aGlzLmhlYWRQcm9ncmVzc0Jhci5yZXNldFN5c3RlbSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmhlYWRQcm9ncmVzc0Jhci5hY3RpdmUgPSBiO1xyXG4gICAgfSxcclxuICAgIG9uU3VnZ2VzdENhcmQ6ZnVuY3Rpb24gKGNhcmRzKSB7XHJcbiAgICAgICAgdmFyIGlzQ29udGFpbiA9IGZ1bmN0aW9uIChjYXJkKSB7XHJcbiAgICAgICAgICAgIHZhciBsID0gY2FyZHMubGVuZ3RoO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGw7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgaWYoY2FyZHNbaV0uaWQgPT09IGNhcmQuaWQpe1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIHZhciBsZW4gPSB0aGlzLmNhcmRzLmxlbmd0aDtcclxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgaSsrKSB7XHJcbiAgICAgICAgICAgIHZhciBjYXJkUHJlZmFiID0gdGhpcy5jYXJkc1tpXTtcclxuICAgICAgICAgICAgdmFyIGNDYXJkID0gY2FyZFByZWZhYi5nZXRDb21wb25lbnQoXCJDQ2FyZFwiKTtcclxuICAgICAgICAgICAgY0NhcmQuc2V0U3VnZ2VzdChpc0NvbnRhaW4oY0NhcmQuY2FyZCkpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIFxyXG59KTtcclxubW9kdWxlLmV4cG9ydHMgPSBDUGxheWVyO1xyXG4iXX0=