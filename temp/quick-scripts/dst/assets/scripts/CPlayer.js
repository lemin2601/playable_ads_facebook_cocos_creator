
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/scripts/CPlayer.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'c90b5cwF5ZKgbNi6oY6LKVY', 'CPlayer');
// scripts/CPlayer.js

"use strict";

var Types = require("Types");

var Utility = require("Utility");

var CPlayer = cc.Class({
  "extends": cc.Component,
  properties: {
    avatar: cc.Node,
    displayName: cc.Label,
    gold: cc.Label,
    spriteAvatar: {
      "default": [],
      type: [cc.SpriteFrame]
    },
    layerCard: {
      "default": null,
      type: cc.Node
    },
    imgPass: {
      "default": null,
      type: cc.Node
    }
  },
  ctor: function ctor() {
    /** @type {Player}*/
    this.player = null;
    /** @type {GameController}*/

    this.gameController = null;
    this.cards = [];
  },
  onLoad: function onLoad() {
    if (this.player) {
      this.displayName.string = this.player.name;
      this.gold.string = Utility.formatMoney(this.player.gold);
      var circleAvatar = this.avatar.getComponent("CCircleAvatar");
      circleAvatar.changeAvatar(this.spriteAvatar[this.player.avatar]); //loadCards

      this._loadCards();
    } else {
      console.error("need load setPlayer info onLoad");
    }

    if (this.imgPass) {
      this.imgPass.active = false;
    }

    this.node.on("card-touch", this.onTouchCard, this);
  },
  start: function start() {},
  // update (dt) {},
  setGameController: function setGameController(gameController) {
    this.gameController = gameController;
  },
  setPlayer: function setPlayer(player) {
    this.player = player;
  },
  updateUI: function updateUI() {},
  _loadCards: function _loadCards() {
    if (this.gameController) {
      var cards = this.player.cards;

      for (var i = 0; i < cards.length; i++) {
        var c = cards[i];
        var cardPrefab = this.gameController.getNewCard();
        var cCard = cardPrefab.getComponent("CCard");
        cCard.setCard(c);
        cCard.index = i;
        cCard.setOwner(this);
        var p = this.getPositionCard(cCard);
        var r = this.getRotationCard(cCard);
        cardPrefab.setPosition(p);
        cardPrefab.angle = -r;
        this.layerCard.addChild(cardPrefab);
        this.cards.push(cardPrefab);
      }
    } else {
      console.error("don't have GameControler in Player, so can't create newCard");
    }
  },
  onDiscard: function onDiscard(cards) {
    var cardPrefabs = [];

    if (this.player && this.player.index === 0) {
      var isContain = function isContain(c) {
        for (var i = 0; i < cards.length; i++) {
          if (c.id === cards[i].id) {
            return true;
          }
        }

        return false;
      };

      var len = this.cards.length;

      for (var i = len - 1; i >= 0; i--) {
        var cardPrefab = this.cards[i];
        var cCard = cardPrefab.getComponent("CCard");

        if (isContain(cCard.card)) {
          cardPrefabs.unshift(cardPrefab);
          this.cards.splice(i, 1);
          this.player.cards.splice(i, 1);
        }
      }

      this._updatePosCards();
    } else {
      for (var k = 0; k < cards.length; k++) {
        var cardPrefab = this.gameController.getNewCard();
        var cCard = cardPrefab.getComponent("CCard");
        cCard.setCard(cards[k]);
        cardPrefab.angle = 0;
        cCard.setPositionCenter(this.node.getPosition());
        cardPrefabs.push(cardPrefab);
        this.layerCard.addChild(cardPrefab);
      }
    }

    return cardPrefabs;
  },
  _updatePosCards: function _updatePosCards() {
    console.log("_updatePosCards");

    if (this.gameController) {
      var cards = this.cards;

      for (var i = 0; i < cards.length; i++) {
        var cardPrefab = cards[i];
        var cCard = cardPrefab.getComponent("CCard");
        cCard.index = i;
        var p = this.getPositionCard(cCard);
        var r = this.getRotationCard(cCard);
        cardPrefab.setPosition(p);
        cardPrefab.angle = -r;
      }
    } else {
      console.error("don't have GameControler in Player, so can't create newCard");
    }
  },
  getNumCard: function getNumCard() {
    if (this.player) {
      return this.player.cards.length;
    }

    return 1;
  },
  getRotationCard: function getRotationCard(cCard) {
    var index = cCard.index;
    return this.getRotationVia(index);
  },
  getRotationVia: function getRotationVia(index) {
    var num = this.getNumCard();
    var y = 0;
    var startX = -60;
    var endX = 48;
    var maxOffsetX = 12;
    var offset = (endX - startX) / (num - 1);
    if (offset > maxOffsetX) offset = maxOffsetX; //re-call startX;

    startX = startX + (endX - startX - offset * (num - 1)) / 2;
    return startX + offset * index;
  },

  /**
   *
   * @param cCard {CCard}
   */
  getPositionCard: function getPositionCard(cCard) {
    var index = cCard.index;
    return this.getPositionVia(index);
  },
  getPositionVia: function getPositionVia(index) {
    var num = this.getNumCard();
    var y = 0;
    var startX = -250;
    var endX = 250;
    var maxOffsetX = 5;
    var offset = (endX - startX) / (num - 1);
    if (offset > maxOffsetX) offset = maxOffsetX; //re-call startX;

    startX = startX + (endX - startX - offset * (num - 1)) / 2;
    return this.getCirclePos(new cc.Vec2(startX + offset * index, y));
  },

  /**
   *
   * @param pos {cc.Vec2}
   */
  getCirclePos: function getCirclePos(pos) {
    var x = pos.x;
    pos.y = -1 / 250 * (x * x) - 280;
    return pos;
  },
  onPass: function onPass() {
    if (this.imgPass) {
      this.imgPass.active = true;
      this.node.runAction(cc.sequence(cc.delayTime(2), cc.callFunc(function () {
        this.imgPass.active = false;
      }.bind(this))));
    }
  },

  /**
   *
   * @param event {cc.EventTouch}
   * @param card {Card}
   */
  onTouchCard: function onTouchCard(event, card, owner) {
    switch (event.type) {
      case cc.Node.EventType.TOUCH_START:
        break;

      case cc.Node.EventType.TOUCH_MOVE:
        card.isDraging = true;
        var pos = card.node.getParent().convertToNodeSpaceAR(event.getLocation());
        card.node.setPosition(pos);
        break;

      case cc.Node.EventType.TOUCH_END:
        card.isDraging = false;
        card.isSelected = !card.isSelected;
        card.node.setPosition(this.getPositionCard(card));
        break;

      case cc.Node.EventType.TOUCH_CANCEL:
        card.isDraging = false;
        card.node.setPosition(this.getPositionCard(card));
        break;
    }
  }
});
module.exports = CPlayer;

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcc2NyaXB0c1xcQ1BsYXllci5qcyJdLCJuYW1lcyI6WyJUeXBlcyIsInJlcXVpcmUiLCJVdGlsaXR5IiwiQ1BsYXllciIsImNjIiwiQ2xhc3MiLCJDb21wb25lbnQiLCJwcm9wZXJ0aWVzIiwiYXZhdGFyIiwiTm9kZSIsImRpc3BsYXlOYW1lIiwiTGFiZWwiLCJnb2xkIiwic3ByaXRlQXZhdGFyIiwidHlwZSIsIlNwcml0ZUZyYW1lIiwibGF5ZXJDYXJkIiwiaW1nUGFzcyIsImN0b3IiLCJwbGF5ZXIiLCJnYW1lQ29udHJvbGxlciIsImNhcmRzIiwib25Mb2FkIiwic3RyaW5nIiwibmFtZSIsImZvcm1hdE1vbmV5IiwiY2lyY2xlQXZhdGFyIiwiZ2V0Q29tcG9uZW50IiwiY2hhbmdlQXZhdGFyIiwiX2xvYWRDYXJkcyIsImNvbnNvbGUiLCJlcnJvciIsImFjdGl2ZSIsIm5vZGUiLCJvbiIsIm9uVG91Y2hDYXJkIiwic3RhcnQiLCJzZXRHYW1lQ29udHJvbGxlciIsInNldFBsYXllciIsInVwZGF0ZVVJIiwiaSIsImxlbmd0aCIsImMiLCJjYXJkUHJlZmFiIiwiZ2V0TmV3Q2FyZCIsImNDYXJkIiwic2V0Q2FyZCIsImluZGV4Iiwic2V0T3duZXIiLCJwIiwiZ2V0UG9zaXRpb25DYXJkIiwiciIsImdldFJvdGF0aW9uQ2FyZCIsInNldFBvc2l0aW9uIiwiYW5nbGUiLCJhZGRDaGlsZCIsInB1c2giLCJvbkRpc2NhcmQiLCJjYXJkUHJlZmFicyIsImlzQ29udGFpbiIsImlkIiwibGVuIiwiY2FyZCIsInVuc2hpZnQiLCJzcGxpY2UiLCJfdXBkYXRlUG9zQ2FyZHMiLCJrIiwic2V0UG9zaXRpb25DZW50ZXIiLCJnZXRQb3NpdGlvbiIsImxvZyIsImdldE51bUNhcmQiLCJnZXRSb3RhdGlvblZpYSIsIm51bSIsInkiLCJzdGFydFgiLCJlbmRYIiwibWF4T2Zmc2V0WCIsIm9mZnNldCIsImdldFBvc2l0aW9uVmlhIiwiZ2V0Q2lyY2xlUG9zIiwiVmVjMiIsInBvcyIsIngiLCJvblBhc3MiLCJydW5BY3Rpb24iLCJzZXF1ZW5jZSIsImRlbGF5VGltZSIsImNhbGxGdW5jIiwiYmluZCIsImV2ZW50Iiwib3duZXIiLCJFdmVudFR5cGUiLCJUT1VDSF9TVEFSVCIsIlRPVUNIX01PVkUiLCJpc0RyYWdpbmciLCJnZXRQYXJlbnQiLCJjb252ZXJ0VG9Ob2RlU3BhY2VBUiIsImdldExvY2F0aW9uIiwiVE9VQ0hfRU5EIiwiaXNTZWxlY3RlZCIsIlRPVUNIX0NBTkNFTCIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsSUFBSUEsS0FBSyxHQUFHQyxPQUFPLENBQUMsT0FBRCxDQUFuQjs7QUFDQSxJQUFJQyxPQUFPLEdBQUdELE9BQU8sQ0FBQyxTQUFELENBQXJCOztBQUVBLElBQUlFLE9BQU8sR0FBR0MsRUFBRSxDQUFDQyxLQUFILENBQVM7QUFDbkIsYUFBU0QsRUFBRSxDQUFDRSxTQURPO0FBR25CQyxFQUFBQSxVQUFVLEVBQUU7QUFDUkMsSUFBQUEsTUFBTSxFQUFDSixFQUFFLENBQUNLLElBREY7QUFFUkMsSUFBQUEsV0FBVyxFQUFDTixFQUFFLENBQUNPLEtBRlA7QUFHUkMsSUFBQUEsSUFBSSxFQUFDUixFQUFFLENBQUNPLEtBSEE7QUFJUkUsSUFBQUEsWUFBWSxFQUFDO0FBQ1QsaUJBQVEsRUFEQztBQUVUQyxNQUFBQSxJQUFJLEVBQUMsQ0FBQ1YsRUFBRSxDQUFDVyxXQUFKO0FBRkksS0FKTDtBQVFSQyxJQUFBQSxTQUFTLEVBQUM7QUFDTixpQkFBUSxJQURGO0FBRU5GLE1BQUFBLElBQUksRUFBQ1YsRUFBRSxDQUFDSztBQUZGLEtBUkY7QUFZUlEsSUFBQUEsT0FBTyxFQUFDO0FBQ0osaUJBQVEsSUFESjtBQUVKSCxNQUFBQSxJQUFJLEVBQUNWLEVBQUUsQ0FBQ0s7QUFGSjtBQVpBLEdBSE87QUFvQm5CUyxFQUFBQSxJQUFJLEVBQUMsZ0JBQVU7QUFDWDtBQUNBLFNBQUtDLE1BQUwsR0FBYyxJQUFk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O0FBQ0FoQyxRQUFBQSxJQUFJLENBQUNxQyxVQUFMLEdBQWtCLENBQUNyQyxJQUFJLENBQUNxQyxVQUF4QjtBQUNBckMsUUFBQUEsSUFBSSxDQUFDN0IsSUFBTCxDQUFVb0IsV0FBVixDQUFzQixLQUFLSCxlQUFMLENBQXFCWSxJQUFyQixDQUF0QjtBQUNBOztBQUNKLFdBQUsxRCxFQUFFLENBQUNLLElBQUgsQ0FBUWtGLFNBQVIsQ0FBa0JTLFlBQXZCO0FBQ0l0QyxRQUFBQSxJQUFJLENBQUNnQyxTQUFMLEdBQWlCLEtBQWpCO0FBQ0FoQyxRQUFBQSxJQUFJLENBQUM3QixJQUFMLENBQVVvQixXQUFWLENBQXNCLEtBQUtILGVBQUwsQ0FBcUJZLElBQXJCLENBQXRCO0FBQ0E7QUFoQlI7QUFrQkg7QUFqT2tCLENBQVQsQ0FBZDtBQW1PQXVDLE1BQU0sQ0FBQ0MsT0FBUCxHQUFpQm5HLE9BQWpCIiwic291cmNlUm9vdCI6Ii8iLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgVHlwZXMgPSByZXF1aXJlKFwiVHlwZXNcIik7XHJcbnZhciBVdGlsaXR5ID0gcmVxdWlyZShcIlV0aWxpdHlcIik7XHJcblxyXG52YXIgQ1BsYXllciA9IGNjLkNsYXNzKHtcclxuICAgIGV4dGVuZHM6IGNjLkNvbXBvbmVudCxcclxuXHJcbiAgICBwcm9wZXJ0aWVzOiB7XHJcbiAgICAgICAgYXZhdGFyOmNjLk5vZGUsXHJcbiAgICAgICAgZGlzcGxheU5hbWU6Y2MuTGFiZWwsXHJcbiAgICAgICAgZ29sZDpjYy5MYWJlbCxcclxuICAgICAgICBzcHJpdGVBdmF0YXI6e1xyXG4gICAgICAgICAgICBkZWZhdWx0OltdLFxyXG4gICAgICAgICAgICB0eXBlOltjYy5TcHJpdGVGcmFtZV1cclxuICAgICAgICB9LFxyXG4gICAgICAgIGxheWVyQ2FyZDp7XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6bnVsbCxcclxuICAgICAgICAgICAgdHlwZTpjYy5Ob2RlXHJcbiAgICAgICAgfSxcclxuICAgICAgICBpbWdQYXNzOntcclxuICAgICAgICAgICAgZGVmYXVsdDpudWxsLFxyXG4gICAgICAgICAgICB0eXBlOmNjLk5vZGVcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG4gICAgY3RvcjpmdW5jdGlvbigpe1xyXG4gICAgICAgIC8qKiBAdHlwZSB7UGxheWVyfSovXHJcbiAgICAgICAgdGhpcy5wbGF5ZXIgPSBudWxsO1xyXG4gICAgICAgIC8qKiBAdHlwZSB7R2FtZUNvbnRyb2xsZXJ9Ki9cclxuICAgICAgICB0aGlzLmdhbWVDb250cm9sbGVyID0gbnVsbDtcclxuICAgICAgICB0aGlzLmNhcmRzID0gW107XHJcbiAgICB9LFxyXG4gICAgb25Mb2FkOmZ1bmN0aW9uKCl7XHJcbiAgICAgICAgaWYodGhpcy5wbGF5ZXIpe1xyXG4gICAgICAgICAgICB0aGlzLmRpc3BsYXlOYW1lLnN0cmluZyA9IHRoaXMucGxheWVyLm5hbWU7XHJcbiAgICAgICAgICAgIHRoaXMuZ29sZC5zdHJpbmcgPSBVdGlsaXR5LmZvcm1hdE1vbmV5KHRoaXMucGxheWVyLmdvbGQpO1xyXG5cclxuICAgICAgICAgICAgdmFyIGNpcmNsZUF2YXRhciA9IHRoaXMuYXZhdGFyLmdldENvbXBvbmVudChcIkNDaXJjbGVBdmF0YXJcIik7XHJcbiAgICAgICAgICAgIGNpcmNsZUF2YXRhci5jaGFuZ2VBdmF0YXIodGhpcy5zcHJpdGVBdmF0YXJbdGhpcy5wbGF5ZXIuYXZhdGFyXSk7XHJcblxyXG4gICAgICAgICAgICAvL2xvYWRDYXJkc1xyXG4gICAgICAgICAgICB0aGlzLl9sb2FkQ2FyZHMoKTtcclxuICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIm5lZWQgbG9hZCBzZXRQbGF5ZXIgaW5mbyBvbkxvYWRcIik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKHRoaXMuaW1nUGFzcyl7XHJcbiAgICAgICAgICAgIHRoaXMuaW1nUGFzcy5hY3RpdmUgPSBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5ub2RlLm9uKFwiY2FyZC10b3VjaFwiLHRoaXMub25Ub3VjaENhcmQsdGhpcyk7XHJcbiAgICB9LFxyXG4gICAgc3RhcnQ6ZnVuY3Rpb24gKCkge1xyXG5cclxuICAgIH0sXHJcblxyXG4gICAgLy8gdXBkYXRlIChkdCkge30sXHJcblxyXG4gICAgc2V0R2FtZUNvbnRyb2xsZXI6ZnVuY3Rpb24oZ2FtZUNvbnRyb2xsZXIpe1xyXG4gICAgICAgIHRoaXMuZ2FtZUNvbnRyb2xsZXIgPSBnYW1lQ29udHJvbGxlcjtcclxuICAgIH0sXHJcbiAgICBzZXRQbGF5ZXI6ZnVuY3Rpb24gKHBsYXllcikge1xyXG4gICAgICAgIHRoaXMucGxheWVyID0gcGxheWVyO1xyXG4gICAgfSxcclxuICAgIHVwZGF0ZVVJOmZ1bmN0aW9uICgpIHtcclxuXHJcbiAgICB9LFxyXG4gICAgX2xvYWRDYXJkczpmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaWYodGhpcy5nYW1lQ29udHJvbGxlcil7XHJcbiAgICAgICAgICAgIHZhciBjYXJkcyA9IHRoaXMucGxheWVyLmNhcmRzO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNhcmRzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgYyA9IGNhcmRzW2ldO1xyXG4gICAgICAgICAgICAgICAgdmFyIGNhcmRQcmVmYWIgPSB0aGlzLmdhbWVDb250cm9sbGVyLmdldE5ld0NhcmQoKTtcclxuICAgICAgICAgICAgICAgIHZhciBjQ2FyZCA9IGNhcmRQcmVmYWIuZ2V0Q29tcG9uZW50KFwiQ0NhcmRcIik7XHJcblxyXG4gICAgICAgICAgICAgICAgY0NhcmQuc2V0Q2FyZChjKTtcclxuICAgICAgICAgICAgICAgIGNDYXJkLmluZGV4ID0gKGkpO1xyXG4gICAgICAgICAgICAgICAgY0NhcmQuc2V0T3duZXIodGhpcyk7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHAgPSB0aGlzLmdldFBvc2l0aW9uQ2FyZChjQ2FyZCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgciA9IHRoaXMuZ2V0Um90YXRpb25DYXJkKGNDYXJkKTtcclxuICAgICAgICAgICAgICAgIGNhcmRQcmVmYWIuc2V0UG9zaXRpb24ocCk7XHJcbiAgICAgICAgICAgICAgICBjYXJkUHJlZmFiLmFuZ2xlID0gKC1yKTtcclxuICAgICAgICAgICAgICAgIHRoaXMubGF5ZXJDYXJkLmFkZENoaWxkKGNhcmRQcmVmYWIpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jYXJkcy5wdXNoKGNhcmRQcmVmYWIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJkb24ndCBoYXZlIEdhbWVDb250cm9sZXIgaW4gUGxheWVyLCBzbyBjYW4ndCBjcmVhdGUgbmV3Q2FyZFwiKTtcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG4gICAgb25EaXNjYXJkOmZ1bmN0aW9uKGNhcmRzKXtcclxuICAgICAgICB2YXIgY2FyZFByZWZhYnMgPSBbXTtcclxuICAgICAgICBpZih0aGlzLnBsYXllciAmJiB0aGlzLnBsYXllci5pbmRleCA9PT0gMCl7XHJcbiAgICAgICAgICAgIHZhciBpc0NvbnRhaW4gPSBmdW5jdGlvbiAoYykge1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjYXJkcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKGMuaWQ9PT0gY2FyZHNbaV0uaWQpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHZhciBsZW4gPSB0aGlzLmNhcmRzLmxlbmd0aDtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IGxlbiAtIDE7IGkgPj0gMDsgaS0tKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgY2FyZFByZWZhYiA9IHRoaXMuY2FyZHNbaV07XHJcbiAgICAgICAgICAgICAgICB2YXIgY0NhcmQgPSBjYXJkUHJlZmFiLmdldENvbXBvbmVudChcIkNDYXJkXCIpO1xyXG4gICAgICAgICAgICAgICAgaWYoaXNDb250YWluKGNDYXJkLmNhcmQpKXtcclxuICAgICAgICAgICAgICAgICAgICBjYXJkUHJlZmFicy51bnNoaWZ0KGNhcmRQcmVmYWIpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2FyZHMuc3BsaWNlKGksMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5ZXIuY2FyZHMuc3BsaWNlKGksMSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5fdXBkYXRlUG9zQ2FyZHMoKTtcclxuICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgZm9yICh2YXIgayA9IDA7IGsgPCBjYXJkcy5sZW5ndGg7IGsrKykge1xyXG4gICAgICAgICAgICAgICAgdmFyIGNhcmRQcmVmYWIgPSB0aGlzLmdhbWVDb250cm9sbGVyLmdldE5ld0NhcmQoKTtcclxuICAgICAgICAgICAgICAgIHZhciBjQ2FyZCA9IGNhcmRQcmVmYWIuZ2V0Q29tcG9uZW50KFwiQ0NhcmRcIik7XHJcbiAgICAgICAgICAgICAgICBjQ2FyZC5zZXRDYXJkKGNhcmRzW2tdKTtcclxuICAgICAgICAgICAgICAgIGNhcmRQcmVmYWIuYW5nbGUgPSAwO1xyXG4gICAgICAgICAgICAgICAgY0NhcmQuc2V0UG9zaXRpb25DZW50ZXIodGhpcy5ub2RlLmdldFBvc2l0aW9uKCkpO1xyXG4gICAgICAgICAgICAgICAgY2FyZFByZWZhYnMucHVzaChjYXJkUHJlZmFiKTtcclxuICAgICAgICAgICAgICAgIHRoaXMubGF5ZXJDYXJkLmFkZENoaWxkKGNhcmRQcmVmYWIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBjYXJkUHJlZmFicztcclxuICAgIH0sXHJcbiAgICBfdXBkYXRlUG9zQ2FyZHM6ZnVuY3Rpb24oKXtcclxuICAgICAgICBjb25zb2xlLmxvZyhcIl91cGRhdGVQb3NDYXJkc1wiKTtcclxuICAgICAgICBpZih0aGlzLmdhbWVDb250cm9sbGVyKXtcclxuICAgICAgICAgICAgdmFyIGNhcmRzID0gdGhpcy5jYXJkcztcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjYXJkcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgdmFyIGNhcmRQcmVmYWIgPSBjYXJkc1tpXTtcclxuICAgICAgICAgICAgICAgIHZhciBjQ2FyZCA9IGNhcmRQcmVmYWIuZ2V0Q29tcG9uZW50KFwiQ0NhcmRcIik7XHJcblxyXG4gICAgICAgICAgICAgICAgY0NhcmQuaW5kZXggPSAoaSk7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHAgPSB0aGlzLmdldFBvc2l0aW9uQ2FyZChjQ2FyZCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgciA9IHRoaXMuZ2V0Um90YXRpb25DYXJkKGNDYXJkKTtcclxuICAgICAgICAgICAgICAgIGNhcmRQcmVmYWIuc2V0UG9zaXRpb24ocCk7XHJcbiAgICAgICAgICAgICAgICBjYXJkUHJlZmFiLmFuZ2xlID0gKC1yKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiZG9uJ3QgaGF2ZSBHYW1lQ29udHJvbGVyIGluIFBsYXllciwgc28gY2FuJ3QgY3JlYXRlIG5ld0NhcmRcIik7XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuXHJcbiAgICBnZXROdW1DYXJkOmZ1bmN0aW9uKCl7XHJcbiAgICAgICAgaWYodGhpcy5wbGF5ZXIpe1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5wbGF5ZXIuY2FyZHMubGVuZ3RoO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gMTtcclxuICAgIH0sXHJcbiAgICBnZXRSb3RhdGlvbkNhcmQ6ZnVuY3Rpb24gKGNDYXJkKSB7XHJcbiAgICAgICAgdmFyIGluZGV4ID0gY0NhcmQuaW5kZXg7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0Um90YXRpb25WaWEoaW5kZXgpO1xyXG4gICAgfSxcclxuXHJcbiAgICBnZXRSb3RhdGlvblZpYTpmdW5jdGlvbihpbmRleCl7XHJcbiAgICAgICAgdmFyIG51bSA9IHRoaXMuZ2V0TnVtQ2FyZCgpO1xyXG4gICAgICAgIHZhciB5ID0gMDtcclxuICAgICAgICB2YXIgc3RhcnRYID0gLTYwO1xyXG4gICAgICAgIHZhciBlbmRYID0gNDg7XHJcbiAgICAgICAgdmFyIG1heE9mZnNldFggPSAxMjtcclxuICAgICAgICB2YXIgb2Zmc2V0ID0gKGVuZFggLSBzdGFydFgpIC8gKG51bSAtIDEpO1xyXG4gICAgICAgIGlmKG9mZnNldCA+IG1heE9mZnNldFgpIG9mZnNldCA9IG1heE9mZnNldFg7XHJcbiAgICAgICAgLy9yZS1jYWxsIHN0YXJ0WDtcclxuICAgICAgICBzdGFydFggPSBzdGFydFggKyAgKGVuZFggLSBzdGFydFggLSAob2Zmc2V0ICoobnVtIC0gMSkpKS8yO1xyXG4gICAgICAgIHJldHVybiBzdGFydFggKyAob2Zmc2V0ICogaW5kZXgpO1xyXG4gICAgfSxcclxuICAgIC8qKlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBjQ2FyZCB7Q0NhcmR9XHJcbiAgICAgKi9cclxuICAgIGdldFBvc2l0aW9uQ2FyZDpmdW5jdGlvbiAoY0NhcmQpe1xyXG4gICAgICAgIHZhciBpbmRleCA9IGNDYXJkLmluZGV4O1xyXG4gICAgICAgIHJldHVybiB0aGlzLmdldFBvc2l0aW9uVmlhKGluZGV4KTtcclxuICAgIH0sXHJcbiAgICBnZXRQb3NpdGlvblZpYTpmdW5jdGlvbihpbmRleCl7XHJcbiAgICAgICAgdmFyIG51bSA9IHRoaXMuZ2V0TnVtQ2FyZCgpO1xyXG4gICAgICAgIHZhciB5ID0gMDtcclxuICAgICAgICB2YXIgc3RhcnRYID0gLSAyNTA7XHJcbiAgICAgICAgdmFyIGVuZFggPSAyNTA7XHJcbiAgICAgICAgdmFyIG1heE9mZnNldFggPSA1O1xyXG4gICAgICAgIHZhciBvZmZzZXQgPSAoZW5kWCAtIHN0YXJ0WCkgLyAobnVtIC0gMSk7XHJcbiAgICAgICAgaWYob2Zmc2V0ID4gbWF4T2Zmc2V0WCkgb2Zmc2V0ID0gbWF4T2Zmc2V0WDtcclxuICAgICAgICAvL3JlLWNhbGwgc3RhcnRYO1xyXG4gICAgICAgIHN0YXJ0WCA9IHN0YXJ0WCArICAoZW5kWCAtIHN0YXJ0WCAtIChvZmZzZXQgKihudW0gLSAxKSkpLzI7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0Q2lyY2xlUG9zKG5ldyBjYy5WZWMyKHN0YXJ0WCArIChvZmZzZXQgKiBpbmRleCksIHkpKTtcclxuICAgIH0sXHJcbiAgICAvKipcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gcG9zIHtjYy5WZWMyfVxyXG4gICAgICovXHJcbiAgICBnZXRDaXJjbGVQb3M6ZnVuY3Rpb24gKHBvcykge1xyXG4gICAgICAgIHZhciB4ID0gcG9zLng7XHJcbiAgICAgICAgcG9zLnkgPSAoLTEvMjUwKih4KngpIC0gMjgwKTtcclxuICAgICAgICByZXR1cm4gcG9zO1xyXG4gICAgfSxcclxuICAgIG9uUGFzczpmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaWYodGhpcy5pbWdQYXNzKXtcclxuICAgICAgICAgICAgdGhpcy5pbWdQYXNzLmFjdGl2ZSA9IHRydWU7XHJcbiAgICAgICAgICAgIHRoaXMubm9kZS5ydW5BY3Rpb24oY2Muc2VxdWVuY2UoXHJcbiAgICAgICAgICAgICAgICBjYy5kZWxheVRpbWUoMiksXHJcbiAgICAgICAgICAgICAgICBjYy5jYWxsRnVuYyhmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbWdQYXNzLmFjdGl2ZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpKVxyXG4gICAgICAgICAgICApKVxyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbiAgICAvKipcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gZXZlbnQge2NjLkV2ZW50VG91Y2h9XHJcbiAgICAgKiBAcGFyYW0gY2FyZCB7Q2FyZH1cclxuICAgICAqL1xyXG4gICAgb25Ub3VjaENhcmQ6ZnVuY3Rpb24gKGV2ZW50LGNhcmQsb3duZXIpIHtcclxuICAgICAgICBzd2l0Y2ggKGV2ZW50LnR5cGUpIHtcclxuICAgICAgICAgICAgY2FzZSBjYy5Ob2RlLkV2ZW50VHlwZS5UT1VDSF9TVEFSVDpcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIGNjLk5vZGUuRXZlbnRUeXBlLlRPVUNIX01PVkU6XHJcbiAgICAgICAgICAgICAgICBjYXJkLmlzRHJhZ2luZyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB2YXIgcG9zID0gY2FyZC5ub2RlLmdldFBhcmVudCgpLmNvbnZlcnRUb05vZGVTcGFjZUFSKGV2ZW50LmdldExvY2F0aW9uKCkpO1xyXG4gICAgICAgICAgICAgICAgY2FyZC5ub2RlLnNldFBvc2l0aW9uKHBvcyk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBjYy5Ob2RlLkV2ZW50VHlwZS5UT1VDSF9FTkQ6XHJcbiAgICAgICAgICAgICAgICBjYXJkLmlzRHJhZ2luZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgY2FyZC5pc1NlbGVjdGVkID0gIWNhcmQuaXNTZWxlY3RlZDtcclxuICAgICAgICAgICAgICAgIGNhcmQubm9kZS5zZXRQb3NpdGlvbih0aGlzLmdldFBvc2l0aW9uQ2FyZChjYXJkKSk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBjYy5Ob2RlLkV2ZW50VHlwZS5UT1VDSF9DQU5DRUw6XHJcbiAgICAgICAgICAgICAgICBjYXJkLmlzRHJhZ2luZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgY2FyZC5ub2RlLnNldFBvc2l0aW9uKHRoaXMuZ2V0UG9zaXRpb25DYXJkKGNhcmQpKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufSk7XHJcbm1vZHVsZS5leHBvcnRzID0gQ1BsYXllcjtcclxuIl19