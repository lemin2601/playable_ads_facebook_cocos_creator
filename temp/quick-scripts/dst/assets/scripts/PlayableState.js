
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/scripts/PlayableState.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'd7e39F4OClL1IwzfB5UPkvI', 'PlayableState');
// scripts/PlayableState.js

"use strict";

var StateMachine = require('state-machine');

var visualize = require('state-machine-visualize');

var Transition = cc.Enum({
  PLAY: "play",
  ACTION1: "action1",
  ACTION2: 'action2',
  ACTION3: 'action3'
});
var State = cc.Enum({
  IDLE: "idle",
  STEP1: "step1",
  STEP2: "step2",
  STEP3: 'step3',
  FINISH: "finish"
});
var PlayableState = cc.Class({
  properties: {
    fsm: {
      "default": null,
      type: StateMachine,
      serializable: false,
      visible: false
    }
  },
  ctor: function ctor() {},
  load: function load() {
    this.fsm = new StateMachine({
      init: State.IDLE,
      transitions: [{
        name: Transition.PLAY,
        from: State.IDLE,
        to: State.STEP1
      }, {
        name: Transition.ACTION1,
        from: State.STEP1,
        to: State.STEP2
      }, {
        name: Transition.ACTION2,
        from: State.STEP2,
        to: State.STEP3
      }, {
        name: Transition.ACTION3,
        from: State.STEP3,
        to: State.FINISH
      }],
      methods: {
        onInvalidTransition: function onInvalidTransition(transition, from, to) {
          console.error("onInvalidTransition");
        },
        onPendingTransition: function onPendingTransition(transition, from, to) {
          console.error("onPendingTransition");
        },
        onBeforeMelt: function onBeforeMelt() {
          console.log('onEnter melted');
          return new Promise(function (resolve, reject) {
            setTimeout(function () {
              console.log('onEnter melted done');
              reject("abc");
            }, 200);
          });
        },
        onMelt: function onMelt() {
          console.log('I melted');
        },
        onFreeze: function onFreeze() {
          console.log('I froze');
        },
        onVaporize: function onVaporize() {
          console.log('I vaporized');
        },
        onCondense: function onCondense() {
          console.log('I condensed');
        }
      }
    });
    console.log("before" + this.fsm.state);

    try {
      this.fsm.melt();
    } catch (e) {
      console.log("catch day nef");
    }

    console.log("after" + this.fsm.state);
    setTimeout(function () {
      console.log("after1" + this.fsm.state);
      console.log(this.fsm.state);
    }.bind(this), 500);
    setTimeout(function () {
      console.log("continue meltd");
      this.fsm.melt(); // console.log("freeeze");
      // this.fsm.freeze();

      console.log(this.fsm.state);
    }.bind(this), 1000);
    this.fsm.freeze();
    console.log(this.fsm.state);
    console.log(visualize(this.fsm));
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9zY3JpcHRzL1BsYXlhYmxlU3RhdGUuanMiXSwibmFtZXMiOlsiU3RhdGVNYWNoaW5lIiwicmVxdWlyZSIsInZpc3VhbGl6ZSIsIlRyYW5zaXRpb24iLCJjYyIsIkVudW0iLCJQTEFZIiwiQUNUSU9OMSIsIkFDVElPTjIiLCJBQ1RJT04zIiwiU3RhdGUiLCJJRExFIiwiU1RFUDEiLCJTVEVQMiIsIlNURVAzIiwiRklOSVNIIiwiUGxheWFibGVTdGF0ZSIsIkNsYXNzIiwicHJvcGVydGllcyIsImZzbSIsInR5cGUiLCJzZXJpYWxpemFibGUiLCJ2aXNpYmxlIiwiY3RvciIsImxvYWQiLCJpbml0IiwidHJhbnNpdGlvbnMiLCJuYW1lIiwiZnJvbSIsInRvIiwibWV0aG9kcyIsIm9uSW52YWxpZFRyYW5zaXRpb24iLCJ0cmFuc2l0aW9uIiwiY29uc29sZSIsImVycm9yIiwib25QZW5kaW5nVHJhbnNpdGlvbiIsIm9uQmVmb3JlTWVsdCIsImxvZyIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0Iiwic2V0VGltZW91dCIsIm9uTWVsdCIsIm9uRnJlZXplIiwib25WYXBvcml6ZSIsIm9uQ29uZGVuc2UiLCJzdGF0ZSIsIm1lbHQiLCJlIiwiYmluZCIsImZyZWV6ZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxJQUFJQSxZQUFZLEdBQUdDLE9BQU8sQ0FBQyxlQUFELENBQTFCOztBQUNBLElBQUlDLFNBQVMsR0FBR0QsT0FBTyxDQUFDLHlCQUFELENBQXZCOztBQUNBLElBQUlFLFVBQVUsR0FBR0MsRUFBRSxDQUFDQyxJQUFILENBQVE7QUFDckJDLEVBQUFBLElBQUksRUFBSyxNQURZO0FBRXJCQyxFQUFBQSxPQUFPLEVBQUUsU0FGWTtBQUdyQkMsRUFBQUEsT0FBTyxFQUFFLFNBSFk7QUFJckJDLEVBQUFBLE9BQU8sRUFBRTtBQUpZLENBQVIsQ0FBakI7QUFNQSxJQUFJQyxLQUFLLEdBQUdOLEVBQUUsQ0FBQ0MsSUFBSCxDQUFR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LE9BQU8sQ0FBQ0ksR0FBUixDQUFZbkMsU0FBUyxDQUFDLEtBQUtpQixHQUFOLENBQXJCO0FBQ0g7QUExRHdCLENBQVQsQ0FBcEIiLCJzb3VyY2VSb290IjoiLyIsInNvdXJjZXNDb250ZW50IjpbInZhciBTdGF0ZU1hY2hpbmUgPSByZXF1aXJlKCdzdGF0ZS1tYWNoaW5lJyk7XHJcbnZhciB2aXN1YWxpemUgPSByZXF1aXJlKCdzdGF0ZS1tYWNoaW5lLXZpc3VhbGl6ZScpO1xyXG52YXIgVHJhbnNpdGlvbiA9IGNjLkVudW0oe1xyXG4gICAgUExBWSAgIDogXCJwbGF5XCIsXHJcbiAgICBBQ1RJT04xOiBcImFjdGlvbjFcIixcclxuICAgIEFDVElPTjI6ICdhY3Rpb24yJyxcclxuICAgIEFDVElPTjM6ICdhY3Rpb24zJ1xyXG59KTtcclxudmFyIFN0YXRlID0gY2MuRW51bSh7XHJcbiAgICBJRExFOlwiaWRsZVwiLFxyXG4gICAgU1RFUDE6XCJzdGVwMVwiLFxyXG4gICAgU1RFUDI6XCJzdGVwMlwiLFxyXG4gICAgU1RFUDM6J3N0ZXAzJyxcclxuICAgIEZJTklTSDpcImZpbmlzaFwiXHJcbn0pO1xyXG5cclxudmFyIFBsYXlhYmxlU3RhdGUgPSBjYy5DbGFzcyh7XHJcbiAgICBwcm9wZXJ0aWVzOiB7XHJcbiAgICAgICAgZnNtOiB7XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6bnVsbCxcclxuICAgICAgICAgICAgdHlwZTpTdGF0ZU1hY2hpbmUsXHJcbiAgICAgICAgICAgIHNlcmlhbGl6YWJsZTogZmFsc2UsXHJcbiAgICAgICAgICAgIHZpc2libGU6ZmFsc2VcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG4gICAgY3RvcjpmdW5jdGlvbiAoKSB7fSxcclxuICAgIGxvYWQ6ZnVuY3Rpb24gKCl7XHJcbiAgICAgICAgdGhpcy5mc20gPSBuZXcgU3RhdGVNYWNoaW5lKHtcclxuICAgICAgICAgICAgaW5pdDogU3RhdGUuSURMRSxcclxuICAgICAgICAgICAgdHJhbnNpdGlvbnM6IFtcclxuICAgICAgICAgICAgICAgIHtuYW1lOiBUcmFuc2l0aW9uLlBMQVksIGZyb206IFN0YXRlLklETEUsIHRvOiBTdGF0ZS5TVEVQMX0sXHJcbiAgICAgICAgICAgICAgICB7bmFtZTogVHJhbnNpdGlvbi5BQ1RJT04xLCBmcm9tOiBTdGF0ZS5TVEVQMSwgdG86IFN0YXRlLlNURVAyfSxcclxuICAgICAgICAgICAgICAgIHtuYW1lOiBUcmFuc2l0aW9uLkFDVElPTjIsIGZyb206IFN0YXRlLlNURVAyLCB0bzogU3RhdGUuU1RFUDN9LFxyXG4gICAgICAgICAgICAgICAge25hbWU6IFRyYW5zaXRpb24uQUNUSU9OMywgZnJvbTogU3RhdGUuU1RFUDMsIHRvOiBTdGF0ZS5GSU5JU0h9XHJcbiAgICAgICAgICAgIF0sXHJcbiAgICAgICAgICAgIG1ldGhvZHM6IHtcclxuICAgICAgICAgICAgICAgIG9uSW52YWxpZFRyYW5zaXRpb246IGZ1bmN0aW9uKHRyYW5zaXRpb24sIGZyb20sIHRvKSB7Y29uc29sZS5lcnJvcihcIm9uSW52YWxpZFRyYW5zaXRpb25cIik7fSxcclxuICAgICAgICAgICAgICAgIG9uUGVuZGluZ1RyYW5zaXRpb246IGZ1bmN0aW9uKHRyYW5zaXRpb24sIGZyb20sIHRvKSB7Y29uc29sZS5lcnJvcihcIm9uUGVuZGluZ1RyYW5zaXRpb25cIik7fSxcclxuICAgICAgICAgICAgICAgIG9uQmVmb3JlTWVsdDogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ29uRW50ZXIgbWVsdGVkJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdvbkVudGVyIG1lbHRlZCBkb25lJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoXCJhYmNcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sMjAwKTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIG9uTWVsdDogICAgIGZ1bmN0aW9uKCkgeyBjb25zb2xlLmxvZygnSSBtZWx0ZWQnKSAgICB9LFxyXG4gICAgICAgICAgICAgICAgb25GcmVlemU6ICAgZnVuY3Rpb24oKSB7IGNvbnNvbGUubG9nKCdJIGZyb3plJykgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBvblZhcG9yaXplOiBmdW5jdGlvbigpIHsgY29uc29sZS5sb2coJ0kgdmFwb3JpemVkJykgfSxcclxuICAgICAgICAgICAgICAgIG9uQ29uZGVuc2U6IGZ1bmN0aW9uKCkgeyBjb25zb2xlLmxvZygnSSBjb25kZW5zZWQnKSB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICBjb25zb2xlLmxvZyhcImJlZm9yZVwiK3RoaXMuZnNtLnN0YXRlKTtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICB0aGlzLmZzbS5tZWx0KCk7XHJcbiAgICAgICAgfWNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiY2F0Y2ggZGF5IG5lZlwiKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc29sZS5sb2coXCJhZnRlclwiK3RoaXMuZnNtLnN0YXRlKTtcclxuICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJhZnRlcjFcIit0aGlzLmZzbS5zdGF0ZSk7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHRoaXMuZnNtLnN0YXRlKTtcclxuICAgICAgICB9LmJpbmQodGhpcyksNTAwKTtcclxuICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJjb250aW51ZSBtZWx0ZFwiKTtcclxuICAgICAgICAgICAgdGhpcy5mc20ubWVsdCgpO1xyXG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhcImZyZWVlemVcIik7XHJcbiAgICAgICAgICAgIC8vIHRoaXMuZnNtLmZyZWV6ZSgpO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyh0aGlzLmZzbS5zdGF0ZSk7XHJcbiAgICAgICAgfS5iaW5kKHRoaXMpLDEwMDApO1xyXG4gICAgICAgIHRoaXMuZnNtLmZyZWV6ZSgpO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKHRoaXMuZnNtLnN0YXRlKTtcclxuICAgICAgICBjb25zb2xlLmxvZyh2aXN1YWxpemUodGhpcy5mc20pKTtcclxuICAgIH1cclxuXHJcbn0pOyJdfQ==