
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/scripts/Utility.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '03f42tN4dFFZ57ZmRNgSNMC', 'Utility');
// scripts/Utility.js

"use strict";

var Utility = {};
Utility.units = [{
  prefix: 'G',
  l: 12,
  div: 1000000000000
}, {
  prefix: 'B',
  l: 9,
  div: 1000000000
}, {
  prefix: 'M',
  l: 6,
  div: 1000000
}, {
  prefix: 'K',
  l: 4,
  div: 1000
}, {
  prefix: '',
  l: 3,
  div: 1
}];
/**
 *
 * @param money
 * @param unit
 * @param separator
 * @returns {*}
 */

Utility.formatMoney = function (money, unit, separator) {
  if (unit === undefined) unit = "";
  return unit + Utility.formatAlignNumber(money, separator);
};
/**
 *
 * @param money
 * @param unit
 * @param separator
 * @returns {*}
 */


Utility.formatMoneyFull = function (money, unit, separator) {
  if (unit === undefined) unit = "";
  return unit + Utility.formatAlignNumber(money, separator, true);
};
/**
 *
 * @param number
 * @param separator
 * @param isFull
 * @returns {*}
 */


Utility.formatAlignNumber = function (number, separator, isFull) {
  if (number === undefined) return "0";
  number -= -0.1; //magic

  if (separator === undefined) {
    separator = ",";
  }

  if (isFull === undefined) {
    isFull = false;
  }

  var isNegative = number < 0;
  number = Math.abs(Math.round(number));
  var numString = number.toString();

  if (isFull) {
    var curIndex = numString.length - 3;

    while (curIndex > 0) {
      numString = numString.slice(0, curIndex) + separator + numString.slice(curIndex); // numString = numString.insertAt(curIndex, separator);

      curIndex -= 3;
    }
  } else {
    var units = Utility.units;

    for (var i = 0, length = units.length; i < length; ++i) {
      if (numString.length > units[i].l) {
        var tmpNumArr = (number / units[i].div).toString().split('.');
        var fixedLength = tmpNumArr[0].length > 2 ? 1 : 2; // insert separator

        if (tmpNumArr[0].length > 3) {
          curIndex = tmpNumArr[0].length - 3;

          while (curIndex > 0) {
            tmpNumArr[0] = tmpNumArr[0].insertAt(curIndex, separator);
            curIndex -= 3;
          }
        }

        numString = tmpNumArr[0]; // append fixed

        if (tmpNumArr.length > 1) {
          numString += '.' + tmpNumArr[1].substr(0, fixedLength);
        }

        numString += units[i].prefix;
        break;
      }
    }
  }

  if (isNegative) {
    numString = "-" + numString;
  } //ZLog.debug("num String = %s", numString);


  return numString;
};

Utility.runUpdateGold = function (label, curGold, tarGold, funcFormat, cbInterval, cbDone, speratorFuncFormat, unitFuncFormat, prefix, postfix) {
  if (funcFormat === undefined) funcFormat = this.formatMoneyFull;
  if (curGold === undefined) curGold = 0;
  if (tarGold === undefined) tarGold = 0;
  if (prefix === undefined) prefix = "";
  if (postfix === undefined) postfix = "";
  label.string = funcFormat(10000);
  var numOfUpdate = 30;
  var delay = 0.1;
  var offset = (tarGold - curGold) / numOfUpdate;
  label.node.runAction(cc.sequence(cc.repeat(cc.sequence(cc.delayTime(delay), cc.callFunc(function (sender) {
    curGold = Math.floor(curGold + offset); // console.log("update new gold:" + curGold);

    label.string = prefix + funcFormat(curGold, unitFuncFormat, speratorFuncFormat) + postfix;
    cbInterval && cbInterval(label, curGold);
  })), numOfUpdate), cc.callFunc(function (sender) {
    label.string = prefix + funcFormat(tarGold, unitFuncFormat, speratorFuncFormat) + postfix; // console.log("update tar gold:" + tarGold);

    cbDone && cbDone(label);
  })));
};

module.exports = Utility;

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9zY3JpcHRzL1V0aWxpdHkuanMiXSwibmFtZXMiOlsiVXRpbGl0eSIsInVuaXRzIiwicHJlZml4IiwibCIsImRpdiIsImZvcm1hdE1vbmV5IiwibW9uZXkiLCJ1bml0Iiwic2VwYXJhdG9yIiwidW5kZWZpbmVkIiwiZm9ybWF0QWxpZ25OdW1iZXIiLCJmb3JtYXRNb25leUZ1bGwiLCJudW1iZXIiLCJpc0Z1bGwiLCJpc05lZ2F0aXZlIiwiTWF0aCIsImFicyIsInJvdW5kIiwibnVtU3RyaW5nIiwidG9TdHJpbmciLCJjdXJJbmRleCIsImxlbmd0aCIsInNsaWNlIiwiaSIsInRtcE51bUFyciIsInNwbGl0IiwiZml4ZWRMZW5ndGgiLCJpbnNlcnRBdCIsInN1YnN0ciIsInJ1blVwZGF0ZUdvbGQiLCJsYWJlbCIsImN1ckdvbGQiLCJ0YXJHb2xkIiwiZnVuY0Zvcm1hdCIsImNiSW50ZXJ2YWwiLCJjYkRvbmUiLCJzcGVyYXRvckZ1bmNGb3JtYXQiLCJ1bml0RnVuY0Zvcm1hdCIsInBvc3RmaXgiLCJzdHJpbmciLCJudW1PZlVwZGF0ZSIsImRlbGF5Iiwib2Zmc2V0Iiwibm9kZSIsInJ1bkFjdGlvbiIsImNjIiwic2VxdWVuY2UiLCJyZXBlYXQiLCJkZWxheVRpbWUiLCJjYWxsRnVuYyIsInNlbmRlciIsImZsb29yIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxJQUFJQSxPQUFPLEdBQUcsRUFBZDtBQUNBQSxPQUFPLENBQUNDLEtBQVIsR0FBZ0IsQ0FDWjtBQUFDQyxFQUFBQSxNQUFNLEVBQUUsR0FBVDtBQUFjQyxFQUFBQSxDQUFDLEVBQUUsRUFBakI7QUFBcUJDLEVBQUFBLEdBQUcsRUFBRTtBQUExQixDQURZLEVBRVo7QUFBQ0YsRUFBQUEsTUFBTSxFQUFFLEdBQVQ7QUFBY0MsRUFBQUEsQ0FBQyxFQUFFLENBQWpCO0FBQW9CQyxFQUFBQSxHQUFHLEVBQUU7QUFBekIsQ0FGWSxFQUdaO0FBQUNGLEVBQUFBLE1BQU0sRUFBRSxHQUFUO0FBQWNDLEVBQUFBLENBQUMsRUFBRSxDQUFqQjtBQUFvQkMsRUFBQUEsR0FBRyxFQUFFO0FBQXpCLENBSFksRUFJWjtBQUFDRixFQUFBQSxNQUFNLEVBQUUsR0FBVDtBQUFjQyxFQUFBQSxDQUFDLEVBQUUsQ0FBakI7QUFBb0JDLEVBQUFBLEdBQUcsRUFBRTtBQUF6QixDQUpZLEVBS1o7QUFBQ0YsRUFBQUEsTUFBTSxFQUFFLEVBQVQ7QUFBYUMsRUFBQUEsQ0FBQyxFQUFFLENBQWhCO0FBQW1CQyxFQUFBQSxHQUFHLEVBQUU7QUFBeEIsQ0FMWSxDQUFoQjtBQU9BOzs7Ozs7OztBQU9BSixPQUFPLENBQUNLLFdBQVIsR0FBc0IsVUFBU0MsS0FBVCxFQUFnQkMsSUFBaEIsRUFBc0JDLFNBQXRCLEVBQWdDO0FBQ2xELE1BQUdELElBQUksS0FBS0UsU0FBWixFQUF1QkYsSUFBSSxHQUFHLEVBQVA7QUFFdkIsU0FBT0EsSUFBSSxHQUFHUCxPQUFPLENBQUNVLGlCQUFSLENBQTBCSixLQUExQixFQUFpQ0UsU0FBakMsQ0FBZDtBQUNILENBSkQ7QUFNQTs7Ozs7Ozs7O0FBT0FSLE9BQU8sQ0FBQ1csZUFBUixHQUEwQixVQUFTTCxLQUFULEVBQWdCQyxJQUFoQixFQUFzQkMsU0FBdEIsRUFBZ0M7QUFDdEQsTUFBR0QsSUFBSSxLQUFLRSxTQUFaLEVBQXVCRixJQUFJLEdBQUcsRUFBUDtBQUV2QixTQUFPQSxJQUFJLEdBQUdQLE9BQU8sQ0FBQ1UsaUJBQVIsQ0FBMEJKLEtBQTFCLEVBQWlDRSxTQUFqQyxFQUE0QyxJQUE1QyxDQUFkO0FBQ0gsQ0FKRDtBQU1BOzs7Ozs7Ozs7QUFPQVIsT0FBTyxDQUFDVSxpQkFBUixHQUE0QixVQUFTRSxNQUFULEVBQWlCSixTQUFqQixFQUE0QkssTUFBNUIsRUFBbUM7QUFDM0QsTUFBR0QsTUFBTSxLQUFLSCxTQUFkLEVBQXlCLE9BQU8sR0FBUDtBQUV6QkcsRUFBQUEsTUFBTSxJQUFJLENBQUMsR0FBWCxDQUgyRCxDQUczQzs7QUFDaEIsTUFBR0osU0FBUyxLQUFLQyxTQUFqQixFQUEyQjtBQUN2QkQsSUFBQUEsU0FBUyxHQUFHLEdBQVo7QUFDSDs7QUFFRCxNQUFHSyxNQUFNLEtBQUtKLFNBQWQsRUFBd0I7QUFDcEJJLElBQUFBLE1BQU0sR0FBRyxLQUFUO0FBQ0g7O0FBRUQsTUFBSUMsVUFBVSxHQUFHRixNQUFNLEdBQUcsQ0FBMUI7QUFDQUEsRUFBQUEsTUFBTSxHQUFHRyxJQUFJLENBQUNDLEdBQUwsQ0FBU0QsSUFBSSxDQUFDRSxLQUFMLENBQVdMLE1BQVgsQ0FBVCxDQUFUO0FBQ0EsTUFBSU0sU0FBUyxHQUFHTixNQUFNLENBQUNPLFFBQVAsRUFBaEI7O0FBRUEsTUFBR04sTUFBSCxFQUFVO0FBQ04sUUFBSU8sUUFBUSxHQUFHRixTQUFTLENBQUNHLE1BQVYsR0FBbUIsQ0FBbEM7O0FBRUEsV0FBTUQsUUFBUSxHQUFHLENBQWpCLEVBQW1CO0FBQ2ZGLE1BQUFBLFNBQVMsR0FBR0EsU0FBUyxDQUFDSSxLQUFWLENBQWdCLENBQWhCLEVBQW1CRixRQUFuQixJQUErQlosU0FBL0IsR0FBMkNVLFNBQVMsQ0FBQ0ksS0FBVixDQUFnQkYsUUFBaEIsQ0FBdkQsQ0FEZSxDQUVmOztBQUNBQSxNQUFBQSxRQUFRLElBQUksQ0FBWjtBQUNIO0FBQ0osR0FSRCxNQVNJO0FBQ0EsUUFBSW5CLEtBQUssR0FBR0QsT0FBTyxDQUFDQyxLQUFwQjs7QUFDQSxTQUFJLElBQUlzQixDQUFDLEdBQUcsQ0FBUixFQUFXRixNQUFNLEdBQUdwQixLQUFLLENBQUNvQixNQUE5QixFQUFzQ0UsQ0FBQyxHQUFHRixNQUExQyxFQUFrRCxFQUFFRSxDQUFwRCxFQUFzRDtBQUNsRCxVQUFHTCxTQUFTLENBQUNHLE1BQVYsR0FBbUJwQixLQUFLLENBQUNzQixDQUFELENBQUwsQ0FBU3BCLENBQS9CLEVBQWlDO0FBQzdCLFlBQUlxQixTQUFTLEdBQUcsQ0FBQ1osTUFBTSxHQUFHWCxLQUFLLENBQUNzQixDQUFELENBQUwsQ0FBU25CLEdBQW5CLEVBQXdCZSxRQUF4QixHQUFtQ00sS0FBbkMsQ0FBeUMsR0FBekMsQ0FBaEI7QUFDQSxZQUFJQyxXQUFXLEdBQUdGLFNBQVMsQ0FBQyxDQUFELENBQVQsQ0FBYUgsTUFBYixHQUFzQixDQUF0QixHQUEwQixDQUExQixHQUE4QixDQUFoRCxDQUY2QixDQUk3Qjs7QUFDQSxZQUFHRyxTQUFTLENBQUMsQ0FBRCxDQUFULENBQWFILE1BQWIsR0FBc0IsQ0FBekIsRUFBMkI7QUFDdkJELFVBQUFBLFFBQVEsR0FBR0ksU0FBUyxDQUFDLENBQUQsQ0FBVCxDQUFhSCxNQUFiLEdBQXNCLENBQWpDOztBQUVBLGlCQUFNRCxRQUFRLEdBQUcsQ0FBakIsRUFBbUI7QUFDZkksWUFBQUEsU0FBUyxDQUFDLENBQUQsQ0FBVCxHQUFlQSxTQUFTLENBQUMsQ0FBRCxDQUFULENBQWFHLFFBQWIsQ0FBc0JQLFFBQXRCLEVBQWdDWixTQUFoQyxDQUFmO0FBQ0FZLFlBQUFBLFFBQVEsSUFBSSxDQUFaO0FBQ0g7QUFDSjs7QUFFREYsUUFBQUEsU0FBUyxHQUFHTSxTQUFTLENBQUMsQ0FBRCxDQUFyQixDQWQ2QixDQWU3Qjs7QUFDQSxZQUFHQSxTQUFTLENBQUNILE1BQVYsR0FBbUIsQ0FBdEIsRUFBd0I7QUFDcEJILFVBQUFBLFNBQVMsSUFBSSxNQUFNTSxTQUFTLENBQUMsQ0FBRCxDQUFULENBQWFJLE1BQWIsQ0FBb0IsQ0FBcEIsRUFBdUJGLFdBQXZCLENBQW5CO0FBQ0g7O0FBQ0RSLFFBQUFBLFNBQVMsSUFBSWpCLEtBQUssQ0FBQ3NCLENBQUQsQ0FBTCxDQUFTckIsTUFBdEI7QUFDQTtBQUNIO0FBQ0o7QUFDSjs7QUFFRCxNQUFHWSxVQUFILEVBQWM7QUFDVkksSUFBQUEsU0FBUyxHQUFHLE1BQU1BLFNBQWxCO0FBQ0gsR0F2RDBELENBeUQzRDs7O0FBQ0EsU0FBT0EsU0FBUDtBQUNILENBM0REOztBQTZEQWxCLE9BQU8sQ0FBQzZCLGFBQVIsR0FBd0IsVUFBU0MsS0FBVCxFQUFlQyxPQUFmLEVBQXVCQyxPQUF2QixFQUErQkMsVUFBL0IsRUFBMENDLFVBQTFDLEVBQXFEQyxNQUFyRCxFQUE0REMsa0JBQTVELEVBQStFQyxjQUEvRSxFQUE4Rm5DLE1BQTlGLEVBQXFHb0MsT0FBckcsRUFBNkc7QUFDakksTUFBR0wsVUFBVSxLQUFLeEIsU0FBbEIsRUFBNkJ3QixVQUFVLEdBQUcsS0FBS3RCLGVBQWxCO0FBQzdCLE1BQUdvQixPQUFPLEtBQUt0QixTQUFmLEVBQTBCc0IsT0FBTyxHQUFHLENBQVY7QUFDMUIsTUFBR0MsT0FBTyxLQUFLdkIsU0FBZixFQUEwQnVCLE9BQU8sR0FBRyxDQUFWO0FBQzFCLE1BQUc5QixNQUFNLEtBQUtPLFNBQWQsRUFBeUJQLE1BQU0sR0FBRyxFQUFUO0FBQ3pCLE1BQUdvQyxPQUFPLEtBQUs3QixTQUFmLEVBQTBCNkIsT0FBTyxHQUFHLEVBQVY7QUFFMUJSLEVBQUFBLEtBQUssQ0FBQ1MsTUFBTixHQUFlTixVQUFVLENBQUMsS0FBRCxDQUF6QjtBQUNBLE1BQUlPLFdBQVcsR0FBRyxFQUFsQjtBQUNBLE1BQUlDLEtBQUssR0FBRyxHQUFaO0FBQ0EsTUFBSUMsTUFBTSxHQUFHLENBQUNWLE9BQU8sR0FBR0QsT0FBWCxJQUFvQlMsV0FBakM7QUFDQVYsRUFBQUEsS0FBSyxDQUFDYSxJQUFOLENBQVdDLFNBQVgsQ0FBcUJDLEVBQUUsQ0FBQ0MsUUFBSCxDQUNqQkQsRUFBRSxDQUFDRSxNQUFILENBQVVGLEVBQUUsQ0FBQ0MsUUFBSCxDQUNORCxFQUFFLENBQUNHLFNBQUgsQ0FBYVAsS0FBYixDQURNLEVBRU5JLEVBQUUsQ0FBQ0ksUUFBSCxDQUFZLFVBQVVDLE1BQVYsRUFBa0I7QUFDMUJuQixJQUFBQSxPQUFPLEdBQUdoQixJQUFJLENBQUNvQyxLQUFMLENBQVdwQixPQUFPLEdBQUdXLE1BQXJCLENBQVYsQ0FEMEIsQ0FFMUI7O0FBQ0FaLElBQUFBLEtBQUssQ0FBQ1MsTUFBTixHQUFlckMsTUFBTSxHQUFHK0IsVUFBVSxDQUFDRixPQUFELEVBQVNNLGNBQVQsRUFBd0JELGtCQUF4QixDQUFuQixHQUFpRUUsT0FBaEY7QUFDQUosSUFBQUEsVUFBVSxJQUFJQSxVQUFVLENBQUNKLEtBQUQsRUFBT0MsT0FBUCxDQUF4QjtBQUNILEdBTEQsQ0FGTSxDQUFWLEVBUUVTLFdBUkYsQ0FEaUIsRUFVakJLLEVBQUUsQ0FBQ0ksUUFBSCxDQUFZLFVBQVVDLE1BQVYsRUFBa0I7QUFDMUJwQixJQUFBQSxLQUFLLENBQUNTLE1BQU4sR0FBZXJDLE1BQU0sR0FBRytCLFVBQVUsQ0FBQ0QsT0FBRCxFQUFTSyxjQUFULEVBQXdCRCxrQkFBeEIsQ0FBbkIsR0FBaUVFLE9BQWhGLENBRDBCLENBRTFCOztBQUNBSCxJQUFBQSxNQUFNLElBQUlBLE1BQU0sQ0FBQ0wsS0FBRCxDQUFoQjtBQUNILEdBSkQsQ0FWaUIsQ0FBckI7QUFnQkgsQ0EzQkQ7O0FBNEJBc0IsTUFBTSxDQUFDQyxPQUFQLEdBQWlCckQsT0FBakIiLCJzb3VyY2VSb290IjoiLyIsInNvdXJjZXNDb250ZW50IjpbInZhciBVdGlsaXR5ID0ge307XHJcblV0aWxpdHkudW5pdHMgPSBbXHJcbiAgICB7cHJlZml4OiAnRycsIGw6IDEyLCBkaXY6IDEwMDAwMDAwMDAwMDB9LFxyXG4gICAge3ByZWZpeDogJ0InLCBsOiA5LCBkaXY6IDEwMDAwMDAwMDB9LFxyXG4gICAge3ByZWZpeDogJ00nLCBsOiA2LCBkaXY6IDEwMDAwMDB9LFxyXG4gICAge3ByZWZpeDogJ0snLCBsOiA0LCBkaXY6IDEwMDB9LFxyXG4gICAge3ByZWZpeDogJycsIGw6IDMsIGRpdjogMX1cclxuXTtcclxuLyoqXHJcbiAqXHJcbiAqIEBwYXJhbSBtb25leVxyXG4gKiBAcGFyYW0gdW5pdFxyXG4gKiBAcGFyYW0gc2VwYXJhdG9yXHJcbiAqIEByZXR1cm5zIHsqfVxyXG4gKi9cclxuVXRpbGl0eS5mb3JtYXRNb25leSA9IGZ1bmN0aW9uKG1vbmV5LCB1bml0LCBzZXBhcmF0b3Ipe1xyXG4gICAgaWYodW5pdCA9PT0gdW5kZWZpbmVkKSB1bml0ID0gXCJcIjtcclxuXHJcbiAgICByZXR1cm4gdW5pdCArIFV0aWxpdHkuZm9ybWF0QWxpZ25OdW1iZXIobW9uZXksIHNlcGFyYXRvcik7XHJcbn07XHJcblxyXG4vKipcclxuICpcclxuICogQHBhcmFtIG1vbmV5XHJcbiAqIEBwYXJhbSB1bml0XHJcbiAqIEBwYXJhbSBzZXBhcmF0b3JcclxuICogQHJldHVybnMgeyp9XHJcbiAqL1xyXG5VdGlsaXR5LmZvcm1hdE1vbmV5RnVsbCA9IGZ1bmN0aW9uKG1vbmV5LCB1bml0LCBzZXBhcmF0b3Ipe1xyXG4gICAgaWYodW5pdCA9PT0gdW5kZWZpbmVkKSB1bml0ID0gXCJcIjtcclxuXHJcbiAgICByZXR1cm4gdW5pdCArIFV0aWxpdHkuZm9ybWF0QWxpZ25OdW1iZXIobW9uZXksIHNlcGFyYXRvciwgdHJ1ZSk7XHJcbn07XHJcblxyXG4vKipcclxuICpcclxuICogQHBhcmFtIG51bWJlclxyXG4gKiBAcGFyYW0gc2VwYXJhdG9yXHJcbiAqIEBwYXJhbSBpc0Z1bGxcclxuICogQHJldHVybnMgeyp9XHJcbiAqL1xyXG5VdGlsaXR5LmZvcm1hdEFsaWduTnVtYmVyID0gZnVuY3Rpb24obnVtYmVyLCBzZXBhcmF0b3IsIGlzRnVsbCl7XHJcbiAgICBpZihudW1iZXIgPT09IHVuZGVmaW5lZCkgcmV0dXJuIFwiMFwiO1xyXG5cclxuICAgIG51bWJlciAtPSAtMC4xOyAvL21hZ2ljXHJcbiAgICBpZihzZXBhcmF0b3IgPT09IHVuZGVmaW5lZCl7XHJcbiAgICAgICAgc2VwYXJhdG9yID0gXCIsXCI7XHJcbiAgICB9XHJcblxyXG4gICAgaWYoaXNGdWxsID09PSB1bmRlZmluZWQpe1xyXG4gICAgICAgIGlzRnVsbCA9IGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIHZhciBpc05lZ2F0aXZlID0gbnVtYmVyIDwgMDtcclxuICAgIG51bWJlciA9IE1hdGguYWJzKE1hdGgucm91bmQobnVtYmVyKSk7XHJcbiAgICB2YXIgbnVtU3RyaW5nID0gbnVtYmVyLnRvU3RyaW5nKCk7XHJcblxyXG4gICAgaWYoaXNGdWxsKXtcclxuICAgICAgICB2YXIgY3VySW5kZXggPSBudW1TdHJpbmcubGVuZ3RoIC0gMztcclxuXHJcbiAgICAgICAgd2hpbGUoY3VySW5kZXggPiAwKXtcclxuICAgICAgICAgICAgbnVtU3RyaW5nID0gbnVtU3RyaW5nLnNsaWNlKDAsIGN1ckluZGV4KSArIHNlcGFyYXRvciArIG51bVN0cmluZy5zbGljZShjdXJJbmRleCk7XHJcbiAgICAgICAgICAgIC8vIG51bVN0cmluZyA9IG51bVN0cmluZy5pbnNlcnRBdChjdXJJbmRleCwgc2VwYXJhdG9yKTtcclxuICAgICAgICAgICAgY3VySW5kZXggLT0gMztcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBlbHNle1xyXG4gICAgICAgIHZhciB1bml0cyA9IFV0aWxpdHkudW5pdHM7XHJcbiAgICAgICAgZm9yKHZhciBpID0gMCwgbGVuZ3RoID0gdW5pdHMubGVuZ3RoOyBpIDwgbGVuZ3RoOyArK2kpe1xyXG4gICAgICAgICAgICBpZihudW1TdHJpbmcubGVuZ3RoID4gdW5pdHNbaV0ubCl7XHJcbiAgICAgICAgICAgICAgICB2YXIgdG1wTnVtQXJyID0gKG51bWJlciAvIHVuaXRzW2ldLmRpdikudG9TdHJpbmcoKS5zcGxpdCgnLicpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGZpeGVkTGVuZ3RoID0gdG1wTnVtQXJyWzBdLmxlbmd0aCA+IDIgPyAxIDogMjtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBpbnNlcnQgc2VwYXJhdG9yXHJcbiAgICAgICAgICAgICAgICBpZih0bXBOdW1BcnJbMF0ubGVuZ3RoID4gMyl7XHJcbiAgICAgICAgICAgICAgICAgICAgY3VySW5kZXggPSB0bXBOdW1BcnJbMF0ubGVuZ3RoIC0gMztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgd2hpbGUoY3VySW5kZXggPiAwKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdG1wTnVtQXJyWzBdID0gdG1wTnVtQXJyWzBdLmluc2VydEF0KGN1ckluZGV4LCBzZXBhcmF0b3IpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjdXJJbmRleCAtPSAzO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBudW1TdHJpbmcgPSB0bXBOdW1BcnJbMF07XHJcbiAgICAgICAgICAgICAgICAvLyBhcHBlbmQgZml4ZWRcclxuICAgICAgICAgICAgICAgIGlmKHRtcE51bUFyci5sZW5ndGggPiAxKXtcclxuICAgICAgICAgICAgICAgICAgICBudW1TdHJpbmcgKz0gJy4nICsgdG1wTnVtQXJyWzFdLnN1YnN0cigwLCBmaXhlZExlbmd0aCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBudW1TdHJpbmcgKz0gdW5pdHNbaV0ucHJlZml4O1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgaWYoaXNOZWdhdGl2ZSl7XHJcbiAgICAgICAgbnVtU3RyaW5nID0gXCItXCIgKyBudW1TdHJpbmc7XHJcbiAgICB9XHJcblxyXG4gICAgLy9aTG9nLmRlYnVnKFwibnVtIFN0cmluZyA9ICVzXCIsIG51bVN0cmluZyk7XHJcbiAgICByZXR1cm4gbnVtU3RyaW5nO1xyXG59O1xyXG5cclxuVXRpbGl0eS5ydW5VcGRhdGVHb2xkID0gZnVuY3Rpb24obGFiZWwsY3VyR29sZCx0YXJHb2xkLGZ1bmNGb3JtYXQsY2JJbnRlcnZhbCxjYkRvbmUsc3BlcmF0b3JGdW5jRm9ybWF0LHVuaXRGdW5jRm9ybWF0LHByZWZpeCxwb3N0Zml4KXtcclxuICAgIGlmKGZ1bmNGb3JtYXQgPT09IHVuZGVmaW5lZCkgZnVuY0Zvcm1hdCA9IHRoaXMuZm9ybWF0TW9uZXlGdWxsO1xyXG4gICAgaWYoY3VyR29sZCA9PT0gdW5kZWZpbmVkKSBjdXJHb2xkID0gMDtcclxuICAgIGlmKHRhckdvbGQgPT09IHVuZGVmaW5lZCkgdGFyR29sZCA9IDA7XHJcbiAgICBpZihwcmVmaXggPT09IHVuZGVmaW5lZCkgcHJlZml4ID0gXCJcIjtcclxuICAgIGlmKHBvc3RmaXggPT09IHVuZGVmaW5lZCkgcG9zdGZpeCA9IFwiXCI7XHJcblxyXG4gICAgbGFiZWwuc3RyaW5nID0gZnVuY0Zvcm1hdCgxMDAwMCk7XHJcbiAgICB2YXIgbnVtT2ZVcGRhdGUgPSAzMDtcclxuICAgIHZhciBkZWxheSA9IDAuMTtcclxuICAgIHZhciBvZmZzZXQgPSAodGFyR29sZCAtIGN1ckdvbGQpL251bU9mVXBkYXRlO1xyXG4gICAgbGFiZWwubm9kZS5ydW5BY3Rpb24oY2Muc2VxdWVuY2UoXHJcbiAgICAgICAgY2MucmVwZWF0KGNjLnNlcXVlbmNlKFxyXG4gICAgICAgICAgICBjYy5kZWxheVRpbWUoZGVsYXkpLFxyXG4gICAgICAgICAgICBjYy5jYWxsRnVuYyhmdW5jdGlvbiAoc2VuZGVyKSB7XHJcbiAgICAgICAgICAgICAgICBjdXJHb2xkID0gTWF0aC5mbG9vcihjdXJHb2xkICsgb2Zmc2V0KTtcclxuICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKFwidXBkYXRlIG5ldyBnb2xkOlwiICsgY3VyR29sZCk7XHJcbiAgICAgICAgICAgICAgICBsYWJlbC5zdHJpbmcgPSBwcmVmaXggKyBmdW5jRm9ybWF0KGN1ckdvbGQsdW5pdEZ1bmNGb3JtYXQsc3BlcmF0b3JGdW5jRm9ybWF0KSArIHBvc3RmaXg7XHJcbiAgICAgICAgICAgICAgICBjYkludGVydmFsICYmIGNiSW50ZXJ2YWwobGFiZWwsY3VyR29sZCk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgKSxudW1PZlVwZGF0ZSksXHJcbiAgICAgICAgY2MuY2FsbEZ1bmMoZnVuY3Rpb24gKHNlbmRlcikge1xyXG4gICAgICAgICAgICBsYWJlbC5zdHJpbmcgPSBwcmVmaXggKyBmdW5jRm9ybWF0KHRhckdvbGQsdW5pdEZ1bmNGb3JtYXQsc3BlcmF0b3JGdW5jRm9ybWF0KSArIHBvc3RmaXg7XHJcbiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKFwidXBkYXRlIHRhciBnb2xkOlwiICsgdGFyR29sZCk7XHJcbiAgICAgICAgICAgIGNiRG9uZSAmJiBjYkRvbmUobGFiZWwpO1xyXG4gICAgICAgIH0pXHJcbiAgICApKTtcclxufTtcclxubW9kdWxlLmV4cG9ydHMgPSBVdGlsaXR5OyJdfQ==