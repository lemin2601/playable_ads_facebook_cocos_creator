
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/scripts/Utility.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '03f42tN4dFFZ57ZmRNgSNMC', 'Utility');
// scripts/Utility.js

"use strict";

var Utility = {};
Utility.units = [{
  prefix: 'G',
  l: 12,
  div: 1000000000000
}, {
  prefix: 'B',
  l: 9,
  div: 1000000000
}, {
  prefix: 'M',
  l: 6,
  div: 1000000
}, {
  prefix: 'K',
  l: 4,
  div: 1000
}, {
  prefix: '',
  l: 3,
  div: 1
}];
/**
 *
 * @param money
 * @param unit
 * @param separator
 * @returns {*}
 */

Utility.formatMoney = function (money, unit, separator) {
  if (unit === undefined) unit = "";
  return unit + Utility.formatAlignNumber(money, separator);
};
/**
 *
 * @param money
 * @param unit
 * @param separator
 * @returns {*}
 */


Utility.formatMoneyFull = function (money, unit, separator) {
  if (unit === undefined) unit = "";
  return unit + Utility.formatAlignNumber(money, separator, true);
};
/**
 *
 * @param number
 * @param separator
 * @param isFull
 * @returns {*}
 */


Utility.formatAlignNumber = function (number, separator, isFull) {
  if (number === undefined) return "0";
  number -= -0.1; //magic

  if (separator === undefined) {
    separator = ",";
  }

  if (isFull === undefined) {
    isFull = false;
  }

  var isNegative = number < 0;
  number = Math.abs(Math.round(number));
  var numString = number.toString();

  if (isFull) {
    var curIndex = numString.length - 3;

    while (curIndex > 0) {
      numString = numString.slice(0, curIndex) + separator + numString.slice(curIndex); // numString = numString.insertAt(curIndex, separator);

      curIndex -= 3;
    }
  } else {
    var units = Utility.units;

    for (var i = 0, length = units.length; i < length; ++i) {
      if (numString.length > units[i].l) {
        var tmpNumArr = (number / units[i].div).toString().split('.');
        var fixedLength = tmpNumArr[0].length > 2 ? 1 : 2; // insert separator

        if (tmpNumArr[0].length > 3) {
          curIndex = tmpNumArr[0].length - 3;

          while (curIndex > 0) {
            tmpNumArr[0] = tmpNumArr[0].insertAt(curIndex, separator);
            curIndex -= 3;
          }
        }

        numString = tmpNumArr[0]; // append fixed

        if (tmpNumArr.length > 1) {
          numString += '.' + tmpNumArr[1].substr(0, fixedLength);
        }

        numString += units[i].prefix;
        break;
      }
    }
  }

  if (isNegative) {
    numString = "-" + numString;
  } //ZLog.debug("num String = %s", numString);


  return numString;
};

Utility.runUpdateGold = function (label, curGold, tarGold, funcFormat, cbInterval, cbDone, speratorFuncFormat, unitFuncFormat, prefix) {
  if (funcFormat === undefined) funcFormat = this.formatMoneyFull;
  if (curGold === undefined) curGold = 0;
  if (tarGold === undefined) tarGold = 0;
  if (prefix === undefined) prefix = "";
  label.string = funcFormat(10000);
  var numOfUpdate = 30;
  var delay = 0.1;
  var offset = (tarGold - curGold) / numOfUpdate;
  label.node.runAction(cc.sequence(cc.repeat(cc.sequence(cc.delayTime(delay), cc.callFunc(function (sender) {
    curGold = Math.floor(curGold + offset); // console.log("update new gold:" + curGold);

    label.string = prefix + funcFormat(curGold, unitFuncFormat, speratorFuncFormat);
    cbInterval && cbInterval(label, curGold);
  })), numOfUpdate), cc.callFunc(function (sender) {
    label.string = prefix + funcFormat(tarGold, unitFuncFormat, speratorFuncFormat); // console.log("update tar gold:" + tarGold);

    cbDone && cbDone(label);
  })));
};

module.exports = Utility;

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcc2NyaXB0c1xcVXRpbGl0eS5qcyJdLCJuYW1lcyI6WyJVdGlsaXR5IiwidW5pdHMiLCJwcmVmaXgiLCJsIiwiZGl2IiwiZm9ybWF0TW9uZXkiLCJtb25leSIsInVuaXQiLCJzZXBhcmF0b3IiLCJ1bmRlZmluZWQiLCJmb3JtYXRBbGlnbk51bWJlciIsImZvcm1hdE1vbmV5RnVsbCIsIm51bWJlciIsImlzRnVsbCIsImlzTmVnYXRpdmUiLCJNYXRoIiwiYWJzIiwicm91bmQiLCJudW1TdHJpbmciLCJ0b1N0cmluZyIsImN1ckluZGV4IiwibGVuZ3RoIiwic2xpY2UiLCJpIiwidG1wTnVtQXJyIiwic3BsaXQiLCJmaXhlZExlbmd0aCIsImluc2VydEF0Iiwic3Vic3RyIiwicnVuVXBkYXRlR29sZCIsImxhYmVsIiwiY3VyR29sZCIsInRhckdvbGQiLCJmdW5jRm9ybWF0IiwiY2JJbnRlcnZhbCIsImNiRG9uZSIsInNwZXJhdG9yRnVuY0Zvcm1hdCIsInVuaXRGdW5jRm9ybWF0Iiwic3RyaW5nIiwibnVtT2ZVcGRhdGUiLCJkZWxheSIsIm9mZnNldCIsIm5vZGUiLCJydW5BY3Rpb24iLCJjYyIsInNlcXVlbmNlIiwicmVwZWF0IiwiZGVsYXlUaW1lIiwiY2FsbEZ1bmMiLCJzZW5kZXIiLCJmbG9vciIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsSUFBSUEsT0FBTyxHQUFHLEVBQWQ7QUFDQUEsT0FBTyxDQUFDQyxLQUFSLEdBQWdCLENBQ1o7QUFBQ0MsRUFBQUEsTUFBTSxFQUFFLEdBQVQ7QUFBY0MsRUFBQUEsQ0FBQyxFQUFFLEVBQWpCO0FBQXFCQyxFQUFBQSxHQUFHLEVBQUU7QUFBMUIsQ0FEWSxFQUVaO0FBQUNGLEVBQUFBLE1BQU0sRUFBRSxHQUFUO0FBQWNDLEVBQUFBLENBQUMsRUFBRSxDQUFqQjtBQUFvQkMsRUFBQUEsR0FBRyxFQUFFO0FBQXpCLENBRlksRUFHWjtBQUFDRixFQUFB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LENBRGlCLEVBVWpCSyxFQUFFLENBQUNJLFFBQUgsQ0FBWSxVQUFVQyxNQUFWLEVBQWtCO0FBQzFCbkIsSUFBQUEsS0FBSyxDQUFDUSxNQUFOLEdBQWVwQyxNQUFNLEdBQUcrQixVQUFVLENBQUNELE9BQUQsRUFBU0ssY0FBVCxFQUF3QkQsa0JBQXhCLENBQWxDLENBRDBCLENBRTFCOztBQUNBRCxJQUFBQSxNQUFNLElBQUlBLE1BQU0sQ0FBQ0wsS0FBRCxDQUFoQjtBQUNILEdBSkQsQ0FWaUIsQ0FBckI7QUFnQkgsQ0ExQkQ7O0FBMkJBcUIsTUFBTSxDQUFDQyxPQUFQLEdBQWlCcEQsT0FBakIiLCJzb3VyY2VSb290IjoiLyIsInNvdXJjZXNDb250ZW50IjpbInZhciBVdGlsaXR5ID0ge307XHJcblV0aWxpdHkudW5pdHMgPSBbXHJcbiAgICB7cHJlZml4OiAnRycsIGw6IDEyLCBkaXY6IDEwMDAwMDAwMDAwMDB9LFxyXG4gICAge3ByZWZpeDogJ0InLCBsOiA5LCBkaXY6IDEwMDAwMDAwMDB9LFxyXG4gICAge3ByZWZpeDogJ00nLCBsOiA2LCBkaXY6IDEwMDAwMDB9LFxyXG4gICAge3ByZWZpeDogJ0snLCBsOiA0LCBkaXY6IDEwMDB9LFxyXG4gICAge3ByZWZpeDogJycsIGw6IDMsIGRpdjogMX1cclxuXTtcclxuLyoqXHJcbiAqXHJcbiAqIEBwYXJhbSBtb25leVxyXG4gKiBAcGFyYW0gdW5pdFxyXG4gKiBAcGFyYW0gc2VwYXJhdG9yXHJcbiAqIEByZXR1cm5zIHsqfVxyXG4gKi9cclxuVXRpbGl0eS5mb3JtYXRNb25leSA9IGZ1bmN0aW9uKG1vbmV5LCB1bml0LCBzZXBhcmF0b3Ipe1xyXG4gICAgaWYodW5pdCA9PT0gdW5kZWZpbmVkKSB1bml0ID0gXCJcIjtcclxuXHJcbiAgICByZXR1cm4gdW5pdCArIFV0aWxpdHkuZm9ybWF0QWxpZ25OdW1iZXIobW9uZXksIHNlcGFyYXRvcik7XHJcbn07XHJcblxyXG4vKipcclxuICpcclxuICogQHBhcmFtIG1vbmV5XHJcbiAqIEBwYXJhbSB1bml0XHJcbiAqIEBwYXJhbSBzZXBhcmF0b3JcclxuICogQHJldHVybnMgeyp9XHJcbiAqL1xyXG5VdGlsaXR5LmZvcm1hdE1vbmV5RnVsbCA9IGZ1bmN0aW9uKG1vbmV5LCB1bml0LCBzZXBhcmF0b3Ipe1xyXG4gICAgaWYodW5pdCA9PT0gdW5kZWZpbmVkKSB1bml0ID0gXCJcIjtcclxuXHJcbiAgICByZXR1cm4gdW5pdCArIFV0aWxpdHkuZm9ybWF0QWxpZ25OdW1iZXIobW9uZXksIHNlcGFyYXRvciwgdHJ1ZSk7XHJcbn07XHJcblxyXG4vKipcclxuICpcclxuICogQHBhcmFtIG51bWJlclxyXG4gKiBAcGFyYW0gc2VwYXJhdG9yXHJcbiAqIEBwYXJhbSBpc0Z1bGxcclxuICogQHJldHVybnMgeyp9XHJcbiAqL1xyXG5VdGlsaXR5LmZvcm1hdEFsaWduTnVtYmVyID0gZnVuY3Rpb24obnVtYmVyLCBzZXBhcmF0b3IsIGlzRnVsbCl7XHJcbiAgICBpZihudW1iZXIgPT09IHVuZGVmaW5lZCkgcmV0dXJuIFwiMFwiO1xyXG5cclxuICAgIG51bWJlciAtPSAtMC4xOyAvL21hZ2ljXHJcbiAgICBpZihzZXBhcmF0b3IgPT09IHVuZGVmaW5lZCl7XHJcbiAgICAgICAgc2VwYXJhdG9yID0gXCIsXCI7XHJcbiAgICB9XHJcblxyXG4gICAgaWYoaXNGdWxsID09PSB1bmRlZmluZWQpe1xyXG4gICAgICAgIGlzRnVsbCA9IGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIHZhciBpc05lZ2F0aXZlID0gbnVtYmVyIDwgMDtcclxuICAgIG51bWJlciA9IE1hdGguYWJzKE1hdGgucm91bmQobnVtYmVyKSk7XHJcbiAgICB2YXIgbnVtU3RyaW5nID0gbnVtYmVyLnRvU3RyaW5nKCk7XHJcblxyXG4gICAgaWYoaXNGdWxsKXtcclxuICAgICAgICB2YXIgY3VySW5kZXggPSBudW1TdHJpbmcubGVuZ3RoIC0gMztcclxuXHJcbiAgICAgICAgd2hpbGUoY3VySW5kZXggPiAwKXtcclxuICAgICAgICAgICAgbnVtU3RyaW5nID0gbnVtU3RyaW5nLnNsaWNlKDAsIGN1ckluZGV4KSArIHNlcGFyYXRvciArIG51bVN0cmluZy5zbGljZShjdXJJbmRleCk7XHJcbiAgICAgICAgICAgIC8vIG51bVN0cmluZyA9IG51bVN0cmluZy5pbnNlcnRBdChjdXJJbmRleCwgc2VwYXJhdG9yKTtcclxuICAgICAgICAgICAgY3VySW5kZXggLT0gMztcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBlbHNle1xyXG4gICAgICAgIHZhciB1bml0cyA9IFV0aWxpdHkudW5pdHM7XHJcbiAgICAgICAgZm9yKHZhciBpID0gMCwgbGVuZ3RoID0gdW5pdHMubGVuZ3RoOyBpIDwgbGVuZ3RoOyArK2kpe1xyXG4gICAgICAgICAgICBpZihudW1TdHJpbmcubGVuZ3RoID4gdW5pdHNbaV0ubCl7XHJcbiAgICAgICAgICAgICAgICB2YXIgdG1wTnVtQXJyID0gKG51bWJlciAvIHVuaXRzW2ldLmRpdikudG9TdHJpbmcoKS5zcGxpdCgnLicpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGZpeGVkTGVuZ3RoID0gdG1wTnVtQXJyWzBdLmxlbmd0aCA+IDIgPyAxIDogMjtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBpbnNlcnQgc2VwYXJhdG9yXHJcbiAgICAgICAgICAgICAgICBpZih0bXBOdW1BcnJbMF0ubGVuZ3RoID4gMyl7XHJcbiAgICAgICAgICAgICAgICAgICAgY3VySW5kZXggPSB0bXBOdW1BcnJbMF0ubGVuZ3RoIC0gMztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgd2hpbGUoY3VySW5kZXggPiAwKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdG1wTnVtQXJyWzBdID0gdG1wTnVtQXJyWzBdLmluc2VydEF0KGN1ckluZGV4LCBzZXBhcmF0b3IpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjdXJJbmRleCAtPSAzO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBudW1TdHJpbmcgPSB0bXBOdW1BcnJbMF07XHJcbiAgICAgICAgICAgICAgICAvLyBhcHBlbmQgZml4ZWRcclxuICAgICAgICAgICAgICAgIGlmKHRtcE51bUFyci5sZW5ndGggPiAxKXtcclxuICAgICAgICAgICAgICAgICAgICBudW1TdHJpbmcgKz0gJy4nICsgdG1wTnVtQXJyWzFdLnN1YnN0cigwLCBmaXhlZExlbmd0aCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBudW1TdHJpbmcgKz0gdW5pdHNbaV0ucHJlZml4O1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgaWYoaXNOZWdhdGl2ZSl7XHJcbiAgICAgICAgbnVtU3RyaW5nID0gXCItXCIgKyBudW1TdHJpbmc7XHJcbiAgICB9XHJcblxyXG4gICAgLy9aTG9nLmRlYnVnKFwibnVtIFN0cmluZyA9ICVzXCIsIG51bVN0cmluZyk7XHJcbiAgICByZXR1cm4gbnVtU3RyaW5nO1xyXG59O1xyXG5cclxuVXRpbGl0eS5ydW5VcGRhdGVHb2xkID0gZnVuY3Rpb24obGFiZWwsY3VyR29sZCx0YXJHb2xkLGZ1bmNGb3JtYXQsY2JJbnRlcnZhbCxjYkRvbmUsc3BlcmF0b3JGdW5jRm9ybWF0LHVuaXRGdW5jRm9ybWF0LHByZWZpeCl7XHJcbiAgICBpZihmdW5jRm9ybWF0ID09PSB1bmRlZmluZWQpIGZ1bmNGb3JtYXQgPSB0aGlzLmZvcm1hdE1vbmV5RnVsbDtcclxuICAgIGlmKGN1ckdvbGQgPT09IHVuZGVmaW5lZCkgY3VyR29sZCA9IDA7XHJcbiAgICBpZih0YXJHb2xkID09PSB1bmRlZmluZWQpIHRhckdvbGQgPSAwO1xyXG4gICAgaWYocHJlZml4ID09PSB1bmRlZmluZWQpIHByZWZpeCA9IFwiXCI7XHJcblxyXG4gICAgbGFiZWwuc3RyaW5nID0gZnVuY0Zvcm1hdCgxMDAwMCk7XHJcbiAgICB2YXIgbnVtT2ZVcGRhdGUgPSAzMDtcclxuICAgIHZhciBkZWxheSA9IDAuMTtcclxuICAgIHZhciBvZmZzZXQgPSAodGFyR29sZCAtIGN1ckdvbGQpL251bU9mVXBkYXRlO1xyXG4gICAgbGFiZWwubm9kZS5ydW5BY3Rpb24oY2Muc2VxdWVuY2UoXHJcbiAgICAgICAgY2MucmVwZWF0KGNjLnNlcXVlbmNlKFxyXG4gICAgICAgICAgICBjYy5kZWxheVRpbWUoZGVsYXkpLFxyXG4gICAgICAgICAgICBjYy5jYWxsRnVuYyhmdW5jdGlvbiAoc2VuZGVyKSB7XHJcbiAgICAgICAgICAgICAgICBjdXJHb2xkID0gTWF0aC5mbG9vcihjdXJHb2xkICsgb2Zmc2V0KTtcclxuICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKFwidXBkYXRlIG5ldyBnb2xkOlwiICsgY3VyR29sZCk7XHJcbiAgICAgICAgICAgICAgICBsYWJlbC5zdHJpbmcgPSBwcmVmaXggKyBmdW5jRm9ybWF0KGN1ckdvbGQsdW5pdEZ1bmNGb3JtYXQsc3BlcmF0b3JGdW5jRm9ybWF0KTtcclxuICAgICAgICAgICAgICAgIGNiSW50ZXJ2YWwgJiYgY2JJbnRlcnZhbChsYWJlbCxjdXJHb2xkKTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICApLG51bU9mVXBkYXRlKSxcclxuICAgICAgICBjYy5jYWxsRnVuYyhmdW5jdGlvbiAoc2VuZGVyKSB7XHJcbiAgICAgICAgICAgIGxhYmVsLnN0cmluZyA9IHByZWZpeCArIGZ1bmNGb3JtYXQodGFyR29sZCx1bml0RnVuY0Zvcm1hdCxzcGVyYXRvckZ1bmNGb3JtYXQpO1xyXG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhcInVwZGF0ZSB0YXIgZ29sZDpcIiArIHRhckdvbGQpO1xyXG4gICAgICAgICAgICBjYkRvbmUgJiYgY2JEb25lKGxhYmVsKTtcclxuICAgICAgICB9KVxyXG4gICAgKSk7XHJcbn07XHJcbm1vZHVsZS5leHBvcnRzID0gVXRpbGl0eTsiXX0=