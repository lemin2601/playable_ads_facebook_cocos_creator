
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/scripts/CCard.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '34036kNa6RCAoMIlraaHio6', 'CCard');
// scripts/CCard.js

"use strict";

var _require = require("Types"),
    Card = _require.Card,
    Rank = _require.Rank; // import {Card} from "Types";

/**
 * @class CCard
 */


var CCard = cc.Class({
  "extends": cc.Component,
  properties: {
    // nodes
    point: cc.Label,
    suit: cc.Sprite,
    mainPic: cc.Sprite,
    cardBG: cc.Sprite,
    // resources
    redTextColor: cc.Color.RED,
    blackTextColor: cc.Color.WHITE,
    texFrontBG: cc.SpriteFrame,
    texBackBG: cc.SpriteFrame,
    texFaces: {
      "default": [],
      type: cc.SpriteFrame
    },
    texSuitBig: {
      "default": [],
      type: cc.SpriteFrame
    },
    texSuitSmall: {
      "default": [],
      type: cc.SpriteFrame
    },
    index: {
      //vi tri trong group khi danh ra
      "default": 0,
      type: cc.Integer,
      visible: false
    },
    isSelected: {
      // trang thai co select khong
      "default": false,
      visible: false
    },
    owner: {
      //so huu quan bai, myPlayer hoac dock duoi table
      "default": null,
      type: cc.Node,
      visible: false
    },
    isDraging: {
      "default": true,
      visible: false
    },
    card: {
      "default": null,
      type: Card,
      visible: false
    }
  },

  /**
   * my player | dock
   * @param owner {cc.Node}
   */
  setOwner: function setOwner(owner) {
    this.owner = owner;
  },
  onLoad: function onLoad() {
    console.log("loadCard:" + this.card + "|" + this.index);

    if (this.card) {
      this.init(this.card);
    }

    this.node.on(cc.Node.EventType.TOUCH_START, this.onTouch, this);
    this.node.on(cc.Node.EventType.TOUCH_MOVE, this.onTouch, this);
    this.node.on(cc.Node.EventType.TOUCH_END, this.onTouch, this);
    this.node.on(cc.Node.EventType.TOUCH_CANCEL, this.onTouch, this); // this.node.on("cardtouch",this.onEmit,this);
  },
  onEmit: function onEmit() {
    console.log("onEmit card:" + this.card.toString());
  },
  onTouch: function onTouch(event) {
    if (this.owner) {
      var customEvent = new cc.Event.EventCustom('card-touch', true);
      customEvent.setUserData({
        card: this,
        event: event
      });
      this.node.dispatchEvent(customEvent); // var cPlayer = this.owner.getComponent("CPlayer");
      // cPlayer.onTouchCard(event,this);
    } else {
      console.log("not found owner's card:" + this.id);
    }
  },
  start: function start() {
    this.node.dispatchEvent(new cc.Event.EventCustom('cardtouch', true));
  },
  setCard: function setCard(card) {
    console.log("setCard:" + card + "|point:" + card.point + "|suit:" + card.suit);
    this.card = card;
  },
  // use this for initialization
  init: function init(card) {
    var isFaceCard = 8 <= card.point && card.point <= 10;
    console.log("isFace:" + card.toString() + "|" + isFaceCard);

    if (isFaceCard) {
      this.mainPic.spriteFrame = this.texFaces[card.point - 9];
    } else {
      this.mainPic.spriteFrame = this.texSuitBig[card.suit];
    } // for jsb


    this.point.string = card.pointName;

    if (card.isRedSuit) {
      this.point.node.color = this.redTextColor;
    } else {
      this.point.node.color = this.blackTextColor;
    }

    this.suit.spriteFrame = this.texSuitSmall[card.suit];
  },
  reveal: function reveal(isFaceUp) {
    this.point.node.active = isFaceUp;
    this.suit.node.active = isFaceUp;
    this.mainPic.node.active = isFaceUp;
    this.cardBG.spriteFrame = isFaceUp ? this.texFrontBG : this.texBackBG;
  },
  setPositionCenter: function setPositionCenter(pos) {
    this.node.setPosition(pos.x - 50, pos.y - 65);
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcc2NyaXB0c1xcQ0NhcmQuanMiXSwibmFtZXMiOlsicmVxdWlyZSIsIkNhcmQiLCJSYW5rIiwiQ0NhcmQiLCJjYyIsIkNsYXNzIiwiQ29tcG9uZW50IiwicHJvcGVydGllcyIsInBvaW50IiwiTGFiZWwiLCJzdWl0IiwiU3ByaXRlIiwibWFpblBpYyIsImNhcmRCRyIsInJlZFRleHRDb2xvciIsIkNvbG9yIiwiUkVEIiwiYmxhY2tUZXh0Q29sb3IiLCJXSElURSIsInRleEZyb250QkciLCJTcHJpdGVGcmFtZSIsInRleEJhY2tCRyIsInRleEZhY2VzIiwidHlwZSIsInRleFN1aXRCaWciLCJ0ZXhTdWl0U21hbGwiLCJpbmRleCIsIkludGVnZXIiLCJ2aXNpYmxlIiwiaXNTZWxlY3RlZCIsIm93bmVyIiwiTm9kZSIsImlzRHJhZ2luZyIsImNhcmQiLCJzZXRPd25lciIsIm9uTG9hZCIsImNvbnNvbGUiLCJsb2ciLCJpbml0Iiwibm9kZSIsIm9uIiwiRXZlbnRUeXBlIiwiVE9VQ0hfU1RBUlQiLCJvblRvdWNoIiwiVE9VQ0hfTU9WRSIsIlRPVUNIX0VORCIsIlRPVUNIX0NBTkNFTCIsIm9uRW1pdCIsInRvU3RyaW5nIiwiZXZlbnQiLCJjdXN0b21FdmVudCIsIkV2ZW50IiwiRXZlbnRDdXN0b20iLCJzZXRVc2VyRGF0YSIsImRpc3BhdGNoRXZlbnQiLCJpZCIsInN0YXJ0Iiwic2V0Q2FyZCIsImlzRmFjZUNhcmQiLCJzcHJpdGVGcmFtZSIsInN0cmluZyIsInBvaW50TmFtZSIsImlzUmVkU3VpdCIsImNvbG9yIiwicmV2ZWFsIiwiaXNGYWNlVXAiLCJhY3RpdmUiLCJzZXRQb3NpdGlvbkNlbnRlciIsInBvcyIsInNldFBvc2l0aW9uIiwieCIsInkiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O2VBQWtCQSxPQUFPLENBQUMsT0FBRDtJQUFwQkMsZ0JBQUFBO0lBQUtDLGdCQUFBQSxNQUNWOztBQUNBOzs7OztBQUdBLElBQUlDLEtBQUss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RCxJQUFMLENBQVU2QixJQUFWLENBQWUyQixNQUFmLEdBQTJCRCxRQUEzQjtBQUNBLFNBQUtyRCxPQUFMLENBQWEyQixJQUFiLENBQWtCMkIsTUFBbEIsR0FBMkJELFFBQTNCO0FBQ0EsU0FBS3BELE1BQUwsQ0FBWThDLFdBQVosR0FBMkJNLFFBQVEsR0FBRyxLQUFLOUMsVUFBUixHQUFxQixLQUFLRSxTQUE3RDtBQUNILEdBN0hnQjtBQThIakI4QyxFQUFBQSxpQkFBaUIsRUFBQywyQkFBVUMsR0FBVixFQUFlO0FBQzdCLFNBQUs3QixJQUFMLENBQVU4QixXQUFWLENBQXNCRCxHQUFHLENBQUNFLENBQUosR0FBUSxFQUE5QixFQUFpQ0YsR0FBRyxDQUFDRyxDQUFKLEdBQVEsRUFBekM7QUFDSDtBQWhJZ0IsQ0FBVCxDQUFaIiwic291cmNlUm9vdCI6Ii8iLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIge0NhcmQsUmFua30gPSByZXF1aXJlKFwiVHlwZXNcIik7XHJcbi8vIGltcG9ydCB7Q2FyZH0gZnJvbSBcIlR5cGVzXCI7XHJcbi8qKlxyXG4gKiBAY2xhc3MgQ0NhcmRcclxuICovXHJcbnZhciBDQ2FyZCA9IGNjLkNsYXNzKHtcclxuICAgIGV4dGVuZHM6IGNjLkNvbXBvbmVudCxcclxuXHJcbiAgICBwcm9wZXJ0aWVzOiB7XHJcbiAgICAgICAgLy8gbm9kZXNcclxuICAgICAgICBwb2ludCAgIDogY2MuTGFiZWwsXHJcbiAgICAgICAgc3VpdCAgIDogY2MuU3ByaXRlLFxyXG4gICAgICAgIG1haW5QaWM6IGNjLlNwcml0ZSxcclxuICAgICAgICBjYXJkQkcgOiBjYy5TcHJpdGUsXHJcblxyXG4gICAgICAgIC8vIHJlc291cmNlc1xyXG4gICAgICAgIHJlZFRleHRDb2xvciAgOiBjYy5Db2xvci5SRUQsXHJcbiAgICAgICAgYmxhY2tUZXh0Q29sb3I6IGNjLkNvbG9yLldISVRFLFxyXG4gICAgICAgIHRleEZyb250QkcgICAgOiBjYy5TcHJpdGVGcmFtZSxcclxuICAgICAgICB0ZXhCYWNrQkcgICAgIDogY2MuU3ByaXRlRnJhbWUsXHJcblxyXG4gICAgICAgIHRleEZhY2VzICAgIDoge1xyXG4gICAgICAgICAgICBkZWZhdWx0OiBbXSxcclxuICAgICAgICAgICAgdHlwZSAgIDogY2MuU3ByaXRlRnJhbWVcclxuICAgICAgICB9LFxyXG4gICAgICAgIHRleFN1aXRCaWcgIDoge1xyXG4gICAgICAgICAgICBkZWZhdWx0OiBbXSxcclxuICAgICAgICAgICAgdHlwZSAgIDogY2MuU3ByaXRlRnJhbWVcclxuICAgICAgICB9LFxyXG4gICAgICAgIHRleFN1aXRTbWFsbDoge1xyXG4gICAgICAgICAgICBkZWZhdWx0OiBbXSxcclxuICAgICAgICAgICAgdHlwZSAgIDogY2MuU3ByaXRlRnJhbWVcclxuICAgICAgICB9LFxyXG4gICAgICAgIGluZGV4ICAgICAgIDogey8vdmkgdHJpIHRyb25nIGdyb3VwIGtoaSBkYW5oIHJhXHJcbiAgICAgICAgICAgIGRlZmF1bHQ6IDAsXHJcbiAgICAgICAgICAgIHR5cGUgICA6IGNjLkludGVnZXIsXHJcbiAgICAgICAgICAgIHZpc2libGU6IGZhbHNlLFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgaXNTZWxlY3RlZCAgOiB7IC8vIHRyYW5nIHRoYWkgY28gc2VsZWN0IGtob25nXHJcbiAgICAgICAgICAgIGRlZmF1bHQ6IGZhbHNlLFxyXG4gICAgICAgICAgICB2aXNpYmxlOiBmYWxzZVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgb3duZXIgICAgICAgOiB7Ly9zbyBodXUgcXVhbiBiYWksIG15UGxheWVyIGhvYWMgZG9jayBkdW9pIHRhYmxlXHJcbiAgICAgICAgICAgIGRlZmF1bHQ6IG51bGwsXHJcbiAgICAgICAgICAgIHR5cGUgICA6IGNjLk5vZGUsXHJcbiAgICAgICAgICAgIHZpc2libGU6IGZhbHNlXHJcbiAgICAgICAgfSxcclxuICAgICAgICBpc0RyYWdpbmcgICA6IHtcclxuICAgICAgICAgICAgZGVmYXVsdDogdHJ1ZSxcclxuICAgICAgICAgICAgdmlzaWJsZTogZmFsc2VcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICBjYXJkOiB7XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6IG51bGwsXHJcbiAgICAgICAgICAgIHR5cGUgICA6IENhcmQsXHJcbiAgICAgICAgICAgIHZpc2libGU6ZmFsc2VcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG5cclxuICAgIC8qKlxyXG4gICAgICogbXkgcGxheWVyIHwgZG9ja1xyXG4gICAgICogQHBhcmFtIG93bmVyIHtjYy5Ob2RlfVxyXG4gICAgICovXHJcbiAgICBzZXRPd25lcjpmdW5jdGlvbihvd25lcil7XHJcbiAgICAgICAgdGhpcy5vd25lciA9IG93bmVyO1xyXG4gICAgfSxcclxuICAgIG9uTG9hZDpmdW5jdGlvbigpe1xyXG4gICAgICAgIGNvbnNvbGUubG9nKFwibG9hZENhcmQ6XCIgKyB0aGlzLmNhcmQgK1wifFwiICsgdGhpcy5pbmRleCk7XHJcbiAgICAgICAgaWYodGhpcy5jYXJkKXtcclxuICAgICAgICAgICB0aGlzLmluaXQodGhpcy5jYXJkKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5ub2RlLm9uKGNjLk5vZGUuRXZlbnRUeXBlLlRPVUNIX1NUQVJULCB0aGlzLm9uVG91Y2gsIHRoaXMpO1xyXG4gICAgICAgIHRoaXMubm9kZS5vbihjYy5Ob2RlLkV2ZW50VHlwZS5UT1VDSF9NT1ZFLCB0aGlzLm9uVG91Y2gsIHRoaXMpO1xyXG4gICAgICAgIHRoaXMubm9kZS5vbihjYy5Ob2RlLkV2ZW50VHlwZS5UT1VDSF9FTkQsIHRoaXMub25Ub3VjaCwgdGhpcyk7XHJcbiAgICAgICAgdGhpcy5ub2RlLm9uKGNjLk5vZGUuRXZlbnRUeXBlLlRPVUNIX0NBTkNFTCwgdGhpcy5vblRvdWNoLCB0aGlzKTtcclxuICAgICAgICAvLyB0aGlzLm5vZGUub24oXCJjYXJkdG91Y2hcIix0aGlzLm9uRW1pdCx0aGlzKTtcclxuXHJcbiAgICB9LFxyXG4gICAgb25FbWl0OmZ1bmN0aW9uKCl7XHJcbiAgICAgICAgY29uc29sZS5sb2coXCJvbkVtaXQgY2FyZDpcIiArIHRoaXMuY2FyZC50b1N0cmluZygpKTtcclxuICAgIH0sXHJcbiAgICBvblRvdWNoOmZ1bmN0aW9uKGV2ZW50KXtcclxuICAgICAgICBpZih0aGlzLm93bmVyKXtcclxuICAgICAgICAgICAgdmFyIGN1c3RvbUV2ZW50ID0gbmV3IGNjLkV2ZW50LkV2ZW50Q3VzdG9tKCdjYXJkLXRvdWNoJywgdHJ1ZSk7XHJcbiAgICAgICAgICAgIGN1c3RvbUV2ZW50LnNldFVzZXJEYXRhKHtcclxuICAgICAgICAgICAgICAgIGNhcmQ6dGhpcyxcclxuICAgICAgICAgICAgICAgIGV2ZW50OmV2ZW50XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB0aGlzLm5vZGUuZGlzcGF0Y2hFdmVudChjdXN0b21FdmVudCk7XHJcbiAgICAgICAgICAgIC8vIHZhciBjUGxheWVyID0gdGhpcy5vd25lci5nZXRDb21wb25lbnQoXCJDUGxheWVyXCIpO1xyXG4gICAgICAgICAgICAvLyBjUGxheWVyLm9uVG91Y2hDYXJkKGV2ZW50LHRoaXMpO1xyXG4gICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIm5vdCBmb3VuZCBvd25lcidzIGNhcmQ6XCIgKyB0aGlzLmlkKTtcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG4gICAgc3RhcnQ6ZnVuY3Rpb24oKXtcclxuICAgICAgICB0aGlzLm5vZGUuZGlzcGF0Y2hFdmVudCggbmV3IGNjLkV2ZW50LkV2ZW50Q3VzdG9tKCdjYXJkdG91Y2gnLCB0cnVlKSApO1xyXG4gICAgfSxcclxuICAgIHNldENhcmQ6ZnVuY3Rpb24oY2FyZCl7XHJcbiAgICAgICAgY29uc29sZS5sb2coXCJzZXRDYXJkOlwiICsgY2FyZCArXCJ8cG9pbnQ6XCIgKyBjYXJkLnBvaW50ICtcInxzdWl0OlwiICsgY2FyZC5zdWl0KTtcclxuICAgICAgICB0aGlzLmNhcmQgPSBjYXJkO1xyXG4gICAgfSxcclxuICAgIC8vIHVzZSB0aGlzIGZvciBpbml0aWFsaXphdGlvblxyXG4gICAgaW5pdDogZnVuY3Rpb24gKGNhcmQpIHtcclxuICAgICAgICB2YXIgaXNGYWNlQ2FyZCA9IDg8PSBjYXJkLnBvaW50ICYmIGNhcmQucG9pbnQgPD0gMTA7XHJcblxyXG4gICAgICAgIGNvbnNvbGUubG9nKFwiaXNGYWNlOlwiICsgY2FyZC50b1N0cmluZygpICtcInxcIiArIGlzRmFjZUNhcmQpO1xyXG4gICAgICAgIGlmIChpc0ZhY2VDYXJkKSB7XHJcbiAgICAgICAgICAgIHRoaXMubWFpblBpYy5zcHJpdGVGcmFtZSA9IHRoaXMudGV4RmFjZXNbY2FyZC5wb2ludCAtIDldO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMubWFpblBpYy5zcHJpdGVGcmFtZSA9IHRoaXMudGV4U3VpdEJpZ1tjYXJkLnN1aXRdO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gZm9yIGpzYlxyXG4gICAgICAgIHRoaXMucG9pbnQuc3RyaW5nID0gY2FyZC5wb2ludE5hbWU7XHJcblxyXG4gICAgICAgIGlmIChjYXJkLmlzUmVkU3VpdCkge1xyXG4gICAgICAgICAgICB0aGlzLnBvaW50Lm5vZGUuY29sb3IgPSB0aGlzLnJlZFRleHRDb2xvcjtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLnBvaW50Lm5vZGUuY29sb3IgPSB0aGlzLmJsYWNrVGV4dENvbG9yO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5zdWl0LnNwcml0ZUZyYW1lID0gdGhpcy50ZXhTdWl0U21hbGxbY2FyZC5zdWl0XTtcclxuICAgIH0sXHJcblxyXG4gICAgcmV2ZWFsOiBmdW5jdGlvbiAoaXNGYWNlVXApIHtcclxuICAgICAgICB0aGlzLnBvaW50Lm5vZGUuYWN0aXZlICAgPSBpc0ZhY2VVcDtcclxuICAgICAgICB0aGlzLnN1aXQubm9kZS5hY3RpdmUgICAgPSBpc0ZhY2VVcDtcclxuICAgICAgICB0aGlzLm1haW5QaWMubm9kZS5hY3RpdmUgPSBpc0ZhY2VVcDtcclxuICAgICAgICB0aGlzLmNhcmRCRy5zcHJpdGVGcmFtZSAgPSBpc0ZhY2VVcCA/IHRoaXMudGV4RnJvbnRCRyA6IHRoaXMudGV4QmFja0JHO1xyXG4gICAgfSxcclxuICAgIHNldFBvc2l0aW9uQ2VudGVyOmZ1bmN0aW9uIChwb3MpIHtcclxuICAgICAgICB0aGlzLm5vZGUuc2V0UG9zaXRpb24ocG9zLnggLSA1MCxwb3MueSAtIDY1KTtcclxuICAgIH1cclxufSk7Il19