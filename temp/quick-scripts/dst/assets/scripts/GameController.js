
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/scripts/GameController.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '0998cn5M2hCaJbNVw/MXvof', 'GameController');
// scripts/GameController.js

"use strict";

var PlayableState = require('PlayableState');

var PoolHandler = require("PoolHandler");

var CCard = require("CCard");

var CTable = require("CTable");

var CPlayer = require("CPlayer");

var _require = require("Types"),
    Card = _require.Card,
    Table = _require.Table,
    Player = _require.Player;

var _require2 = require("GameFake"),
    ActionType = _require2.ActionType,
    GameFake = _require2.GameFake,
    SoundType = _require2.SoundType;

var PlayableAds = require("PlayableAds");

var CAudio = require("CAudio");

var Utility = require("Utility");

cc.Class({
  "extends": cc.Component,
  properties: {
    playableState: {
      "default": null,
      type: PlayableState,
      serializable: false,
      visible: false
    },
    btnPlayNow: cc.Button,
    btnDump: cc.Button,
    btnPass: cc.Button,
    layerGame: cc.Node,
    layerAction: cc.Node,
    table: {
      "default": null,
      type: cc.Node
    },
    players: {
      "default": [],
      type: cc.Node
    },
    layerCard: {
      "default": null,
      type: cc.Node
    },
    nodeSuggestGesture: {
      "default": null,
      type: cc.Node
    },
    nodeCHPlay: {
      "default": null,
      type: cc.Node
    },
    effectWin: {
      "default": null,
      type: cc.Node
    },
    cardPrefab: {
      "default": null,
      type: cc.Prefab
    },
    _poolCard: {
      "default": null,
      type: cc.NodePool,
      visible: false
    },
    _gameFake: {
      "default": null,
      type: GameFake,
      visible: false
    }
  },
  ctor: function ctor() {
    this.curIndex = -1;
    this.cardExpects = [];
    this.startPointTouch = null;
    this.zIndexCard = 10;
    this.audio = null;
  },
  onEnable: function onEnable() {
    console.log("onEnable players:" + this.players.length);
  },
  attachLayerCardToPlayer: function attachLayerCardToPlayer() {
    var len = this.players.length;

    for (var i = 0; i < len; i++) {
      var cPlayer = this.players[i].getComponent("CPlayer");
      cPlayer.setLayerCard(this.layerCard);
    }
  },
  onLoad: function onLoad() {
    this.nodeCHPlay.active = false;
    this.effectWin.getComponent("CEffectWin").gameController = this;
    this.nodeSuggestGesture.active = false;
    this.attachLayerCardToPlayer();
    this.audio = this.node.getComponent(CAudio);
    this.effectWin.active = false; //1. khoi tao info ban dau

    this._poolCard = new cc.NodePool(CCard);
    this._gameFake = new GameFake();

    var gameInfo = this._gameFake.getDefaultInfo();

    var tableConfig = gameInfo.table;
    var table = new Table(tableConfig.id, tableConfig.stake, tableConfig.pot);
    this.table.getComponent(CTable).setTable(table); //create new Card on Dock

    var cards = tableConfig.dock;
    var cTable = this.table.getComponent(CTable);
    cTable.setNumCard(cards.length);

    for (var j = 0; j < cards.length; j++) {
      var c = cards[j];

      var cardPrefabs = this._poolCard.get();

      if (!cardPrefabs) {
        cardPrefabs = cc.instantiate(this.cardPrefab);
      }

      var cCard = cardPrefabs.getComponent(CCard);
      cCard.setCard(c);
      cCard.index = j;
      cCard.setOwner(cTable);
      var p = cTable.getPositionCard(cCard);
      cardPrefabs.setPosition(p);
      this.layerCard.addChild(cardPrefabs);
    }

    console.log("onEnable players:" + this.players.length); //update info avatar

    var playersConfig = gameInfo.players;

    for (var k = 0; k < playersConfig.length; k++) {
      var playerConfig = playersConfig[k];
      var player = new Player(playerConfig.index, playerConfig.displayName, playerConfig.gold, playerConfig.avatarIndex, playerConfig.cards);
      console.log("get palyer at:" + player.index);
      var cPlayer = this.players[player.index].getComponent(CPlayer);
      cPlayer.setGameController(this);
      cPlayer.setPlayer(player);
    } //load prefab cardPrefabs
    // cc.loader.loadRes("prefabs/cardPrefab", function (err, prefab) {
    //     var newNode = cc.instantiate(prefab);
    //     newNode.setPosition(100,100);
    //     this.layerGame.addChild(newNode);
    //     // cc.director.getScene().addChild(newNode);
    // }.bind(this));


    this.node.on("card-touch", this.onTouchCard, this);

    var actionConfig = this._gameFake.getAction();

    var delayTime = actionConfig.time;
    this.curIndex = actionConfig.index;
    this.onEnterTurn(actionConfig.index);

    if (delayTime > 0) {
      this.scheduleOnce(function () {
        this.executeAction();
      }.bind(this), delayTime);
    }
  },
  start: function start() {},
  onEnterTurn: function onEnterTurn(index) {
    console.log("onEnterTurn: " + index);
    var cPlayer = this.players[index].getComponent(CPlayer);
    cPlayer.onEnterTurn();
  },
  executeAction: function executeAction() {
    this.nodeSuggestGesture.active = false;

    var actionConfig = this._gameFake.getAction();

    console.log("executeAction:" + JSON.stringify(actionConfig));
    var index = actionConfig.index;
    var type = actionConfig.type;

    switch (type) {
      case ActionType.PASS:
        this.onPassAt(index);
        break;

      case ActionType.DISCARD:
        this.onDiscardAt(index, actionConfig.cards);
        break;
    }

    var sound = actionConfig.sound;

    if (sound) {
      this.audio.playAudio(sound);
    }

    if (actionConfig.isEnded) {
      this.effectWin.active = true;
    } else {
      this.curIndex = actionConfig.next;

      var actionNext = this._gameFake.next();

      if (actionNext) {
        this.onEnterTurn(actionNext.index);
        console.log("actionNext:" + JSON.stringify(actionNext));
        var delayTime = actionNext.time;

        if (delayTime > 0) {
          this.scheduleOnce(function () {
            var actionConfig = this._gameFake.getAction();

            var index = actionConfig.index;

            if (index === 0) {
              if (actionConfig.suggest) {
                //neu co suggest
                this.nodeSuggestGesture.active = true;
                this.players[0].getComponent(CPlayer).onSuggestCard(actionConfig.cards);
              }

              this.cardExpects = actionConfig.cards;
              return;
            }

            this.executeAction();
          }.bind(this), delayTime);
        }
      }
    }
  },
  onPassAt: function onPassAt(index) {
    console.log("onPassAt:" + index);
    var cPlayer = this.players[index].getComponent(CPlayer);
    cPlayer.onPass();
  },
  onDiscardAt: function onDiscardAt(index, cards) {
    console.log("onDiscardAt:" + index + "|" + JSON.stringify(cards));
    var cTable = this.table.getComponent(CTable);
    var cardPrefabs = this.players[index].getComponent(CPlayer).onDiscard(cards);
    var len = cardPrefabs.length;
    cTable.setNumCard(len);

    for (var k = 0; k < len; k++) {
      var cardPrefab = cardPrefabs[k];
      var cCard = cardPrefab.getComponent(CCard);
      cCard.index = k;
      cCard.owner = cTable;
      var p = cTable.getPositionCard(cCard);
      cardPrefab.zIndex = ++this.zIndexCard; // cardPrefab.setPosition(p);

      cardPrefab.runAction(cc.spawn(cc.moveTo(1, p), cc.rotateTo(1, 0))); // cc.log("newZIndex:" + this.zIndexCard)

      ; // this.layerGame.addChild(cardPrefab);
    } // for (var j = 0; j < cards.length; j++) {
    //     var c = cards[j];
    //
    //     var cardPrefabs = this._poolCard.get();
    //     if(!cardPrefabs){cardPrefabs = cc.instantiate(this.cardPrefab);}
    //
    //     var cCard = cardPrefabs.getComponent(CCard);
    //
    //     cCard.setCard(c);
    //     cCard.index = (j);
    //     cCard.owner = cTable;
    //
    //     var p = cTable.getPositionCard(cCard);
    //     cardPrefabs.setPosition(p);
    //     this.layerGame.addChild(cardPrefabs);
    // }

  },
  onTouchCard: function onTouchCard(event) {
    var data = event.getUserData();
    var cCard = data.card;
    var owner = cCard.owner;

    if (owner instanceof CTable) {
      console.log("passing card on table");
      return;
    }

    if (owner instanceof CPlayer) {
      if (this.isMyTurn()) {
        if (this.isTouchExpectCards(cCard.card)) {
          switch (data.event.type) {
            case cc.Node.EventType.TOUCH_START:
              this.startPointTouch = data.event.getLocation();
              break;

            case cc.Node.EventType.TOUCH_MOVE:
              break;

            case cc.Node.EventType.TOUCH_END:
            case cc.Node.EventType.TOUCH_CANCEL:
              var pos = data.event.getLocation();

              if (pos.y - this.startPointTouch.y > 45) {
                this.executeAction();
                cc.log("Discard on my turn");
              } else {
                cc.log("!!Discard on my turn");
              }

              cc.log("touch:" + JSON.stringify(this.startPointTouch) + "| " + JSON.stringify(pos));
              break;
          }
        } else {
          cc.log("not expects card");
        }
      } else {
        cc.log("not my turn");
      } // owner.onTouchCard(data.event,data.card)

    } // console.log("onTouchCard at controler");

  },
  onPlayNow: function onPlayNow() {
    console.log("onPlay path main");
    PlayableAds.onCTAClick();
  },
  onTouchDump: function onTouchDump() {
    console.log("touch Dump");
  },
  onTouchPass: function onTouchPass() {
    console.log("touch Pass");
  },
  getNewCard: function getNewCard() {
    var cardPrefab = this._poolCard.get();

    if (!cardPrefab) {
      cardPrefab = cc.instantiate(this.cardPrefab);
    }

    return cardPrefab;
  },
  isMyTurn: function isMyTurn() {
    return this.curIndex === 0;
  },
  isTouchExpectCards: function isTouchExpectCards(card) {
    var len = this.cardExpects.length;

    for (var i = 0; i < len; i++) {
      var c = this.cardExpects[i];

      if (c.id === card.id) {
        return true;
      }
    }

    return false;
  },
  showNodeCHPlay: function showNodeCHPlay() {
    this.nodeCHPlay.active = true;
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcc2NyaXB0c1xcR2FtZUNvbnRyb2xsZXIuanMiXSwibmFtZXMiOlsiUGxheWFibGVTdGF0ZSIsInJlcXVpcmUiLCJQb29sSGFuZGxlciIsIkNDYXJkIiwiQ1RhYmxlIiwiQ1BsYXllciIsIkNhcmQiLCJUYWJsZSIsIlBsYXllciIsIkFjdGlvblR5cGUiLCJHYW1lRmFrZSIsIlNvdW5kVHlwZSIsIlBsYXlhYmxlQWRzIiwiQ0F1ZGlvIiwiVXRpbGl0eSIsImNjIiwiQ2xhc3MiLCJDb21wb25lbnQiLCJwcm9wZXJ0aWVzIiwicGxheWFibGVTdGF0ZSIsInR5cGUiLCJzZXJpYWxpemFibGUiLCJ2aXNpYmxlIiwiYnRuUGxheU5vdyIsIkJ1dHRvbiIsImJ0bkR1bXAiLCJidG5QYXNzIiwibGF5ZXJHYW1lIiwiTm9kZSIsImxheWVyQWN0aW9uIiwidGFibGUiLCJwbGF5ZXJzIiwibGF5ZXJDYXJkIiwibm9kZVN1Z2dlc3RHZXN0dXJlIiwibm9kZUNIUGxheSIsImVmZmVjdFdpbiIsImNhcmRQcmVmYWIiLCJQcmVmYWIiLCJfcG9vbENhcmQiLCJOb2RlUG9vbCIsIl9nYW1lRmFrZSIsImN0b3IiLCJjdXJJbmRleCIsImNhcmRFeHBlY3RzIiwic3RhcnRQb2ludFRvdWNoIiwiekluZGV4Q2FyZCIsImF1ZGlvIiwib25FbmFibGUiLCJjb25zb2xlIiwibG9nIiwibGVuZ3RoIiwiYXR0YWNoTGF5ZXJDYXJkVG9QbGF5ZXIiLCJsZW4iLCJpIiwiY1BsYXllciIsImdldENvbXBvbmVudCIsInNldExheWVyQ2FyZCIsIm9uTG9hZCIsImFjdGl2ZSIsImdhbWVDb250cm9sbGVyIiwibm9kZSIsImdhbWVJbmZvIiwiZ2V0RGVmYXVsdEluZm8iLCJ0YWJsZUNvbmZpZyIsImlkIiwic3Rha2UiLCJwb3QiLCJzZXRUYWJsZSIsImNhcmRzIiwiZG9jayIsImNUYWJsZSIsInNldE51bUNhcmQiLCJqIiwiYyIsImNhcmRQcmVmYWJzIiwiZ2V0IiwiaW5zdGFudGlhdGUiLCJjQ2FyZCIsInNldENhcmQiLCJpbmRleCIsInNldE93bmVyIiwicCIsImdldFBvc2l0aW9uQ2FyZCIsInNldFBvc2l0aW9uIiwiYWRkQ2hpbGQiLCJwbGF5ZXJzQ29uZmlnIiwiayIsInBsYXllckNvbmZpZyIsInBsYXllciIsImRpc3BsYXlOYW1lIiwiZ29sZCIsImF2YXRhckluZGV4Iiwic2V0R2FtZUNvbnRyb2xsZXIiLCJzZXRQbGF5ZXIiLCJvbiIsIm9uVG91Y2hDYXJkIiwiYWN0aW9uQ29uZmlnIiwiZ2V0QWN0aW9uIiwiZGVsYXlUaW1lIiwidGltZSIsIm9uRW50ZXJUdXJuIiwic2NoZWR1bGVPbmNlIiwiZXhlY3V0ZUFjdGlvbiIsImJpbmQiLCJzdGFydCIsIkpTT04iLCJzdHJpbmdpZnkiLCJQQVNTIiwib25QYXNzQXQiLCJESVNDQVJEIiwib25EaXNjYXJkQXQiLCJzb3VuZCIsInBsYXlBdWRpbyIsImlzRW5kZWQiLCJuZXh0IiwiYWN0aW9uTmV4dCIsInN1Z2dlc3QiLCJvblN1Z2dlc3RDYXJkIiwib25QYXNzIiwib25EaXNjYXJkIiwib3duZXIiLCJ6SW5kZXgiLCJydW5BY3Rpb24iLCJzcGF3biIsIm1vdmVUbyIsInJvdGF0ZVRvIiwiZXZlbnQiLCJkYXRhIiwiZ2V0VXNlckRhdGEiLCJjYXJkIiwiaXNNeVR1cm4iLCJpc1RvdWNoRXhwZWN0Q2FyZHMiLCJFdmVudFR5cGUiLCJUT1VDSF9TVEFSVCIsImdldExvY2F0aW9uIiwiVE9VQ0hfTU9WRSIsIlRPVUNIX0VORCIsIlRPVUNIX0NBTkNFTCIsInBvcyIsInkiLCJvblBsYXlOb3ciLCJvbkNUQUNsaWNrIiwib25Ub3VjaER1bXAiLCJvblRvdWNoUGFzcyIsImdldE5ld0NhcmQiLCJzaG93Tm9kZUNIUGxheSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxJQUFJQSxhQUFhLEdBQUdDLE9BQU8sQ0FBQyxlQUFELENBQTNCOztBQUNBLElBQUlDLFdBQVcsR0FBR0QsT0FBTyxDQUFDLGFBQUQsQ0FBekI7O0FBQ0Es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LEtBQVNpRSxJQUFJLENBQUNqRSxFQUFqQixFQUFvQjtBQUNoQixlQUFPLElBQVA7QUFDSDtBQUNKOztBQUNELFdBQU8sS0FBUDtBQUNILEdBdlRJO0FBd1RMaUYsRUFBQUEsY0FBYyxFQUFDLDBCQUFZO0FBQ3ZCLFNBQUsvRyxVQUFMLENBQWdCd0IsTUFBaEIsR0FBeUIsSUFBekI7QUFDSDtBQTFUSSxDQUFUIiwic291cmNlUm9vdCI6Ii8iLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgUGxheWFibGVTdGF0ZSA9IHJlcXVpcmUoJ1BsYXlhYmxlU3RhdGUnKTtcclxudmFyIFBvb2xIYW5kbGVyID0gcmVxdWlyZShcIlBvb2xIYW5kbGVyXCIpO1xyXG52YXIgQ0NhcmQgPSByZXF1aXJlKFwiQ0NhcmRcIik7XHJcbnZhciBDVGFibGUgPSByZXF1aXJlKFwiQ1RhYmxlXCIpO1xyXG52YXIgQ1BsYXllciA9IHJlcXVpcmUoXCJDUGxheWVyXCIpO1xyXG52YXIge0NhcmQsVGFibGUsUGxheWVyfSA9IHJlcXVpcmUoXCJUeXBlc1wiKTtcclxudmFyIHtBY3Rpb25UeXBlLEdhbWVGYWtlLFNvdW5kVHlwZX0gPSByZXF1aXJlKFwiR2FtZUZha2VcIik7XHJcbnZhciBQbGF5YWJsZUFkcyA9IHJlcXVpcmUoXCJQbGF5YWJsZUFkc1wiKTtcclxudmFyIENBdWRpbyA9IHJlcXVpcmUoXCJDQXVkaW9cIik7XHJcbnZhciBVdGlsaXR5ID0gcmVxdWlyZShcIlV0aWxpdHlcIik7XHJcblxyXG5jYy5DbGFzcyh7XHJcbiAgICBleHRlbmRzICAgOiBjYy5Db21wb25lbnQsXHJcbiAgICBwcm9wZXJ0aWVzOiB7XHJcbiAgICAgICAgcGxheWFibGVTdGF0ZToge1xyXG4gICAgICAgICAgICBkZWZhdWx0ICAgICA6IG51bGwsXHJcbiAgICAgICAgICAgIHR5cGUgICAgICAgIDogUGxheWFibGVTdGF0ZSxcclxuICAgICAgICAgICAgc2VyaWFsaXphYmxlOiBmYWxzZSxcclxuICAgICAgICAgICAgdmlzaWJsZSAgICAgOiBmYWxzZVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgYnRuUGxheU5vdyAgIDogY2MuQnV0dG9uLFxyXG4gICAgICAgIGJ0bkR1bXAgICAgICA6IGNjLkJ1dHRvbixcclxuICAgICAgICBidG5QYXNzICAgICAgOiBjYy5CdXR0b24sXHJcbiAgICAgICAgbGF5ZXJHYW1lICAgIDogY2MuTm9kZSxcclxuICAgICAgICBsYXllckFjdGlvbiAgOiBjYy5Ob2RlLFxyXG4gICAgICAgIHRhYmxlOntcclxuICAgICAgICAgICAgZGVmYXVsdDpudWxsLFxyXG4gICAgICAgICAgICB0eXBlOmNjLk5vZGVcclxuICAgICAgICB9LFxyXG4gICAgICAgIHBsYXllcnMgIDoge1xyXG4gICAgICAgICAgICBkZWZhdWx0OiBbXSxcclxuICAgICAgICAgICAgdHlwZSAgIDogY2MuTm9kZVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgbGF5ZXJDYXJkOntcclxuICAgICAgICAgICAgZGVmYXVsdDpudWxsLFxyXG4gICAgICAgICAgICB0eXBlOmNjLk5vZGVcclxuICAgICAgICB9LFxyXG4gICAgICAgIG5vZGVTdWdnZXN0R2VzdHVyZTp7XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6bnVsbCxcclxuICAgICAgICAgICAgdHlwZTpjYy5Ob2RlXHJcbiAgICAgICAgfSxcclxuICAgICAgICBub2RlQ0hQbGF5OntcclxuICAgICAgICAgICAgZGVmYXVsdDpudWxsLFxyXG4gICAgICAgICAgICB0eXBlOmNjLk5vZGVcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVmZmVjdFdpbjp7XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6bnVsbCxcclxuICAgICAgICAgICAgdHlwZTpjYy5Ob2RlXHJcbiAgICAgICAgfSxcclxuICAgICAgICBjYXJkUHJlZmFiOiB7XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6IG51bGwsXHJcbiAgICAgICAgICAgIHR5cGUgICA6IGNjLlByZWZhYlxyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIF9wb29sQ2FyZDoge1xyXG4gICAgICAgICAgICBkZWZhdWx0OiBudWxsLFxyXG4gICAgICAgICAgICB0eXBlICAgOiBjYy5Ob2RlUG9vbCxcclxuICAgICAgICAgICAgdmlzaWJsZTpmYWxzZVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgX2dhbWVGYWtlOntcclxuICAgICAgICAgICAgZGVmYXVsdDpudWxsLFxyXG4gICAgICAgICAgICB0eXBlOiBHYW1lRmFrZSxcclxuICAgICAgICAgICAgdmlzaWJsZTpmYWxzZVxyXG4gICAgICAgIH0sXHJcbiAgICB9LFxyXG5cclxuICAgIGN0b3I6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB0aGlzLmN1ckluZGV4ID0gLTE7XHJcbiAgICAgICAgdGhpcy5jYXJkRXhwZWN0cyA9IFtdO1xyXG4gICAgICAgIHRoaXMuc3RhcnRQb2ludFRvdWNoID0gbnVsbDtcclxuICAgICAgICB0aGlzLnpJbmRleENhcmQgPSAxMDtcclxuICAgICAgICB0aGlzLmF1ZGlvID0gbnVsbDtcclxuICAgIH0sXHJcblxyXG4gICAgb25FbmFibGU6ZnVuY3Rpb24oKXtcclxuICAgICAgICBjb25zb2xlLmxvZyhcIm9uRW5hYmxlIHBsYXllcnM6XCIgKyB0aGlzLnBsYXllcnMubGVuZ3RoKTtcclxuICAgIH0sXHJcbiAgICBhdHRhY2hMYXllckNhcmRUb1BsYXllcjpmdW5jdGlvbigpe1xyXG4gICAgICAgIHZhciBsZW4gPSB0aGlzLnBsYXllcnMubGVuZ3RoO1xyXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuOyBpKyspIHtcclxuICAgICAgICAgICAgdmFyIGNQbGF5ZXIgPSB0aGlzLnBsYXllcnNbaV0uZ2V0Q29tcG9uZW50KFwiQ1BsYXllclwiKTtcclxuICAgICAgICAgICAgY1BsYXllci5zZXRMYXllckNhcmQodGhpcy5sYXllckNhcmQpO1xyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbiAgICBvbkxvYWQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB0aGlzLm5vZGVDSFBsYXkuYWN0aXZlID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5lZmZlY3RXaW4uZ2V0Q29tcG9uZW50KFwiQ0VmZmVjdFdpblwiKS5nYW1lQ29udHJvbGxlciA9IHRoaXM7XHJcbiAgICAgICAgdGhpcy5ub2RlU3VnZ2VzdEdlc3R1cmUuYWN0aXZlID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5hdHRhY2hMYXllckNhcmRUb1BsYXllcigpO1xyXG4gICAgICAgIHRoaXMuYXVkaW8gPSB0aGlzLm5vZGUuZ2V0Q29tcG9uZW50KENBdWRpbyk7XHJcbiAgICAgICAgdGhpcy5lZmZlY3RXaW4uYWN0aXZlID0gZmFsc2U7XHJcbiAgICAgICAgLy8xLiBraG9pIHRhbyBpbmZvIGJhbiBkYXVcclxuICAgICAgICB0aGlzLl9wb29sQ2FyZCA9IG5ldyBjYy5Ob2RlUG9vbChDQ2FyZCk7XHJcbiAgICAgICAgdGhpcy5fZ2FtZUZha2UgPSBuZXcgR2FtZUZha2UoKTtcclxuICAgICAgICB2YXIgZ2FtZUluZm8gPSB0aGlzLl9nYW1lRmFrZS5nZXREZWZhdWx0SW5mbygpO1xyXG4gICAgICAgIHZhciB0YWJsZUNvbmZpZyA9IGdhbWVJbmZvLnRhYmxlO1xyXG4gICAgICAgIHZhciB0YWJsZSA9IG5ldyBUYWJsZSh0YWJsZUNvbmZpZy5pZCx0YWJsZUNvbmZpZy5zdGFrZSx0YWJsZUNvbmZpZy5wb3QpO1xyXG4gICAgICAgIHRoaXMudGFibGUuZ2V0Q29tcG9uZW50KENUYWJsZSkuc2V0VGFibGUodGFibGUpO1xyXG5cclxuICAgICAgICAvL2NyZWF0ZSBuZXcgQ2FyZCBvbiBEb2NrXHJcbiAgICAgICAgdmFyIGNhcmRzID0gdGFibGVDb25maWcuZG9jaztcclxuICAgICAgICB2YXIgY1RhYmxlID0gdGhpcy50YWJsZS5nZXRDb21wb25lbnQoQ1RhYmxlKTtcclxuICAgICAgICBjVGFibGUuc2V0TnVtQ2FyZChjYXJkcy5sZW5ndGgpO1xyXG4gICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgY2FyZHMubGVuZ3RoOyBqKyspIHtcclxuICAgICAgICAgICAgdmFyIGMgPSBjYXJkc1tqXTtcclxuXHJcbiAgICAgICAgICAgIHZhciBjYXJkUHJlZmFicyA9IHRoaXMuX3Bvb2xDYXJkLmdldCgpO1xyXG4gICAgICAgICAgICBpZighY2FyZFByZWZhYnMpe2NhcmRQcmVmYWJzID0gY2MuaW5zdGFudGlhdGUodGhpcy5jYXJkUHJlZmFiKTt9XHJcblxyXG4gICAgICAgICAgICB2YXIgY0NhcmQgPSBjYXJkUHJlZmFicy5nZXRDb21wb25lbnQoQ0NhcmQpO1xyXG5cclxuICAgICAgICAgICAgY0NhcmQuc2V0Q2FyZChjKTtcclxuICAgICAgICAgICAgY0NhcmQuaW5kZXggPSAoaik7XHJcbiAgICAgICAgICAgIGNDYXJkLnNldE93bmVyKGNUYWJsZSk7XHJcblxyXG4gICAgICAgICAgICB2YXIgcCA9IGNUYWJsZS5nZXRQb3NpdGlvbkNhcmQoY0NhcmQpO1xyXG4gICAgICAgICAgICBjYXJkUHJlZmFicy5zZXRQb3NpdGlvbihwKTtcclxuICAgICAgICAgICAgdGhpcy5sYXllckNhcmQuYWRkQ2hpbGQoY2FyZFByZWZhYnMpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zb2xlLmxvZyhcIm9uRW5hYmxlIHBsYXllcnM6XCIgKyB0aGlzLnBsYXllcnMubGVuZ3RoKTtcclxuXHJcbiAgICAgICAgLy91cGRhdGUgaW5mbyBhdmF0YXJcclxuICAgICAgICB2YXIgcGxheWVyc0NvbmZpZyA9IGdhbWVJbmZvLnBsYXllcnM7XHJcbiAgICAgICAgZm9yICh2YXIgayA9IDA7IGsgPCBwbGF5ZXJzQ29uZmlnLmxlbmd0aDsgaysrKSB7XHJcbiAgICAgICAgICAgIHZhciBwbGF5ZXJDb25maWcgPSBwbGF5ZXJzQ29uZmlnW2tdO1xyXG4gICAgICAgICAgICB2YXIgcGxheWVyID0gbmV3IFBsYXllcihwbGF5ZXJDb25maWcuaW5kZXgscGxheWVyQ29uZmlnLmRpc3BsYXlOYW1lLHBsYXllckNvbmZpZy5nb2xkLHBsYXllckNvbmZpZy5hdmF0YXJJbmRleCxwbGF5ZXJDb25maWcuY2FyZHMpO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcImdldCBwYWx5ZXIgYXQ6XCIgKyBwbGF5ZXIuaW5kZXgpO1xyXG4gICAgICAgICAgICB2YXIgY1BsYXllciA9IHRoaXMucGxheWVyc1twbGF5ZXIuaW5kZXhdLmdldENvbXBvbmVudChDUGxheWVyKTtcclxuICAgICAgICAgICAgY1BsYXllci5zZXRHYW1lQ29udHJvbGxlcih0aGlzKTtcclxuICAgICAgICAgICAgY1BsYXllci5zZXRQbGF5ZXIocGxheWVyKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy9sb2FkIHByZWZhYiBjYXJkUHJlZmFic1xyXG4gICAgICAgIC8vIGNjLmxvYWRlci5sb2FkUmVzKFwicHJlZmFicy9jYXJkUHJlZmFiXCIsIGZ1bmN0aW9uIChlcnIsIHByZWZhYikge1xyXG4gICAgICAgIC8vICAgICB2YXIgbmV3Tm9kZSA9IGNjLmluc3RhbnRpYXRlKHByZWZhYik7XHJcbiAgICAgICAgLy8gICAgIG5ld05vZGUuc2V0UG9zaXRpb24oMTAwLDEwMCk7XHJcbiAgICAgICAgLy8gICAgIHRoaXMubGF5ZXJHYW1lLmFkZENoaWxkKG5ld05vZGUpO1xyXG4gICAgICAgIC8vICAgICAvLyBjYy5kaXJlY3Rvci5nZXRTY2VuZSgpLmFkZENoaWxkKG5ld05vZGUpO1xyXG4gICAgICAgIC8vIH0uYmluZCh0aGlzKSk7XHJcbiAgICAgICAgdGhpcy5ub2RlLm9uKFwiY2FyZC10b3VjaFwiLHRoaXMub25Ub3VjaENhcmQsdGhpcyk7XHJcblxyXG4gICAgICAgIHZhciBhY3Rpb25Db25maWcgPSB0aGlzLl9nYW1lRmFrZS5nZXRBY3Rpb24oKTtcclxuICAgICAgICB2YXIgZGVsYXlUaW1lID0gYWN0aW9uQ29uZmlnLnRpbWU7XHJcbiAgICAgICAgdGhpcy5jdXJJbmRleCA9IGFjdGlvbkNvbmZpZy5pbmRleDtcclxuICAgICAgICB0aGlzLm9uRW50ZXJUdXJuKGFjdGlvbkNvbmZpZy5pbmRleCk7XHJcbiAgICAgICAgaWYoZGVsYXlUaW1lPjApe1xyXG4gICAgICAgICAgICB0aGlzLnNjaGVkdWxlT25jZShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmV4ZWN1dGVBY3Rpb24oKTtcclxuICAgICAgICAgICAgfS5iaW5kKHRoaXMpLGRlbGF5VGltZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuICAgIHN0YXJ0OmZ1bmN0aW9uKCl7XHJcblxyXG4gICAgfSxcclxuICAgIG9uRW50ZXJUdXJuOmZ1bmN0aW9uKGluZGV4KXtcclxuICAgICAgICBjb25zb2xlLmxvZyhcIm9uRW50ZXJUdXJuOiBcIiArIGluZGV4KTtcclxuICAgICAgICB2YXIgY1BsYXllciA9IHRoaXMucGxheWVyc1tpbmRleF0uZ2V0Q29tcG9uZW50KENQbGF5ZXIpO1xyXG4gICAgICAgIGNQbGF5ZXIub25FbnRlclR1cm4oKTtcclxuICAgIH0sXHJcbiAgICBleGVjdXRlQWN0aW9uOmZ1bmN0aW9uKCl7XHJcbiAgICAgICAgdGhpcy5ub2RlU3VnZ2VzdEdlc3R1cmUuYWN0aXZlID0gZmFsc2U7XHJcbiAgICAgICAgdmFyIGFjdGlvbkNvbmZpZyA9IHRoaXMuX2dhbWVGYWtlLmdldEFjdGlvbigpO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKFwiZXhlY3V0ZUFjdGlvbjpcIiArIEpTT04uc3RyaW5naWZ5KGFjdGlvbkNvbmZpZykpO1xyXG4gICAgICAgIHZhciBpbmRleCA9IGFjdGlvbkNvbmZpZy5pbmRleDtcclxuXHJcbiAgICAgICAgdmFyIHR5cGUgPSBhY3Rpb25Db25maWcudHlwZTtcclxuICAgICAgICBzd2l0Y2ggKHR5cGUpIHtcclxuICAgICAgICAgICAgY2FzZSBBY3Rpb25UeXBlLlBBU1M6XHJcbiAgICAgICAgICAgICAgICB0aGlzLm9uUGFzc0F0KGluZGV4KTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIEFjdGlvblR5cGUuRElTQ0FSRDpcclxuICAgICAgICAgICAgICAgIHRoaXMub25EaXNjYXJkQXQoaW5kZXgsYWN0aW9uQ29uZmlnLmNhcmRzKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgc291bmQgPSBhY3Rpb25Db25maWcuc291bmQ7XHJcbiAgICAgICAgaWYoc291bmQpe1xyXG4gICAgICAgICAgICB0aGlzLmF1ZGlvLnBsYXlBdWRpbyhzb3VuZCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKGFjdGlvbkNvbmZpZy5pc0VuZGVkKXtcclxuICAgICAgICAgICAgdGhpcy5lZmZlY3RXaW4uYWN0aXZlID0gdHJ1ZTtcclxuICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgdGhpcy5jdXJJbmRleCA9IGFjdGlvbkNvbmZpZy5uZXh0O1xyXG4gICAgICAgICAgICB2YXIgYWN0aW9uTmV4dCA9IHRoaXMuX2dhbWVGYWtlLm5leHQoKTtcclxuICAgICAgICAgICAgaWYoYWN0aW9uTmV4dCl7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm9uRW50ZXJUdXJuKGFjdGlvbk5leHQuaW5kZXgpO1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJhY3Rpb25OZXh0OlwiICsgSlNPTi5zdHJpbmdpZnkoYWN0aW9uTmV4dCkpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGRlbGF5VGltZSA9IGFjdGlvbk5leHQudGltZTtcclxuICAgICAgICAgICAgICAgIGlmKGRlbGF5VGltZT4wKXtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNjaGVkdWxlT25jZShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhY3Rpb25Db25maWcgPSB0aGlzLl9nYW1lRmFrZS5nZXRBY3Rpb24oKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGluZGV4ID0gYWN0aW9uQ29uZmlnLmluZGV4O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZihpbmRleCA9PT0gMCApe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoYWN0aW9uQ29uZmlnLnN1Z2dlc3Qpey8vbmV1IGNvIHN1Z2dlc3RcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm5vZGVTdWdnZXN0R2VzdHVyZS5hY3RpdmUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGxheWVyc1swXS5nZXRDb21wb25lbnQoQ1BsYXllcikub25TdWdnZXN0Q2FyZChhY3Rpb25Db25maWcuY2FyZHMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jYXJkRXhwZWN0cyA9IGFjdGlvbkNvbmZpZy5jYXJkcztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmV4ZWN1dGVBY3Rpb24oKTtcclxuICAgICAgICAgICAgICAgICAgICB9LmJpbmQodGhpcyksZGVsYXlUaW1lKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbiAgICBvblBhc3NBdDpmdW5jdGlvbihpbmRleCl7XHJcbiAgICAgICAgY29uc29sZS5sb2coXCJvblBhc3NBdDpcIiArIGluZGV4KTtcclxuICAgICAgICB2YXIgY1BsYXllciA9IHRoaXMucGxheWVyc1tpbmRleF0uZ2V0Q29tcG9uZW50KENQbGF5ZXIpO1xyXG4gICAgICAgIGNQbGF5ZXIub25QYXNzKCk7XHJcbiAgICB9LFxyXG4gICAgb25EaXNjYXJkQXQ6ZnVuY3Rpb24oaW5kZXgsY2FyZHMpe1xyXG4gICAgICAgIGNvbnNvbGUubG9nKFwib25EaXNjYXJkQXQ6XCIgKyBpbmRleCArXCJ8XCIgKyBKU09OLnN0cmluZ2lmeShjYXJkcykpO1xyXG4gICAgICAgIHZhciBjVGFibGUgPSB0aGlzLnRhYmxlLmdldENvbXBvbmVudChDVGFibGUpO1xyXG4gICAgICAgIHZhciBjYXJkUHJlZmFicyA9IHRoaXMucGxheWVyc1tpbmRleF0uZ2V0Q29tcG9uZW50KENQbGF5ZXIpLm9uRGlzY2FyZChjYXJkcyk7XHJcblxyXG4gICAgICAgIHZhciBsZW4gPSBjYXJkUHJlZmFicy5sZW5ndGg7XHJcbiAgICAgICAgY1RhYmxlLnNldE51bUNhcmQobGVuKTtcclxuICAgICAgICBmb3IgKHZhciBrID0gMDsgayA8IGxlbjsgaysrKSB7XHJcbiAgICAgICAgICAgIHZhciBjYXJkUHJlZmFiID0gY2FyZFByZWZhYnNba107XHJcbiAgICAgICAgICAgIHZhciBjQ2FyZCA9IGNhcmRQcmVmYWIuZ2V0Q29tcG9uZW50KENDYXJkKTtcclxuICAgICAgICAgICAgY0NhcmQuaW5kZXggPSAoayk7XHJcbiAgICAgICAgICAgIGNDYXJkLm93bmVyID0gY1RhYmxlO1xyXG4gICAgICAgICAgICB2YXIgcCA9IGNUYWJsZS5nZXRQb3NpdGlvbkNhcmQoY0NhcmQpO1xyXG4gICAgICAgICAgICBjYXJkUHJlZmFiLnpJbmRleCA9ICsrIHRoaXMuekluZGV4Q2FyZDtcclxuICAgICAgICAgICAgLy8gY2FyZFByZWZhYi5zZXRQb3NpdGlvbihwKTtcclxuICAgICAgICAgICAgY2FyZFByZWZhYi5ydW5BY3Rpb24oY2Muc3Bhd24oXHJcbiAgICAgICAgICAgICAgICBjYy5tb3ZlVG8oMSxwKSxcclxuICAgICAgICAgICAgICAgIGNjLnJvdGF0ZVRvKDEsMClcclxuICAgICAgICAgICAgKSk7XHJcbiAgICAgICAgICAgIC8vIGNjLmxvZyhcIm5ld1pJbmRleDpcIiArIHRoaXMuekluZGV4Q2FyZClcclxuO1xyXG4gICAgICAgICAgICAvLyB0aGlzLmxheWVyR2FtZS5hZGRDaGlsZChjYXJkUHJlZmFiKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIGZvciAodmFyIGogPSAwOyBqIDwgY2FyZHMubGVuZ3RoOyBqKyspIHtcclxuICAgICAgICAvLyAgICAgdmFyIGMgPSBjYXJkc1tqXTtcclxuICAgICAgICAvL1xyXG4gICAgICAgIC8vICAgICB2YXIgY2FyZFByZWZhYnMgPSB0aGlzLl9wb29sQ2FyZC5nZXQoKTtcclxuICAgICAgICAvLyAgICAgaWYoIWNhcmRQcmVmYWJzKXtjYXJkUHJlZmFicyA9IGNjLmluc3RhbnRpYXRlKHRoaXMuY2FyZFByZWZhYik7fVxyXG4gICAgICAgIC8vXHJcbiAgICAgICAgLy8gICAgIHZhciBjQ2FyZCA9IGNhcmRQcmVmYWJzLmdldENvbXBvbmVudChDQ2FyZCk7XHJcbiAgICAgICAgLy9cclxuICAgICAgICAvLyAgICAgY0NhcmQuc2V0Q2FyZChjKTtcclxuICAgICAgICAvLyAgICAgY0NhcmQuaW5kZXggPSAoaik7XHJcbiAgICAgICAgLy8gICAgIGNDYXJkLm93bmVyID0gY1RhYmxlO1xyXG4gICAgICAgIC8vXHJcbiAgICAgICAgLy8gICAgIHZhciBwID0gY1RhYmxlLmdldFBvc2l0aW9uQ2FyZChjQ2FyZCk7XHJcbiAgICAgICAgLy8gICAgIGNhcmRQcmVmYWJzLnNldFBvc2l0aW9uKHApO1xyXG4gICAgICAgIC8vICAgICB0aGlzLmxheWVyR2FtZS5hZGRDaGlsZChjYXJkUHJlZmFicyk7XHJcbiAgICAgICAgLy8gfVxyXG4gICAgfSxcclxuXHJcbiAgICBvblRvdWNoQ2FyZDpmdW5jdGlvbihldmVudCl7XHJcbiAgICAgICAgdmFyIGRhdGEgPSBldmVudC5nZXRVc2VyRGF0YSgpO1xyXG4gICAgICAgIHZhciBjQ2FyZCA9IGRhdGEuY2FyZDtcclxuICAgICAgICB2YXIgb3duZXIgPSBjQ2FyZC5vd25lcjtcclxuICAgICAgICBpZihvd25lciBpbnN0YW5jZW9mIENUYWJsZSl7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwicGFzc2luZyBjYXJkIG9uIHRhYmxlXCIpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKG93bmVyIGluc3RhbmNlb2YgQ1BsYXllcil7XHJcbiAgICAgICAgICAgIGlmKHRoaXMuaXNNeVR1cm4oKSl7XHJcbiAgICAgICAgICAgICAgICBpZih0aGlzLmlzVG91Y2hFeHBlY3RDYXJkcyhjQ2FyZC5jYXJkKSl7XHJcbiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChkYXRhLmV2ZW50LnR5cGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBjYy5Ob2RlLkV2ZW50VHlwZS5UT1VDSF9TVEFSVDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3RhcnRQb2ludFRvdWNoID0gZGF0YS5ldmVudC5nZXRMb2NhdGlvbigpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgY2MuTm9kZS5FdmVudFR5cGUuVE9VQ0hfTU9WRTpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIGNjLk5vZGUuRXZlbnRUeXBlLlRPVUNIX0VORDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBjYy5Ob2RlLkV2ZW50VHlwZS5UT1VDSF9DQU5DRUw6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcG9zID0gZGF0YS5ldmVudC5nZXRMb2NhdGlvbigpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYocG9zLnkgLSB0aGlzLnN0YXJ0UG9pbnRUb3VjaC55ID4gNDUpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZXhlY3V0ZUFjdGlvbigpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNjLmxvZyhcIkRpc2NhcmQgb24gbXkgdHVyblwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNjLmxvZyhcIiEhRGlzY2FyZCBvbiBteSB0dXJuXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2MubG9nKFwidG91Y2g6XCIgKyBKU09OLnN0cmluZ2lmeSh0aGlzLnN0YXJ0UG9pbnRUb3VjaCkgK1wifCBcIisgSlNPTi5zdHJpbmdpZnkocG9zKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgICAgIGNjLmxvZyhcIm5vdCBleHBlY3RzIGNhcmRcIik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgY2MubG9nKFwibm90IG15IHR1cm5cIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8gb3duZXIub25Ub3VjaENhcmQoZGF0YS5ldmVudCxkYXRhLmNhcmQpXHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKFwib25Ub3VjaENhcmQgYXQgY29udHJvbGVyXCIpO1xyXG4gICAgfSxcclxuXHJcbiAgICBvblBsYXlOb3c6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhcIm9uUGxheSBwYXRoIG1haW5cIik7XHJcbiAgICAgICAgUGxheWFibGVBZHMub25DVEFDbGljaygpO1xyXG4gICAgfSxcclxuXHJcbiAgICBvblRvdWNoRHVtcDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKFwidG91Y2ggRHVtcFwiKTtcclxuICAgIH0sXHJcblxyXG4gICAgb25Ub3VjaFBhc3M6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhcInRvdWNoIFBhc3NcIik7XHJcbiAgICB9LFxyXG5cclxuICAgIGdldE5ld0NhcmQ6ZnVuY3Rpb24oKXtcclxuICAgICAgICB2YXIgY2FyZFByZWZhYiA9IHRoaXMuX3Bvb2xDYXJkLmdldCgpO1xyXG4gICAgICAgIGlmKCFjYXJkUHJlZmFiKXtjYXJkUHJlZmFiID0gY2MuaW5zdGFudGlhdGUodGhpcy5jYXJkUHJlZmFiKTt9XHJcbiAgICAgICAgcmV0dXJuIGNhcmRQcmVmYWI7XHJcbiAgICB9LFxyXG5cclxuICAgIGlzTXlUdXJuOmZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5jdXJJbmRleCA9PT0gMDtcclxuICAgIH0sXHJcbiAgICBpc1RvdWNoRXhwZWN0Q2FyZHM6ZnVuY3Rpb24gKGNhcmQpIHtcclxuICAgICAgICB2YXIgbGVuID0gdGhpcy5jYXJkRXhwZWN0cy5sZW5ndGg7XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW47IGkrKykge1xyXG4gICAgICAgICAgICB2YXIgYyA9IHRoaXMuY2FyZEV4cGVjdHNbaV07XHJcbiAgICAgICAgICAgIGlmKGMuaWQgPT09IGNhcmQuaWQpe1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfSxcclxuICAgIHNob3dOb2RlQ0hQbGF5OmZ1bmN0aW9uICgpIHtcclxuICAgICAgICB0aGlzLm5vZGVDSFBsYXkuYWN0aXZlID0gdHJ1ZTtcclxuICAgIH1cclxufSk7Il19